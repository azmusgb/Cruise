<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#cfeaff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg">
    <title>Staterooms | Adventure of the Seas</title>
    <meta name="description" content="View your stateroom assignments, deck locations, and quick actions in a clean, light interface.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/base.css?v=3">
  <link rel="stylesheet" href="css/utilities.css?v=3">
  <link rel="stylesheet" href="css/components.css?v=3">
    <link rel="stylesheet" href="css/feature-modules.css?v=3">
    <link rel="stylesheet" href="css/mobile-first.css?v=3">
  <script src="js/shared-layout.js?v=17" defer></script>
  <link rel="stylesheet" href="css/page-inline-extracted.css?v=2">
</head>
<body class="app-theme-rcc rooms-page page-shell">
    <!-- Skip Link -->
    <a href="#rooms-section" class="skip-link">Skip to rooms list</a>

    <!-- Header Placeholder -->
    <div id="sharedHeader" data-page="rooms"></div>

    <!-- Hero Section -->
    <section class="hero hero--rooms">
        <div class="container">
            <div class="hero__content">
                <span class="hero__eyebrow">Adventure of the Seas · Feb 14–20, 2026</span>
                <h1 class="hero__title">Stateroom Command</h1>
                <p class="hero__description">
                    Review assignments, deck placement, and room-level guest actions in one workspace.
                </p>
                <div class="hero__highlights" aria-label="Stateroom highlights">
                    <span class="hero__tag"><i class="fas fa-key" aria-hidden="true"></i> Assignment and ownership clarity</span>
                    <span class="hero__tag"><i class="fas fa-person-shelter" aria-hidden="true"></i> Muster and safety context</span>
                    <span class="hero__tag"><i class="fas fa-bed" aria-hidden="true"></i> Room-type amenities at a glance</span>
                </div>
                <div class="page-spine" aria-label="Stateroom briefing">
                    <div class="page-spine__item">
                        <span class="page-spine__label">Assignments</span>
                        <span class="page-spine__meta">Who is in each room</span>
                    </div>
                    <div class="page-spine__item">
                        <span class="page-spine__label">Room type</span>
                        <span class="page-spine__meta">Interior, ocean view, balcony context</span>
                    </div>
                    <div class="page-spine__item">
                        <span class="page-spine__label">Fast actions</span>
                        <span class="page-spine__meta">Map lookup and service requests</span>
                    </div>
                </div>
                <div class="hero__actions">
                    <a href="decks.html" class="btn btn--primary">
                        <i class="fas fa-map"></i> Open deck plan
                    </a>
                    <a href="index.html" class="btn btn--secondary">
                        <i class="fas fa-arrow-left"></i> Back to dashboard
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main id="rooms-content" class="main">
        <div class="container">
            <!-- Navigation Bar -->
            <nav class="nav-bar" aria-label="Stateroom navigation">
                <div class="container nav-bar__inner">
                    <div class="nav-heading">
                        <h2 class="nav-heading__title">Find and manage staterooms</h2>
                        <p class="nav-heading__subtitle">Search by room number, type, deck, or feature</p>
                    </div>
                    <div class="nav-controls">
                        <div class="search-box">
                            <label class="sr-only" for="roomSearchInput">Search rooms</label>
                            <i class="fas fa-search" aria-hidden="true"></i>
                            <input id="roomSearchInput" type="search" placeholder="Search by room number, name, or location" aria-label="Search staterooms by room number, name, or location" enterkeyhint="search" inputmode="search" autocapitalize="off" autocorrect="off" spellcheck="false">
                        </div>
                        <div class="filter-control" data-filter-root>
                            <button id="filterToggle" class="filter-btn" type="button" aria-expanded="false" aria-controls="filterPanel" data-filter-toggle>
                                <i class="fas fa-filter" aria-hidden="true"></i>
                                Filter
                            </button>
                            <div id="filterPanel" class="filter-panel rccl-filter-panel" role="menu" aria-label="Room type filters" data-filter-panel data-filter-group="roomType">
                                <button type="button" class="room-type-filter rccl-filter-option is-active" data-room-type="all" data-filter-option data-filter-value="all" role="menuitemradio" aria-checked="true">All rooms</button>
                                <button type="button" class="room-type-filter rccl-filter-option" data-room-type="balcony" data-filter-option data-filter-value="balcony" role="menuitemradio" aria-checked="false">Balcony</button>
                                <button type="button" class="room-type-filter rccl-filter-option" data-room-type="ocean-view" data-filter-option data-filter-value="ocean-view" role="menuitemradio" aria-checked="false">Ocean view</button>
                                <button type="button" class="room-type-filter rccl-filter-option" data-room-type="interior" data-filter-option data-filter-value="interior" role="menuitemradio" aria-checked="false">Interior</button>
                            </div>
                        </div>
                    </div>
                    <div class="nav-filters">
                        <a href="#rooms-section" class="filter-btn filter-link">
                            <i class="fas fa-bed" aria-hidden="true"></i> Rooms
                        </a>
                        <a href="decks.html" class="filter-btn filter-link">
                            <i class="fas fa-map" aria-hidden="true"></i> Deck Plans
                        </a>
                        <a href="#quick-actions" class="filter-btn filter-link">
                            <i class="fas fa-bolt" aria-hidden="true"></i> Quick Actions
                        </a>
                    </div>
                </div>
            </nav>

            <section class="family-finder" aria-label="Find family members by name">
                <h2 class="family-finder__title">Find My People</h2>
                <p class="family-finder__subtitle">Jump straight to a guest's room and highlight the matching card.</p>
                <div class="family-finder__controls">
                    <label class="sr-only" for="guestFinderInput">Search guest name</label>
                    <input id="guestFinderInput" type="search" placeholder="Type a guest name (for example: Melissa)" list="guestFinderList" enterkeyhint="search" inputmode="search" autocapitalize="words" />
                    <button id="guestFinderFavorite" type="button" class="filter-btn">Save favorite</button>
                    <button id="guestFinderClear" type="button" class="filter-btn">Clear</button>
                </div>
                <datalist id="guestFinderList"></datalist>
                <div id="guestFinderQuick" class="family-finder__quick" aria-label="Quick family picks"></div>
                <div id="guestFinderFavorites" class="family-finder__favorites" aria-label="Favorite people"></div>
                <p id="guestFinderStatus" class="family-finder__status" role="status" aria-live="polite"></p>
            </section>

            <!-- Statistics Overview -->
            <section class="stats-section" aria-labelledby="overviewTitle">
                <div class="section-header section-header--stacked">
                    <div>
                        <h2 id="overviewTitle" class="section-title">Stateroom Snapshot</h2>
                        <p class="section-subtitle">Key details only, with visual room-type distribution</p>
                    </div>
                    <button type="button" id="mobileStatsToggle" class="filter-btn mobile-stats-toggle" aria-expanded="false" aria-controls="statsGridWrap">
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                        <span>Show summary</span>
                    </button>
                </div>
                <div id="statsGridWrap" class="stats-grid-wrap">
                <div class="stats-grid">
                    <article class="stat-card animate-fade-in">
                        <div class="stat-card__title">
                            <i class="fas fa-door-closed" aria-hidden="true"></i>
                            Assigned Rooms
                        </div>
                        <div class="stat-card__content">
                            <span class="stat-value">5</span>
                            <span class="stat-label">active staterooms</span>
                        </div>
                    </article>

                    <article class="stat-card animate-fade-in">
                        <div class="stat-card__title">
                            <i class="fas fa-layer-group" aria-hidden="true"></i>
                            Deck Coverage
                        </div>
                        <div class="stat-card__content">
                            <span class="stat-value">3</span>
                            <span class="stat-label">decks represented</span>
                        </div>
                    </article>

                    <article class="stat-card animate-fade-in">
                        <div class="stat-card__title">
                            <i class="fas fa-chart-column" aria-hidden="true"></i>
                            Room Mix
                        </div>
                        <div class="stat-chart" aria-label="Room type distribution chart">
                            <div class="stat-chart__row">
                                <span>Ocean View</span>
                                <div class="stat-chart__track"><span class="stat-chart__fill stat-chart__fill--ocean" style="width: 60%;"></span></div>
                                <strong>60%</strong>
                            </div>
                            <div class="stat-chart__row">
                                <span>Balcony</span>
                                <div class="stat-chart__track"><span class="stat-chart__fill stat-chart__fill--balcony" style="width: 20%;"></span></div>
                                <strong>20%</strong>
                            </div>
                            <div class="stat-chart__row">
                                <span>Interior</span>
                                <div class="stat-chart__track"><span class="stat-chart__fill stat-chart__fill--interior" style="width: 20%;"></span></div>
                                <strong>20%</strong>
                            </div>
                        </div>
                    </article>
                </div>
                </div>
            </section>

            <!-- Rooms Grid -->
            <section id="rooms-section" class="rooms-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Stateroom Overview</h2>
                        <p class="section-subtitle">Adaptive room grouping surfaces what needs attention first</p>
                    </div>
                    <div class="rooms-count">
                        <span class="rooms-count__number">5</span>
                        <span>rooms</span>
                    </div>
                </div>
                <p id="searchSummary" class="search-summary" role="status" aria-live="polite">Showing 5 of 5 rooms</p>
                
                <section class="focus-section" id="todayFocusSection" aria-labelledby="todayFocusTitle">
                    <div class="focus-section__header">
                        <h3 id="todayFocusTitle" class="focus-section__title">
                            <i class="fas fa-bolt" aria-hidden="true"></i>
                            Today's Focus
                        </h3>
                        <p class="focus-section__subtitle">Rooms requiring immediate action before sail-away</p>
                    </div>
                    <div class="rooms-grid focus-grid" id="focusGrid"></div>
                </section>

                <section class="focus-section focus-section--secondary" id="allSetSection" aria-labelledby="allSetTitle">
                    <div class="focus-section__header">
                        <h3 id="allSetTitle" class="focus-section__title">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                            All Set
                        </h3>
                        <p class="focus-section__subtitle">Ready rooms with no immediate blockers</p>
                    </div>
                    <div class="rooms-grid" id="allSetGrid"></div>
                </section>

                <div class="rooms-grid" id="roomsGridSource" hidden>
                    <!-- Room 1 -->
                    <article class="room-card room-card--interior animate-fade-in" data-room="6650" data-room-type="interior" data-muster-complete="false" data-linked-room="6651" data-room-priority="urgent" data-room-note="Muster not completed">
                        <div class="room-card__header">
                            <span class="room-number">1</span>
                            <span class="room-category">Stateroom</span>
                            <div class="room-type">
                                <div class="room-type__icon">
                                    <i class="fas fa-bed"></i>
                                </div>
                                <h3 class="room-type__name">6650</h3>
                            </div>
                            <span class="room-location">
                                <i class="fas fa-layer-group"></i> Deck 6 · Aft
                            </span>
                        </div>

                        <div class="room-card__content">
                            <div class="room-features">
                                <span class="feature-tag">
                                    <i class="fas fa-user"></i> 4 guests
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-id-badge"></i> Booking 4519230
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-life-ring"></i> Muster D22
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-water"></i> Aft wake views
                                </span>
                            </div>
                            <div class="guest-roster" aria-label="Guests in room 6650">
                                <p class="guest-roster__label"><i class="fas fa-users" aria-hidden="true"></i>Guest Roster</p>
                                <ul class="guest-roster__list">
                                    <li class="guest-pill">Melissa</li>
                                    <li class="guest-pill">Declan</li>
                                    <li class="guest-pill">Owen</li>
                                    <li class="guest-pill">William</li>
                                </ul>
                            </div>
                            <p class="room-meta-details">Quieter aft ride with strong wake views.</p>
                            
                            <div class="room-card__actions">
                                <button type="button" class="room-details-btn" data-room-details>
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    <span>Room details</span>
                                </button>
                                <a href="decks.html?room=6650" class="view-deck-btn">
                                    <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                                    <span>Locate on deck</span>
                                </a>
                            </div>
                        </div>
                    </article>
                    
                    <!-- Room 2 -->
                    <article class="room-card room-card--interior animate-fade-in" data-room="6651" data-room-type="interior" data-muster-complete="true" data-linked-room="6650">
                        <div class="room-card__header">
                            <span class="room-number">2</span>
                            <span class="room-category">Stateroom</span>
                            <div class="room-type">
                                <div class="room-type__icon">
                                    <i class="fas fa-bed"></i>
                                </div>
                                <h3 class="room-type__name">6651</h3>
                            </div>
                            <span class="room-location">
                                <i class="fas fa-layer-group"></i> Deck 6
                            </span>
                        </div>

                        <div class="room-card__content">
                            <div class="room-features">
                                <span class="feature-tag">
                                    <i class="fas fa-user"></i> 2 guests
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-id-badge"></i> Booking 6788946
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-life-ring"></i> Muster D22
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-users"></i> Linked reservation
                                </span>
                            </div>
                            <div class="guest-roster" aria-label="Guests in room 6651">
                                <p class="guest-roster__label"><i class="fas fa-users" aria-hidden="true"></i>Guest Roster</p>
                                <ul class="guest-roster__list">
                                    <li class="guest-pill">Abel</li>
                                    <li class="guest-pill">Amy</li>
                                </ul>
                            </div>
                            <p class="room-meta-details">Linked to 6650 with shared muster station.</p>
                            
                            <div class="room-card__actions">
                                <button type="button" class="room-details-btn" data-room-details>
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    <span>Room details</span>
                                </button>
                                <a href="decks.html?room=6651" class="view-deck-btn">
                                    <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                                    <span>Locate on deck</span>
                                </a>
                            </div>
                        </div>
                    </article>
                    
                    <!-- Room 3 -->
                    <article class="room-card room-card--ocean-view animate-fade-in" data-room="8528" data-room-type="ocean-view" data-muster-complete="true">
                        <div class="room-card__header">
                            <span class="room-number">3</span>
                            <span class="room-category">Stateroom</span>
                            <div class="room-type">
                                <div class="room-type__icon">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                <h3 class="room-type__name">8528</h3>
                            </div>
                            <span class="room-location">
                                <i class="fas fa-layer-group"></i> Deck 8
                            </span>
                        </div>

                        <div class="room-card__content">
                            <div class="room-features">
                                <span class="feature-tag">
                                    <i class="fas fa-user"></i> 2 guests
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-id-badge"></i> Booking 4352113
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-life-ring"></i> Muster A2
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-ship"></i> Linked sailing record
                                </span>
                            </div>
                            <div class="guest-roster" aria-label="Guests in room 8528">
                                <p class="guest-roster__label"><i class="fas fa-users" aria-hidden="true"></i>Guest Roster</p>
                                <ul class="guest-roster__list">
                                    <li class="guest-pill">Aimee</li>
                                    <li class="guest-pill">Karin</li>
                                </ul>
                            </div>
                            <p class="room-meta-details">Deck 8 assignment with separate muster flow.</p>
                            
                            <div class="room-card__actions">
                                <button type="button" class="room-details-btn" data-room-details>
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    <span>Room details</span>
                                </button>
                                <a href="decks.html?room=8528" class="view-deck-btn">
                                    <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                                    <span>Locate on deck</span>
                                </a>
                            </div>
                        </div>
                    </article>
                    
                    <!-- Room 4 -->
                    <article class="room-card room-card--ocean-view animate-fade-in" data-room="8612" data-room-type="ocean-view" data-muster-complete="true">
                        <div class="room-card__header">
                            <span class="room-number">4</span>
                            <span class="room-category">Stateroom</span>
                            <div class="room-type">
                                <div class="room-type__icon">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                <h3 class="room-type__name">8612</h3>
                            </div>
                            <span class="room-location">
                                <i class="fas fa-layer-group"></i> Deck 8
                            </span>
                        </div>

                        <div class="room-card__content">
                            <div class="room-features">
                                <span class="feature-tag">
                                    <i class="fas fa-user"></i> 2 guests
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-id-badge"></i> Booking 4406580
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-life-ring"></i> Muster C16
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-ship"></i> Linked sailing record
                                </span>
                            </div>
                            <div class="guest-roster" aria-label="Guests in room 8612">
                                <p class="guest-roster__label"><i class="fas fa-users" aria-hidden="true"></i>Guest Roster</p>
                                <ul class="guest-roster__list">
                                    <li class="guest-pill">Isabella</li>
                                    <li class="guest-pill">Walter</li>
                                </ul>
                            </div>
                            <p class="room-meta-details">Deck 8 room with C16 muster assignment.</p>
                            
                            <div class="room-card__actions">
                                <button type="button" class="room-details-btn" data-room-details>
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    <span>Room details</span>
                                </button>
                                <a href="decks.html?room=8612" class="view-deck-btn">
                                    <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                                    <span>Locate on deck</span>
                                </a>
                            </div>
                        </div>
                    </article>
                    
                    <!-- Room 5 -->
                    <article class="room-card room-card--interior animate-fade-in" data-room="3622" data-room-type="interior" data-muster-complete="false" data-room-priority="attention" data-room-note="Arrival-day check still pending">
                        <div class="room-card__header">
                            <span class="room-number">5</span>
                            <span class="room-category">Interior Room</span>
                            <div class="room-type">
                                <div class="room-type__icon">
                                    <i class="fas fa-bed"></i>
                                </div>
                                <h3 class="room-type__name">3622</h3>
                            </div>
                            <span class="room-location">
                                <i class="fas fa-layer-group"></i> Deck 3 · Forward
                            </span>
                        </div>

                        <div class="room-card__content">
                            <div class="room-features">
                                <span class="feature-tag">
                                    <i class="fas fa-user"></i> 2 guests
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-expand"></i> 160 sq ft
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-moon"></i> Dark sleep environment
                                </span>
                                <span class="feature-tag">
                                    <i class="fas fa-elevator"></i> Forward elevators nearby
                                </span>
                            </div>
                            <div class="guest-roster" aria-label="Guests in room 3622">
                                <p class="guest-roster__label"><i class="fas fa-users" aria-hidden="true"></i>Guest Roster</p>
                                <ul class="guest-roster__list">
                                    <li class="guest-pill">Phoebe</li>
                                    <li class="guest-pill">Ryan</li>
                                </ul>
                            </div>
                            <p class="room-meta-details">Budget-friendly interior room at the front of the ship.</p>
                            
                            <div class="room-card__actions">
                                <button type="button" class="room-details-btn" data-room-details>
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    <span>Room details</span>
                                </button>
                                <a href="decks.html?room=3622" class="view-deck-btn">
                                    <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                                    <span>Locate on deck</span>
                                </a>
                            </div>
                        </div>
                    </article>
                </div>
                <p id="noSearchResults" class="no-search-results" hidden>Try clearing filters or searching by room number (for example: 6650).</p>
            </section>

            <!-- Quick Actions -->
            <section id="quick-actions" class="quick-actions">
                <h2 class="section-title">Quick Actions</h2>
                <p class="section-subtitle">Grouped by task so guests can find the right action faster</p>
                
                <section class="action-group" aria-labelledby="orderingActionsTitle">
                    <h3 id="orderingActionsTitle" class="action-group__title">Ordering</h3>
                    <div class="actions-grid">
                        <a href="index.html" class="action-item rccl-tooltip-target" data-tooltip="Unlock and enter your assigned stateroom.">
                            <div class="action-icon">
                                <i class="fas fa-key" aria-hidden="true"></i>
                            </div>
                            <div class="action-content">
                                <h4>Digital Key</h4>
                                <p>Access your stateroom</p>
                            </div>
                        </a>

                        <a href="dining.html" class="action-item rccl-tooltip-target" data-tooltip="Order meals, drinks, and amenity delivery.">
                            <div class="action-icon">
                                <i class="fas fa-concierge-bell" aria-hidden="true"></i>
                            </div>
                            <div class="action-content">
                                <h4>Room Service</h4>
                                <p>Order food & beverages</p>
                            </div>
                        </a>
                    </div>
                </section>

                <section class="action-group" aria-labelledby="assistanceActionsTitle">
                    <h3 id="assistanceActionsTitle" class="action-group__title">Assistance</h3>
                    <div class="actions-grid">
                        <a href="decks.html" class="action-item rccl-tooltip-target" data-tooltip="Find your room and major ship venues.">
                            <div class="action-icon">
                                <i class="fas fa-map" aria-hidden="true"></i>
                            </div>
                            <div class="action-content">
                                <h4>Deck Plans</h4>
                                <p>Explore ship layout</p>
                            </div>
                        </a>

                        <a href="contacts.html" class="action-item rccl-tooltip-target" data-tooltip="Contact support for cabin questions or issues.">
                            <div class="action-icon">
                                <i class="fas fa-user-headset" aria-hidden="true"></i>
                            </div>
                            <div class="action-content">
                                <h4>Guest Services</h4>
                                <p>Get assistance</p>
                            </div>
                        </a>
                    </div>
                </section>
            </section>
        </div>
    </main>

    <!-- Room Detail Modal -->
    <div id="roomModal" class="room-modal rccl-modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDescription" aria-hidden="true" data-modal>
        <div class="modal-content rccl-modal__content">
            <div class="modal-header rccl-modal__header">
                <h3 id="modalTitle">Room Details</h3>
                <button id="modalCloseBtn" type="button" class="header-action" aria-label="Close room details" data-modal-close>
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <p id="modalDescription" class="modal-description">Review room highlights and continue to deck placement.</p>
            <div id="modalBody" style="padding: 20px 24px 24px;">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <div id="roomComparisonRail" class="comparison-rail" hidden aria-live="polite">
        <div class="comparison-rail__header">
            <h3>Comparing <span id="compareCount">0</span> room(s)</h3>
            <button type="button" id="clearComparisonBtn" class="header-action" aria-label="Close comparison rail">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        <div id="comparisonGrid" class="comparison-grid"></div>
    </div>

    <div id="keyboardHint" class="keyboard-hint" hidden aria-live="polite">
        <kbd>Ctrl</kbd>+<kbd>J</kbd>/<kbd>K</kbd> navigate rooms · <kbd>R</kbd> details · <kbd>D</kbd> deck · <kbd>?</kbd> help
    </div>

    <!-- Footer Placeholder -->
    <div id="sharedFooter"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('roomSearchInput');
            const guestFinderInput = document.getElementById('guestFinderInput');
            const guestFinderList = document.getElementById('guestFinderList');
            const guestFinderQuick = document.getElementById('guestFinderQuick');
            const guestFinderStatus = document.getElementById('guestFinderStatus');
            const guestFinderFavorite = document.getElementById('guestFinderFavorite');
            const guestFinderFavorites = document.getElementById('guestFinderFavorites');
            const guestFinderClear = document.getElementById('guestFinderClear');
            const roomCards = Array.from(document.querySelectorAll('#roomsGridSource .room-card'));
            const focusGrid = document.getElementById('focusGrid');
            const allSetGrid = document.getElementById('allSetGrid');
            const todayFocusSection = document.getElementById('todayFocusSection');
            const allSetSection = document.getElementById('allSetSection');
            const searchSummary = document.getElementById('searchSummary');
            const noSearchResults = document.getElementById('noSearchResults');
            const roomsCountValue = document.querySelector('.rooms-count__number');
            const roomsCount = document.querySelector('.rooms-count');
            const filterToggle = document.getElementById('filterToggle');
            const filterPanel = document.getElementById('filterPanel');
            const mobileStatsToggle = document.getElementById('mobileStatsToggle');
            const statsGridWrap = document.getElementById('statsGridWrap');
            const roomModal = document.getElementById('roomModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalDescription = document.getElementById('modalDescription');
            const modalBody = document.getElementById('modalBody');
            const comparisonRail = document.getElementById('roomComparisonRail');
            const compareCount = document.getElementById('compareCount');
            const comparisonGrid = document.getElementById('comparisonGrid');
            const clearComparisonBtn = document.getElementById('clearComparisonBtn');
            const keyboardHint = document.getElementById('keyboardHint');
            const totalRooms = roomCards.length;

            let activeType = 'all';
            let currentVisibleCards = [];
            let keyboardRoomIndex = 0;
            let currentModalRoomIndex = -1;
            const compareSet = new Set();
            const guestToCards = new Map();
            const GUEST_FAVORITES_KEY = 'rooms-favorite-guests-v1';
            let favoriteGuests = [];

            function computeRoomPriority(card) {
                const musterComplete = card.dataset.musterComplete === 'true';
                const explicitPriority = card.dataset.roomPriority || '';
                if (!musterComplete || explicitPriority === 'urgent') return 3;
                if (card.dataset.linkedRoom || explicitPriority === 'attention') return 2;
                return 1;
            }

            function clearPersonHighlights() {
                roomCards.forEach((card) => card.classList.remove('room-card--person-match'));
            }

            function setGuestFinderStatus(message) {
                if (guestFinderStatus) {
                    guestFinderStatus.textContent = message;
                }
            }

            function normalizeGuestName(name) {
                return String(name || '')
                    .trim()
                    .replace(/\s+/g, ' ')
                    .toLowerCase();
            }

            function toDisplayGuestName(name) {
                return String(name || '')
                    .trim()
                    .replace(/\s+/g, ' ')
                    .split(' ')
                    .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
                    .join(' ');
            }

            function readFavoriteGuests() {
                try {
                    const raw = localStorage.getItem(GUEST_FAVORITES_KEY);
                    const parsed = raw ? JSON.parse(raw) : [];
                    return Array.isArray(parsed) ? parsed.map(normalizeGuestName).filter(Boolean) : [];
                } catch (_error) {
                    return [];
                }
            }

            function writeFavoriteGuests(names) {
                localStorage.setItem(GUEST_FAVORITES_KEY, JSON.stringify(names));
            }

            function renderFavoriteGuests() {
                if (!guestFinderFavorites) return;
                if (!favoriteGuests.length) {
                    guestFinderFavorites.innerHTML = '';
                    return;
                }

                guestFinderFavorites.innerHTML = favoriteGuests.map((name) => (
                    `<button type="button" class="family-finder__quick-btn family-finder__quick-btn--favorite" data-favorite-name="${toDisplayGuestName(name)}">★ ${toDisplayGuestName(name)}</button>`
                )).join('');

                guestFinderFavorites.querySelectorAll('[data-favorite-name]').forEach((button) => {
                    button.addEventListener('click', function() {
                        const name = this.getAttribute('data-favorite-name') || '';
                        guestFinderInput.value = name;
                        runGuestLookup(name);
                    });
                });
            }

            function collectGuestsFromCard(card) {
                return Array.from(card.querySelectorAll('.guest-pill'))
                    .map((pill) => (pill.textContent || '').trim())
                    .filter(Boolean);
            }

            function indexGuests() {
                roomCards.forEach((card) => {
                    collectGuestsFromCard(card).forEach((name) => {
                        const key = name.toLowerCase();
                        const cards = guestToCards.get(key) || [];
                        cards.push(card);
                        guestToCards.set(key, cards);
                    });
                });
            }

            function setRoomTypeFilterAll() {
                activeType = 'all';
                document.querySelectorAll('.room-type-filter').forEach((button) => {
                    const isAll = (button.dataset.roomType || '') === 'all';
                    button.classList.toggle('is-active', isAll);
                    button.setAttribute('aria-checked', String(isAll));
                });
                filterToggle?.classList.remove('filter-btn--active');
                closeFilterPanel();
            }

            function runGuestLookup(rawValue, options = {}) {
                const value = String(rawValue || '').trim();
                if (!value) {
                    clearPersonHighlights();
                    setGuestFinderStatus('');
                    if (options.clearSearch) {
                        searchInput.value = '';
                        updateRoomVisibility();
                    }
                    return;
                }

                setRoomTypeFilterAll();
                searchInput.value = value;
                updateRoomVisibility();

                const normalized = value.toLowerCase();
                const matches = guestToCards.get(normalized) || [];
                const visibleMatches = matches.filter((card) => currentVisibleCards.includes(card));
                const targetCard = visibleMatches[0];

                clearPersonHighlights();
                if (!targetCard) {
                    setGuestFinderStatus(`No room match found for "${value}".`);
                    return;
                }

                targetCard.classList.add('room-card--person-match');
                targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                targetCard.setAttribute('tabindex', '-1');
                targetCard.focus({ preventScroll: true });
                const roomNumber = targetCard.dataset.room || '';
                setGuestFinderStatus(`${value} is in room ${roomNumber}.`);
            }

            function initGuestFinder() {
                if (!guestFinderInput || !guestFinderList) return;

                const allGuestNames = Array.from(guestToCards.keys())
                    .map((key) => toDisplayGuestName(key))
                    .sort((a, b) => a.localeCompare(b));

                guestFinderList.innerHTML = allGuestNames
                    .map((name) => `<option value="${name}"></option>`)
                    .join('');

                if (guestFinderQuick) {
                    guestFinderQuick.innerHTML = allGuestNames.slice(0, 8).map((name) => (
                        `<button type="button" class="family-finder__quick-btn" data-guest-name="${name}">${name}</button>`
                    )).join('');
                    guestFinderQuick.querySelectorAll('[data-guest-name]').forEach((button) => {
                        button.addEventListener('click', function() {
                            const name = this.getAttribute('data-guest-name') || '';
                            guestFinderInput.value = name;
                            runGuestLookup(name);
                        });
                    });
                }

                guestFinderInput.addEventListener('change', function() {
                    runGuestLookup(this.value);
                });

                guestFinderInput.addEventListener('keydown', function(event) {
                    if (event.key !== 'Enter') return;
                    event.preventDefault();
                    runGuestLookup(this.value);
                });

                guestFinderClear?.addEventListener('click', function() {
                    guestFinderInput.value = '';
                    runGuestLookup('', { clearSearch: true });
                    guestFinderInput.focus();
                });

                favoriteGuests = readFavoriteGuests().filter((name) => guestToCards.has(name));
                writeFavoriteGuests(favoriteGuests);
                renderFavoriteGuests();

                guestFinderFavorite?.addEventListener('click', function() {
                    const normalized = normalizeGuestName(guestFinderInput.value);
                    if (!normalized) {
                        setGuestFinderStatus('Enter a guest name before saving a favorite.');
                        return;
                    }
                    if (!guestToCards.has(normalized)) {
                        setGuestFinderStatus(`"${guestFinderInput.value.trim()}" is not in the guest list.`);
                        return;
                    }
                    if (!favoriteGuests.includes(normalized)) {
                        favoriteGuests.unshift(normalized);
                        favoriteGuests = favoriteGuests.slice(0, 8);
                        writeFavoriteGuests(favoriteGuests);
                        renderFavoriteGuests();
                    }
                    setGuestFinderStatus(`${toDisplayGuestName(normalized)} saved to favorites.`);
                });
            }

            function getRoomFacts(card) {
                const roomNumber = card.dataset.room || '';
                const roomType = card.dataset.roomType || 'stateroom';
                const location = card.querySelector('.room-location')?.textContent?.trim() || 'Unknown location';
                const guestCount = card.querySelectorAll('.guest-pill').length;
                const muster = Array.from(card.querySelectorAll('.feature-tag')).map((t) => t.textContent.trim()).find((text) => /muster/i.test(text)) || 'Not listed';
                return { roomNumber, roomType, location, guestCount, muster };
            }

            function renderStatusBadges(card) {
                const header = card.querySelector('.room-card__header');
                if (!header) return;

                const existing = card.querySelector('.room-card__status-bar');
                if (existing) existing.remove();

                const statusBar = document.createElement('div');
                statusBar.className = 'room-card__status-bar';

                const musterComplete = card.dataset.musterComplete === 'true';
                if (musterComplete) {
                    statusBar.insertAdjacentHTML('beforeend', '<span class="status-badge status-badge--success"><i class="fas fa-check-circle" aria-hidden="true"></i>Muster complete</span>');
                } else {
                    statusBar.insertAdjacentHTML('beforeend', '<span class="status-badge status-badge--warning"><i class="fas fa-life-ring" aria-hidden="true"></i>Muster not completed</span>');
                }

                if (card.dataset.linkedRoom) {
                    statusBar.insertAdjacentHTML('beforeend', `<span class="status-badge status-badge--info"><i class="fas fa-link" aria-hidden="true"></i>Linked to ${card.dataset.linkedRoom}</span>`);
                }

                if (card.dataset.roomNote) {
                    statusBar.insertAdjacentHTML('beforeend', `<span class="status-badge status-badge--info"><i class="fas fa-bolt" aria-hidden="true"></i>${card.dataset.roomNote}</span>`);
                }

                header.insertAdjacentElement('beforebegin', statusBar);
            }

            function ensureCompareButton(card) {
                const actions = card.querySelector('.room-card__actions');
                if (!actions || actions.querySelector('.compare-toggle-btn')) return;
                const roomNumber = card.dataset.room || '';
                const compareBtn = document.createElement('button');
                compareBtn.type = 'button';
                compareBtn.className = 'compare-toggle-btn';
                compareBtn.dataset.compareRoom = roomNumber;
                compareBtn.innerHTML = '<i class="fas fa-columns" aria-hidden="true"></i><span>Compare room</span>';
                actions.appendChild(compareBtn);
            }

            function renderComparisonRail() {
                const selected = roomCards.filter((card) => compareSet.has(card.dataset.room));
                compareCount.textContent = String(selected.length);

                if (!selected.length) {
                    comparisonRail.hidden = true;
                    comparisonGrid.innerHTML = '';
                    return;
                }

                comparisonGrid.innerHTML = selected.map((card) => {
                    const facts = getRoomFacts(card);
                    return `
                        <div class="comparison-column">
                            <h4>${facts.roomNumber} · ${facts.roomType.replace('-', ' ')}</h4>
                            <ul class="comparison-list">
                                <li><span>Guests:</span> ${facts.guestCount}</li>
                                <li><span>Location:</span> ${facts.location}</li>
                                <li><span>Muster:</span> ${facts.muster}</li>
                            </ul>
                        </div>
                    `;
                }).join('');

                comparisonRail.hidden = false;
            }

            roomCards.forEach((card) => {
                renderStatusBadges(card);
                ensureCompareButton(card);
            });
            indexGuests();
            initGuestFinder();

            function updateRoomVisibility() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                let visibleCount = 0;
                const visibleCards = [];

                roomCards.forEach((card) => {
                    const roomNumber = card.dataset.room || '';
                    const roomName = card.querySelector('.room-type__name')?.textContent || '';
                    const roomLocation = card.querySelector('.room-location')?.textContent || '';
                    const roomFeatures = card.querySelector('.room-features')?.textContent || '';
                    const roomGuests = collectGuestsFromCard(card).join(' ');
                    const roomType = card.dataset.roomType || 'all';
                    const searchableText = `${roomNumber} ${roomName} ${roomLocation} ${roomFeatures} ${roomGuests}`.toLowerCase();

                    const matchesSearch = !searchTerm || searchableText.includes(searchTerm);
                    const matchesType = activeType === 'all' || roomType === activeType;
                    const shouldShow = matchesSearch && matchesType;

                    if (shouldShow) {
                        visibleCount += 1;
                        visibleCards.push(card);
                    }
                });

                visibleCards.sort((a, b) => computeRoomPriority(b) - computeRoomPriority(a));
                currentVisibleCards = visibleCards;
                keyboardRoomIndex = Math.min(keyboardRoomIndex, Math.max(visibleCards.length - 1, 0));

                if (focusGrid) focusGrid.innerHTML = '';
                if (allSetGrid) allSetGrid.innerHTML = '';

                visibleCards.forEach((card) => {
                    card.hidden = false;
                    card.style.display = 'flex';
                    const priority = computeRoomPriority(card);
                    const compareBtn = card.querySelector('.compare-toggle-btn');
                    const isCompared = compareSet.has(card.dataset.room);
                    compareBtn?.classList.toggle('is-active', isCompared);
                    if (compareBtn) {
                        compareBtn.querySelector('span').textContent = isCompared ? 'Selected for compare' : 'Compare room';
                    }
                    if (priority >= 2 && focusGrid) {
                        focusGrid.appendChild(card);
                    } else if (allSetGrid) {
                        allSetGrid.appendChild(card);
                    }
                });

                if (todayFocusSection) {
                    todayFocusSection.hidden = !focusGrid || focusGrid.children.length === 0;
                }
                if (allSetSection) {
                    allSetSection.hidden = !allSetGrid || allSetGrid.children.length === 0;
                }

                const roomLabel = visibleCount === 1 ? 'room' : 'rooms';
                searchSummary.textContent = `Showing ${visibleCount} of ${totalRooms} ${roomLabel}`;
                roomsCountValue.textContent = String(visibleCount);
                if (roomsCount) {
                    roomsCount.hidden = visibleCount === 0;
                }
                noSearchResults.hidden = visibleCount !== 0;
                renderComparisonRail();
            }

            function closeFilterPanel() {
                if (!filterPanel) return;
                filterPanel.classList.remove('is-open');
                filterToggle.setAttribute('aria-expanded', 'false');
            }

            document.addEventListener('rccl:filter-change', function(event) {
                if (!event.detail || event.detail.group !== 'roomType') return;
                activeType = event.detail.value || 'all';
                filterToggle.classList.toggle('filter-btn--active', activeType !== 'all');
                closeFilterPanel();
                clearPersonHighlights();
                updateRoomVisibility();
            });

            searchInput.addEventListener('input', function() {
                clearPersonHighlights();
                setGuestFinderStatus('');
                updateRoomVisibility();
            });

            function focusedRoomCard() {
                return currentVisibleCards[keyboardRoomIndex] || null;
            }

            function focusRoomAt(index) {
                if (!currentVisibleCards.length) return;
                keyboardRoomIndex = (index + currentVisibleCards.length) % currentVisibleCards.length;
                const card = focusedRoomCard();
                card?.setAttribute('tabindex', '-1');
                card?.focus({ preventScroll: false });
                card?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            function showKeyboardHintTemporarily() {
                if (!keyboardHint) return;
                keyboardHint.hidden = false;
                window.clearTimeout(showKeyboardHintTemporarily._timer);
                showKeyboardHintTemporarily._timer = window.setTimeout(() => {
                    keyboardHint.hidden = true;
                }, 3800);
            }

            function focusedRoomAction(type) {
                const card = focusedRoomCard();
                if (!card) return;
                if (type === 'details') {
                    card.querySelector('[data-room-details]')?.click();
                    return;
                }
                if (type === 'deck') {
                    const deckLink = card.querySelector('.view-deck-btn');
                    if (deckLink) window.location.href = deckLink.href;
                }
            }

            // Keyboard power mode
            document.addEventListener('keydown', function(e) {
                const target = e.target;
                const typingContext = target && (
                    target.tagName === 'INPUT' ||
                    target.tagName === 'TEXTAREA' ||
                    target.isContentEditable
                );

                if (e.key === '/' && !typingContext && e.target !== searchInput) {
                    e.preventDefault();
                    searchInput.focus();
                    return;
                }

                if (e.key === '?') {
                    e.preventDefault();
                    showKeyboardHintTemporarily();
                    return;
                }

                if (typingContext) return;

                if (e.key === 'Escape') {
                    closeRoomModal();
                    if (compareSet.size) {
                        compareSet.clear();
                        roomCards.forEach((card) => {
                            const compareBtn = card.querySelector('.compare-toggle-btn');
                            compareBtn?.classList.remove('is-active');
                            if (compareBtn) compareBtn.querySelector('span').textContent = 'Compare room';
                        });
                        renderComparisonRail();
                    }
                    return;
                }

                if (e.ctrlKey && e.key.toLowerCase() === 'j') {
                    e.preventDefault();
                    focusRoomAt(keyboardRoomIndex + 1);
                    return;
                }

                if (e.ctrlKey && e.key.toLowerCase() === 'k') {
                    e.preventDefault();
                    focusRoomAt(keyboardRoomIndex - 1);
                    return;
                }

                if (e.key.toLowerCase() === 'r') {
                    e.preventDefault();
                    focusedRoomAction('details');
                    return;
                }

                if (e.key.toLowerCase() === 'd') {
                    e.preventDefault();
                    focusedRoomAction('deck');
                }
            });

            if (filterToggle && filterPanel) {
                filterToggle.addEventListener('click', function() {
                    const shouldOpen = !filterPanel.classList.contains('is-open');
                    filterPanel.classList.toggle('is-open', shouldOpen);
                    filterToggle.setAttribute('aria-expanded', String(shouldOpen));
                });

                document.addEventListener('click', function(e) {
                    if (!e.target.closest('[data-filter-root]')) {
                        closeFilterPanel();
                    }
                });

                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeFilterPanel();
                    }
                });
            }

            if (mobileStatsToggle && statsGridWrap) {
                mobileStatsToggle.addEventListener('click', function() {
                    const isOpen = statsGridWrap.classList.toggle('is-open');
                    mobileStatsToggle.setAttribute('aria-expanded', String(isOpen));
                    const label = mobileStatsToggle.querySelector('span');
                    const icon = mobileStatsToggle.querySelector('i');
                    if (label) {
                        label.textContent = isOpen ? 'Hide summary' : 'Show summary';
                    }
                    if (icon) {
                        icon.classList.toggle('fa-chevron-down', !isOpen);
                        icon.classList.toggle('fa-chevron-up', isOpen);
                    }
                    if (isOpen) {
                        const firstStat = statsGridWrap.querySelector('.stat-card');
                        if (firstStat) {
                            firstStat.setAttribute('tabindex', '-1');
                            firstStat.focus();
                        }
                    }
                });
            }

            // Explicit room details button handler to avoid card-level action ambiguity
            roomCards.forEach(card => {
                const detailsBtn = card.querySelector('[data-room-details]');
                if (!detailsBtn) return;

                detailsBtn.addEventListener('click', function() {
                    const roomNumber = card.dataset.room;
                    const roomName = card.querySelector('.room-type__name').textContent;
                    const roomLocation = card.querySelector('.room-location').textContent;
                    showRoomModal(roomNumber, roomName, roomLocation);
                });

                const compareBtn = card.querySelector('.compare-toggle-btn');
                compareBtn?.addEventListener('click', function() {
                    const roomNumber = card.dataset.room;
                    if (!roomNumber) return;
                    if (compareSet.has(roomNumber)) {
                        compareSet.delete(roomNumber);
                    } else {
                        compareSet.add(roomNumber);
                    }
                    compareBtn.classList.toggle('is-active', compareSet.has(roomNumber));
                    compareBtn.querySelector('span').textContent = compareSet.has(roomNumber) ? 'Selected for compare' : 'Compare room';
                    renderComparisonRail();
                });
            });

            // Room modal functions
            function showRoomModal(roomNumber, roomName, location) {
                const roomCard = roomCards.find((card) => card.dataset.room === roomNumber);
                const guestCount = roomCard ? roomCard.querySelectorAll('.guest-pill').length : 2;
                const featureTags = roomCard ? Array.from(roomCard.querySelectorAll('.feature-tag')) : [];
                const sqftTag = featureTags.find((tag) => /sq\s*ft/i.test(tag.textContent || ''));
                const sqftText = sqftTag ? (sqftTag.textContent || '').trim() : 'Size varies';
                const hasBalcony = roomCard ? roomCard.dataset.roomType === 'balcony' : roomName.includes('Balcony');
                const roomTypeName = roomCard
                    ? (roomCard.dataset.roomType || 'stateroom').replace('-', ' ')
                    : 'stateroom';
                const roomDescription = roomCard ? (roomCard.querySelector('.room-meta-details')?.textContent || '').trim() : '';
                const highlights = featureTags
                    .map((tag) => (tag.textContent || '').trim())
                    .filter(Boolean)
                    .filter((text) => !/sq\s*ft/i.test(text))
                    .slice(0, 2);
                modalTitle.textContent = `Room ${roomNumber}`;
                modalDescription.textContent = `${roomTypeName.charAt(0).toUpperCase()}${roomTypeName.slice(1)} details and deck placement.`;
                closeFilterPanel();
                currentModalRoomIndex = currentVisibleCards.findIndex((card) => card.dataset.room === roomNumber);
                
                modalBody.innerHTML = `
                    <div class="modal-room-location">
                        <i class="fas fa-layer-group" aria-hidden="true"></i>
                        <span>${location}</span>
                    </div>

                    <div class="room-highlights-grid">
                        <span class="highlight-badge">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            <span>${guestCount} ${guestCount === 1 ? 'guest' : 'guests'}</span>
                        </span>
                        <span class="highlight-badge">
                            <i class="fas fa-expand" aria-hidden="true"></i>
                            <span>${sqftText}</span>
                        </span>
                        ${hasBalcony ? `
                        <span class="highlight-badge">
                            <i class="fas fa-wind" aria-hidden="true"></i>
                            <span>Private balcony</span>
                        </span>
                        ` : ''}
                        ${highlights.map((text) => `
                        <span class="highlight-badge">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                            <span>${text}</span>
                        </span>
                        `).join('')}
                    </div>

                    <p class="modal-body-copy">${roomDescription || 'Use deck view to confirm nearby elevators and venue access before arrival.'}</p>
                    <p class="modal-hint">Opens deck plan focused on room ${roomNumber}.</p>

                    <div class="modal-actions">
                        <button type="button" class="modal-secondary-btn modal-prev-room">
                            <i class="fas fa-chevron-left" aria-hidden="true"></i>
                            <span>Previous room</span>
                        </button>
                        <button type="button" class="modal-secondary-btn modal-next-room">
                            <i class="fas fa-chevron-right" aria-hidden="true"></i>
                            <span>Next room</span>
                        </button>
                        <a href="decks.html?room=${roomNumber}" class="modal-primary-btn">
                            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                            <span>Show on deck plan</span>
                        </a>
                        <button type="button" class="modal-secondary-btn modal-continue-room">
                            <i class="fas fa-arrow-left" aria-hidden="true"></i>
                            <span>Continue browsing</span>
                        </button>
                    </div>
                `;

                if (window.RCCLModal && typeof window.RCCLModal.open === 'function') {
                    window.RCCLModal.open('roomModal');
                } else {
                    roomModal.classList.add('room-modal--open');
                }
                const modalContinue = modalBody.querySelector('.modal-continue-room');
                modalContinue?.focus();
                modalContinue?.addEventListener('click', closeRoomModal, { once: true });
                modalBody.querySelector('.modal-prev-room')?.addEventListener('click', function() {
                    moveModalRoom(-1);
                });
                modalBody.querySelector('.modal-next-room')?.addEventListener('click', function() {
                    moveModalRoom(1);
                });
            }

            function moveModalRoom(step) {
                if (!currentVisibleCards.length) return;
                if (currentModalRoomIndex < 0) {
                    currentModalRoomIndex = 0;
                } else {
                    currentModalRoomIndex = (currentModalRoomIndex + step + currentVisibleCards.length) % currentVisibleCards.length;
                }
                const card = currentVisibleCards[currentModalRoomIndex];
                if (!card) return;
                const roomNumber = card.dataset.room;
                const roomName = card.querySelector('.room-type__name')?.textContent || roomNumber;
                const roomLocation = card.querySelector('.room-location')?.textContent || 'Unknown location';
                showRoomModal(roomNumber, roomName, roomLocation);
            }

            function closeRoomModal() {
                if (window.RCCLModal && typeof window.RCCLModal.close === 'function') {
                    window.RCCLModal.close('roomModal');
                } else {
                    roomModal.classList.remove('room-modal--open');
                }
            }

            // Filter buttons
            const filterButtons = document.querySelectorAll('.filter-link');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (this.getAttribute('href').startsWith('#')) {
                        e.preventDefault();

                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 80,
                                behavior: 'smooth'
                            });
                        }
                    }
                });
            });

            // Initialize animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.remove('is-reveal-pending');
                        entry.target.classList.add('animate-fade-in');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.stat-card, .room-card, .action-item').forEach(el => {
                el.classList.remove('animate-fade-in');
                el.classList.add('is-reveal-pending');
                observer.observe(el);
            });

            updateRoomVisibility();

            clearComparisonBtn?.addEventListener('click', function() {
                compareSet.clear();
                roomCards.forEach((card) => {
                    const compareBtn = card.querySelector('.compare-toggle-btn');
                    compareBtn?.classList.remove('is-active');
                    if (compareBtn) compareBtn.querySelector('span').textContent = 'Compare room';
                });
                renderComparisonRail();
            });

            let modalTouchStartX = 0;
            let modalTouchStartY = 0;
            roomModal?.addEventListener('touchstart', function(e) {
                const touch = e.touches[0];
                if (!touch) return;
                modalTouchStartX = touch.clientX;
                modalTouchStartY = touch.clientY;
            }, { passive: true });

            roomModal?.addEventListener('touchend', function(e) {
                const touch = e.changedTouches[0];
                const modalIsOpen = roomModal.getAttribute('aria-hidden') === 'false' || roomModal.classList.contains('room-modal--open');
                if (!touch || !modalIsOpen) return;
                const dx = touch.clientX - modalTouchStartX;
                const dy = touch.clientY - modalTouchStartY;
                if (Math.abs(dx) < 80 || Math.abs(dx) < Math.abs(dy) * 1.5) return;
                moveModalRoom(dx > 0 ? -1 : 1);
            });

            // Floating toasts removed per UX update.
        });
    </script>
</body>
</html>
