<!DOCTYPE html>
<html lang="en" data-theme="light" data-theme-mode="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#cfeaff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg">
    <title>Royal Caribbean Itinerary | Adventure of the Seas</title>
    <meta name="description" content="Your complete 7-day Western Caribbean cruise itinerary with daily schedules, port information, and onboard activities.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/base.css?v=3">
  <link rel="stylesheet" href="css/utilities.css?v=3">
  <link rel="stylesheet" href="css/components.css?v=3">
    <link rel="stylesheet" href="css/feature-modules.css?v=3">
    <link rel="stylesheet" href="css/mobile-first.css">
  <script src="js/shared-layout.js?v=17" defer></script>
  <link rel="stylesheet" href="css/pages/itinerary.css?v=2">
</head>
<body class="app-theme-rcc itinerary-page page-shell">
    <a href="#main" class="skip-link">Skip to main content</a>
    <!-- Header Placeholder -->
    <div id="sharedHeader" data-page="itinerary"></div>

    <!-- Hero Section -->
    <section class="hero hero--itinerary">
        <div class="container">
            <div class="hero__content">
                <span class="hero__badge">7-Day Western Caribbean</span>
                <h1 class="hero__title">Itinerary</h1>
                <p class="hero__contextline" id="cruiseModeLine">Your complete day-by-day cruise flow.</p>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main id="main" class="main" aria-label="Itinerary">
        <div class="container">
            <!-- Day Navigation -->
            <section class="day-navigation" id="today">
                <div class="day-navigation__header">
                    <h2 class="day-navigation__title">The Week</h2>
                </div>
                <div class="day-selector" id="daySelector" role="toolbar" aria-label="Select itinerary day">
                    <button type="button" class="day-btn day-btn--active" data-day="1" aria-pressed="true">
                        <i class="fas fa-ship"></i> Day 1
                    </button>
                    <button type="button" class="day-btn" data-day="2" aria-pressed="false">
                        <i class="fas fa-water"></i> Day 2
                    </button>
                    <button type="button" class="day-btn" data-day="3" aria-pressed="false">
                        <i class="fas fa-umbrella-beach"></i> Day 3
                    </button>
                    <button type="button" class="day-btn" data-day="4" aria-pressed="false">
                        <i class="fas fa-mountain"></i> Day 4
                    </button>
                    <button type="button" class="day-btn" data-day="5" aria-pressed="false">
                        <i class="fas fa-utensils"></i> Day 5
                    </button>
                    <button type="button" class="day-btn" data-day="6" aria-pressed="false">
                        <i class="fas fa-swimming-pool"></i> Day 6
                    </button>
                    <button type="button" class="day-btn" data-day="7" aria-pressed="false">
                        <i class="fas fa-suitcase-rolling"></i> Day 7
                    </button>
                </div>
                <div class="hero__actions itinerary-actions" aria-label="Itinerary actions">
                    <button type="button" class="btn btn--secondary" id="shareItineraryBtn">
                        <i class="fas fa-share-alt" aria-hidden="true"></i> Share
                    </button>
                    <button type="button" class="btn btn--secondary" id="printItineraryBtn">
                        <i class="fas fa-print" aria-hidden="true"></i> Print
                    </button>
                    <button type="button" class="btn btn--secondary" id="savePDFBtn">
                        <i class="fas fa-file-pdf" aria-hidden="true"></i> Save PDF
                    </button>
                    <button type="button" class="btn btn--secondary" id="addToCalendarBtn">
                        <i class="fas fa-calendar-plus" aria-hidden="true"></i> Calendar
                    </button>
                    <button type="button" class="btn btn--secondary" id="emailItineraryBtn">
                        <i class="fas fa-envelope" aria-hidden="true"></i> Email
                    </button>
                </div>
                <p id="itineraryStatus" class="search-status" role="status" aria-live="polite">Ready.</p>
            </section>

            <!-- Itinerary Days -->
            <div class="itinerary-days">
                <!-- Day 1 -->
                <div class="itinerary-day" data-day="1">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 1 • Saturday, February 14</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Embarkation Day</span>
                                <span class="badge badge--accent">Valentine's Day</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--critical">Port Canaveral</span>
                            <span class="tag tag--info">All aboard 2:00 PM · Sail away ~4:00 PM</span>
                        </div>
                    </div>

                    <div class="timeline-section">
                        <h3 class="timeline-section__title">
                            <i class="fas fa-sun"></i> Morning
                        </h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time">
                                    <i class="far fa-clock"></i> 7:00 AM
                                </div>
                                <h4 class="timeline__title">Depart Orlando Hotel</h4>
                                <p class="timeline__description">Shuttle departs from hotel lobby for Port Canaveral</p>
                                <div class="timeline__meta">
                                    <span class="tag tag--info">Duration: 45 min</span>
                                </div>
                            </div>

                            <div class="timeline-item timeline-item--critical">
                                <div class="timeline__time">
                                    <i class="far fa-clock"></i> 12:00 PM
                                </div>
                                <h4 class="timeline__title">Check-in window opens</h4>
                                <p class="timeline__description">Shared linked reservation check-in time</p>
                                <div class="timeline__meta">
                                    <span class="tag tag--critical">Passport & SetSail Pass Required</span>
                                </div>
                            </div>

                            <div class="timeline-item timeline-item--critical">
                                <div class="timeline__time">
                                    <i class="far fa-clock"></i> 2:00 PM
                                </div>
                                <h4 class="timeline__title">All aboard cutoff</h4>
                                <p class="timeline__description">All linked reservations must be back onboard</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card__title">
                            <i class="fas fa-exclamation-circle"></i> Day 1 Essentials
                        </h3>
                        <ul class="list--checkmarks">
                            <li>Have passports and <span class="term-help" aria-label="SetSail is Royal Caribbean's digital boarding pass and check-in flow" title="SetSail is Royal Caribbean's digital boarding pass and check-in flow">SetSail</span> passes ready</li>
                            <li>Complete eMuster shortly after boarding</li>
                            <li>Carry-on bag with essentials until stateroom ready</li>
                            <li>Sail away photos around 4:00 PM</li>
                        </ul>
                    </div>
                </div>

                <!-- Day 2 -->
                <div class="itinerary-day" data-day="2">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 2 • Sunday, February 15</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Sea Day</span>
                                <span class="badge badge--accent">First Formal Night</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--info">At sea</span>
                        </div>
                    </div>

                    <div class="alert alert--info">
                        <strong>Sea Day Activities:</strong> Full day of onboard activities. Pool deck gets crowded early.
                    </div>

                    <div class="timeline-section">
                        <h3 class="timeline-section__title">Morning Activities</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time">
                                    <i class="far fa-clock"></i> 9:00 AM
                                </div>
                                <h4 class="timeline__title">FlowRider® Surf Lessons</h4>
                                <p class="timeline__description">Deck 13 aft • Sign up early at Sports Deck</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 2:00 PM</div>
                                <h4 class="timeline__title">Onboard planning window</h4>
                                <p class="timeline__description">Review Day 3 tender timing and shore plan before dinner.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time">
                                    <i class="far fa-clock"></i> 6:00 PM
                                </div>
                                <h4 class="timeline__title">Formal dinner seating</h4>
                                <p class="timeline__description">Main Dining and specialty windows open for formal night.</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card__title">
                            <i class="fas fa-route"></i> Day 2 Logistics & Next Actions
                        </h3>
                        <ul class="list--checkmarks">
                            <li>Reserve tonight's dinner window before 3:00 PM</li>
                            <li>Confirm tomorrow's Grand Cayman excursion check-in point</li>
                            <li>Use deck map for evening venue routes</li>
                        </ul>
                        <p><a href="dining.html">Dining reservations</a> · <a href="decks.html">Deck routes</a> · <a href="rooms.html">Return to staterooms</a></p>
                    </div>
                </div>

                <!-- Day 3 -->
                <div class="itinerary-day" data-day="3">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 3 • Monday, February 16</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Port Day</span>
                                <span class="badge badge--accent">Grand Cayman</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--critical">Tender Port</span>
                            <span class="tag tag--info">All aboard 5:15 PM</span>
                        </div>
                    </div>

                    <div class="timeline-section">
                        <h3 class="timeline-section__title">Port Plan</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 11:00 AM</div>
                                <h4 class="timeline__title">Gangway opens (tender)</h4>
                                <p class="timeline__description">Tender launch sequence begins for George Town.</p>
                            </div>
                            <div class="timeline-item timeline-item--critical">
                                <div class="timeline__time"><i class="far fa-clock"></i> 4:30 PM</div>
                                <h4 class="timeline__title">Start return-to-ship window</h4>
                                <p class="timeline__description">Build buffer for tender lines before the 5:15 PM all-aboard cutoff.</p>
                            </div>
                            <div class="timeline-item timeline-item--critical">
                                <div class="timeline__time"><i class="far fa-clock"></i> 5:15 PM</div>
                                <h4 class="timeline__title">All-aboard cutoff</h4>
                                <p class="timeline__description">All guests must be back onboard by this deadline.</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card__title"><i class="fas fa-map-pin"></i> Logistics</h3>
                        <ul class="list--checkmarks">
                            <li>Tender waits can spike after 9:30 AM</li>
                            <li>Carry ship card, photo ID, and contact card</li>
                            <li>Start return by 4:30 PM to avoid tender rush</li>
                        </ul>
                        <p><a href="ports.html">Port spotlight</a> · <a href="contacts.html#ports">Port contacts</a></p>
                    </div>
                </div>

                <!-- Day 4 -->
                <div class="itinerary-day" data-day="4">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 4 • Tuesday, February 17</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Port Day</span>
                                <span class="badge badge--accent">Falmouth, Jamaica</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--info">Walk-off access</span>
                            <span class="tag tag--info">All aboard 4:30 PM</span>
                        </div>
                    </div>
                    <div class="timeline-section">
                        <h3 class="timeline-section__title">Port Plan</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 8:30 AM</div>
                                <h4 class="timeline__title">Arrival and disembarkation</h4>
                                <p class="timeline__description">Walk-off available directly from gangway.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 9:15 AM</div>
                                <h4 class="timeline__title">Excursion meet-up</h4>
                                <p class="timeline__description">Dunn's River Falls groups meet in terminal zone B.</p>
                            </div>
                            <div class="timeline-item timeline-item--critical">
                                <div class="timeline__time"><i class="far fa-clock"></i> 4:30 PM</div>
                                <h4 class="timeline__title">All-aboard cutoff</h4>
                                <p class="timeline__description">Return to ship before final departure checks.</p>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <h3 class="info-card__title"><i class="fas fa-route"></i> Logistics</h3>
                        <ul class="list--checkmarks">
                            <li>Cash and cards both recommended for port vendors</li>
                            <li>Rain shell + water shoes for falls excursions</li>
                            <li>Reboard buffer: 45 minutes minimum</li>
                        </ul>
                        <p><a href="ports.html">Port spotlight</a> · <a href="contacts.html#ports">Port contacts</a></p>
                    </div>
                </div>

                <!-- Day 5 -->
                <div class="itinerary-day" data-day="5">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 5 • Wednesday, February 18</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Sea Day</span>
                                <span class="badge badge--accent">Second Formal Night</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--info">At sea</span>
                        </div>
                    </div>
                    <div class="timeline-section">
                        <h3 class="timeline-section__title">Onboard Plan</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 10:00 AM</div>
                                <h4 class="timeline__title">Pool and activity window</h4>
                                <p class="timeline__description">Best time for lighter crowds on top decks.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 6:00 PM</div>
                                <h4 class="timeline__title">Formal dinner</h4>
                                <p class="timeline__description">Main Dining and specialty dress-up windows.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 8:30 PM</div>
                                <h4 class="timeline__title">Evening venue block</h4>
                                <p class="timeline__description">Theater and promenade traffic peaks after dinner seating.</p>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <h3 class="info-card__title"><i class="fas fa-utensils"></i> Logistics</h3>
                        <ul class="list--checkmarks">
                            <li>Lock dinner reservation before afternoon events</li>
                            <li>Plan stateroom change window before dinner</li>
                            <li>Use deck map for theater-to-dinner route timing</li>
                        </ul>
                        <p><a href="dining.html">Dining plan</a> · <a href="decks.html">Venue routing</a></p>
                    </div>
                </div>

                <!-- Day 6 -->
                <div class="itinerary-day" data-day="6">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 6 • Thursday, February 19</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Port Day</span>
                                <span class="badge badge--accent">Perfect Day at CocoCay</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--info">Private island</span>
                            <span class="tag tag--info">All aboard 4:30 PM</span>
                        </div>
                    </div>
                    <div class="timeline-section">
                        <h3 class="timeline-section__title">Island Plan</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 7:30 AM</div>
                                <h4 class="timeline__title">First gangway window</h4>
                                <p class="timeline__description">Early departure for beach chairs and park lockers.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 1:00 PM</div>
                                <h4 class="timeline__title">Peak heat break</h4>
                                <p class="timeline__description">Hydration and shade window before afternoon activities.</p>
                            </div>
                            <div class="timeline-item timeline-item--critical">
                                <div class="timeline__time"><i class="far fa-clock"></i> 4:30 PM</div>
                                <h4 class="timeline__title">All-aboard cutoff</h4>
                                <p class="timeline__description">Return to ship and clear security before departure.</p>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <h3 class="info-card__title"><i class="fas fa-umbrella-beach"></i> Logistics</h3>
                        <ul class="list--checkmarks">
                            <li>Waterproof pouch, sunscreen, and towels in day bag</li>
                            <li>Set return alarm 90 minutes before all aboard</li>
                            <li>Use contacts page for missed-meeting contingency</li>
                        </ul>
                        <p><a href="ports.html">Port spotlight</a> · <a href="contacts.html#ports">Port contacts</a></p>
                    </div>
                </div>

                <!-- Day 7 -->
                <div class="itinerary-day" data-day="7">
                    <div class="itinerary-day__header">
                        <div>
                            <h2 class="itinerary-day__title">Day 7 • Friday, February 20</h2>
                            <div class="itinerary-day__badges">
                                <span class="badge badge--primary">Disembarkation</span>
                                <span class="badge badge--accent">Port Canaveral</span>
                            </div>
                        </div>
                        <div class="itinerary-day__tags">
                            <span class="tag tag--critical">Luggage tags required</span>
                        </div>
                    </div>
                    <div class="timeline-section">
                        <h3 class="timeline-section__title">Departure Plan</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 7:30 AM</div>
                                <h4 class="timeline__title">Gangway / departure opens</h4>
                                <p class="timeline__description">Begin disembarkation with travel docs ready.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 6:30 AM</div>
                                <h4 class="timeline__title">Final cabin sweep</h4>
                                <p class="timeline__description">Check drawers, safe, chargers, and travel docs before leaving stateroom.</p>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline__time"><i class="far fa-clock"></i> 8:30 AM</div>
                                <h4 class="timeline__title">Transfer departure window</h4>
                                <p class="timeline__description">Meet pre-booked airport transfer or parking shuttle.</p>
                            </div>
                        </div>
                    </div>
                    <div class="info-card">
                        <h3 class="info-card__title"><i class="fas fa-suitcase-rolling"></i> Logistics</h3>
                        <ul class="list--checkmarks">
                            <li>Place tagged bags out night before by 10:00 PM</li>
                            <li>Carry meds, valuables, and travel docs personally</li>
                            <li>Confirm airport transfer and pickup point before leaving ship</li>
                        </ul>
                        <p><a href="operations.html">Departure checklist</a> · <a href="contacts.html#backup">Transfer contacts</a></p>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer Placeholder -->
    <div id="sharedFooter"></div>

    <div id="itineraryLegendModal" class="rccl-modal" role="dialog" aria-modal="true" aria-labelledby="legendTitle" aria-describedby="legendBody" aria-hidden="true" data-modal>
        <div class="rccl-modal__content">
            <div class="rccl-modal__header">
                <h3 id="legendTitle">Tag Legend</h3>
                <button type="button" class="header-action" aria-label="Close legend" data-modal-close>
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div id="legendBody">
                <p class="legend-intro">Use this legend when scanning day cards and timeline tags.</p>
                <ul class="list--checkmarks">
                    <li><strong>Critical:</strong> hard cutoffs like all-aboard times</li>
                    <li><strong>Info:</strong> useful context for pacing and movement</li>
                    <li><strong>Success:</strong> completed or confirmed items only</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dayButtons = Array.from(document.querySelectorAll('.day-btn'));
            const daySections = Array.from(document.querySelectorAll('.itinerary-day'));

            // Wrap day details into a body container for smooth collapse
            daySections.forEach(section => {
                const header = section.querySelector('.itinerary-day__header');
                if (!header) return;
                const body = document.createElement('div');
                body.className = 'itinerary-day__body';
                const toMove = [];
                let node = header.nextElementSibling;
                while (node) { toMove.push(node); node = node.nextElementSibling; }
                toMove.forEach(n => body.appendChild(n));
                section.appendChild(body);
            });

            const shareButton = document.getElementById('shareItineraryBtn');
            const printButton = document.getElementById('printItineraryBtn');
            const savePdfButton = document.getElementById('savePDFBtn');
            const calendarButton = document.getElementById('addToCalendarBtn');
            const emailButton = document.getElementById('emailItineraryBtn');
            const itineraryStatus = document.getElementById('itineraryStatus');
            const cruiseModeLine = document.getElementById('cruiseModeLine');
            let currentDay = 1;
            let todayDay = '1';

            function setStatus(message) {
                if (itineraryStatus) {
                    itineraryStatus.textContent = message;
                }
            }

            function getCruiseDayContext() {
                const cruiseStart = new Date('2026-02-14T00:00:00');
                const cruiseEnd = new Date('2026-02-20T23:59:59');
                const now = new Date();
                if (now < cruiseStart) {
                    return { day: 1, label: 'Pre-cruise view: showing Day 1 by default.' };
                }
                if (now > cruiseEnd) {
                    return { day: 7, label: 'Sailing complete: showing Day 7 wrap-up.' };
                }
                const diffDays = Math.floor((now - cruiseStart) / (1000 * 60 * 60 * 24)) + 1;
                const day = Math.max(1, Math.min(7, diffDays));
                return { day, label: `Current sailing day: Day ${day}.` };
            }

            function showDay(day) {
                const normalizedDay = String(day);
                // Determine tomorrow/next relative to 'todayDay'
                const tomorrow = Math.min(7, Number(todayDay) + 1);
                const next = Math.min(7, Number(todayDay) + 2);

                daySections.forEach(section => {
                    const d = Number(section.dataset.day);
                    const isCurrent = section.dataset.day === normalizedDay;
                    const isToday = section.dataset.day === todayDay;

                    section.setAttribute('data-today', isToday ? 'true' : 'false');
                    section.classList.toggle('itinerary-day--today', isToday);
                    section.classList.toggle('itinerary-day--tomorrow', d === tomorrow);
                    section.classList.toggle('itinerary-day--next', d === next);

                    // Collapse non-selected days; expand selected
                    section.classList.toggle('is-collapsed', !isCurrent);

                    // Maintain today anchor id for pulse/scroll
                    if (isToday) {
                        section.id = 'today-card';
                    } else if (section.id === 'today-card') {
                        section.removeAttribute('id');
                    }

                    // Today badge management
                    const badgeContainer = section.querySelector('.itinerary-day__badges');
                    if (badgeContainer) {
                        const existingTodayBadge = badgeContainer.querySelector('.badge--today');
                        if (isToday && !existingTodayBadge) {
                            badgeContainer.insertAdjacentHTML('afterbegin', '<span class="badge badge--today">Today</span>');
                        } else if (!isToday && existingTodayBadge) {
                            existingTodayBadge.remove();
                        }
                    }

                    // Port/Sea subtle classification
                    const badgesText = (section.querySelector('.itinerary-day__badges')?.textContent || '').toLowerCase();
                    section.classList.toggle('is-port', badgesText.includes('port day'));
                    section.classList.toggle('is-sea', badgesText.includes('sea day'));
                });

                dayButtons.forEach(btn => {
                    const isActive = btn.dataset.day === normalizedDay;
                    btn.classList.toggle('day-btn--active', isActive);
                    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
                    if (isActive) {
                        btn.setAttribute('aria-current', 'true');
                    } else {
                        btn.removeAttribute('aria-current');
                    }
                });
                currentDay = Number(day);
            }

            function scrollToDay(day, behavior = 'smooth') {
                const target = document.querySelector(`.itinerary-day[data-day="${String(day)}"]`);
                if (!target) return;
                target.scrollIntoView({ behavior, block: 'start' });
            }

            function pulseTodayTarget() {
                const target = document.getElementById('today-card') || document.querySelector('.itinerary-day[data-today="true"]');
                if (!target) return;
                target.classList.remove('itinerary-day--today-pulse');
                window.requestAnimationFrame(() => {
                    target.classList.add('itinerary-day--today-pulse');
                });
                window.setTimeout(() => {
                    target.classList.remove('itinerary-day--today-pulse');
                }, 1250);
            }

            dayButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const nextDay = Number(this.dataset.day);
                    if (!Number.isNaN(nextDay)) {
                        showDay(nextDay);
                        setStatus(`Viewing Day ${nextDay}.`);
                        const target = document.querySelector(`.itinerary-day[data-day="${this.dataset.day}"]`);
                        target?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });

            if (shareButton) {
                shareButton.addEventListener('click', async () => {
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: 'Royal Caribbean Itinerary',
                                text: 'Check out our cruise itinerary.',
                                url: window.location.href
                            });
                            setStatus('Shared successfully.');
                        } catch (err) {
                            setStatus('Share cancelled.');
                        }
                    } else {
                        navigator.clipboard.writeText(window.location.href)
                            .then(() => setStatus('Link copied to clipboard.'))
                            .catch(() => setStatus('Unable to copy link.'));
                    }
                });
            }

            if (printButton) {
                printButton.addEventListener('click', () => {
                    window.print();
                });
            }

            if (savePdfButton) {
                savePdfButton.addEventListener('click', () => {
                    window.print();
                });
            }

            if (calendarButton) {
                calendarButton.addEventListener('click', () => {
                    setStatus('Add to calendar is coming next.');
                });
            }

            if (emailButton) {
                emailButton.addEventListener('click', () => {
                    window.location.href = `mailto:?subject=${encodeURIComponent('Cruise Itinerary')}&body=${encodeURIComponent(window.location.href)}`;
                });
            }

            const context = getCruiseDayContext();
            todayDay = String(context.day);
            showDay(context.day);

            // Collapse all non-selected days on load
            daySections.forEach(s => {
                if (Number(s.dataset.day) !== context.day) s.classList.add("is-collapsed");
            });

            // Make day headers toggle expansion
            daySections.forEach(section => {
                const header = section.querySelector('.itinerary-day__header');
                if (!header) return;
                header.setAttribute('role', 'button');
                header.setAttribute('tabindex', '0');
                header.addEventListener('click', () => showDay(Number(section.dataset.day)));
                header.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showDay(Number(section.dataset.day)); }
                });
            });

            setStatus(context.label);
            if (cruiseModeLine) {
                if (context.day <= 1) {
                    cruiseModeLine.textContent = 'Embark day is close. Keep timing simple and stress-free.';
                } else if (context.day >= 7) {
                    cruiseModeLine.textContent = 'Final day flow. Keep transfers and documents ready.';
                } else {
                    cruiseModeLine.textContent = `Sea/port rhythm for Day ${context.day}. Relaxed pace, clear timing.`;
                }
            }

            if (window.location.hash === '#today') {
                window.setTimeout(() => {
                    scrollToDay(context.day, 'smooth');
                    pulseTodayTarget();
                }, 120);
            }

            window.addEventListener('hashchange', () => {
                if (window.location.hash !== '#today') return;
                scrollToDay(context.day, 'smooth');
                pulseTodayTarget();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' && currentDay > 1) {
                    showDay(currentDay - 1);
                } else if (e.key === 'ArrowRight' && currentDay < 7) {
                    showDay(currentDay + 1);
                } else {
                    return;
                }
                setStatus(`Viewing Day ${currentDay}.`);
            });
        });
    </script>
</body>
</html>
