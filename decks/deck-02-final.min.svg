<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Deck Navigator Â· Adventure of the Seas</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* ===== BASIC STYLES TRIMMED FOR FOCUS ===== */
body { font-family: Inter, sans-serif; margin:0; background:#f0f6fb; }
.deck-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:1rem; padding:2rem; }
.deck-card { background:white; padding:1.5rem; border-radius:16px; cursor:pointer; box-shadow:0 10px 25px rgba(0,0,0,.08); text-align:center; }
.deck-card:hover { transform:translateY(-4px); }
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; }
.modal-backdrop.is-open { display:flex; }
.modal { width:min(95%,1100px); height:90vh; background:white; border-radius:20px; display:flex; flex-direction:column; overflow:hidden; }
.modal-header { padding:1rem 1.5rem; background:#0a2e4a; color:white; display:flex; justify-content:space-between; align-items:center; }
.plan-viewer { flex:1; background:#0a2e4a; position:relative; overflow:hidden; display:flex; align-items:center; justify-content:center; }
.plan-content { transform-origin:0 0; }
.plan-content svg { display:block; }
.zoom-bar { padding:.75rem; background:#f5f8fb; text-align:center; }
button { cursor:pointer; }
</style>
</head>
<body>

<div class="deck-grid" id="deckGrid"></div>

<div id="modalBackdrop" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div id="modalTitle"></div>
      <button id="closeBtn"><i class="fas fa-times"></i></button>
    </div>
    <div class="plan-viewer">
      <div id="planContent" class="plan-content"></div>
    </div>
    <div class="zoom-bar">
      <button id="zoomIn">+</button>
      <button id="zoomOut">-</button>
      <button id="zoomFit">Fit</button>
    </div>
  </div>
</div>

<script>
(() => {
'use strict';

/* ============================
   CONFIG
============================ */
const DEBUG = false;

const DECKS = [
  {n:15},{n:14},{n:13},{n:12},{n:11},
  {n:10},{n:9},{n:8},{n:7},{n:6},
  {n:5},{n:4},{n:3},{n:2}
];

const MIN_ZOOM = 0.65;
const MAX_ZOOM = 6;
const ZOOM_STEP = 0.18;

/* ============================
   DOM
============================ */
const grid = document.getElementById('deckGrid');
const backdrop = document.getElementById('modalBackdrop');
const title = document.getElementById('modalTitle');
const closeBtn = document.getElementById('closeBtn');
const content = document.getElementById('planContent');
const zoomInBtn = document.getElementById('zoomIn');
const zoomOutBtn = document.getElementById('zoomOut');
const zoomFitBtn = document.getElementById('zoomFit');

/* ============================
   STATE
============================ */
let scale = 1;
let tx = 0;
let ty = 0;
let contentW = 800;
let contentH = 600;

/* ============================
   SVG PATH FIX
============================ */
function svgPath(n) {
  return `decks/deck-${String(n).padStart(2,'0')}-final.min.svg`;
}

/* ============================
   LOAD DECK
============================ */
async function loadDeck(deck) {

  const path = svgPath(deck.n);

  if (DEBUG) console.log("Fetching:", path);

  try {
    const res = await fetch(path);

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }

    const text = await res.text();

    if (!text.includes("<svg")) {
      throw new Error("Invalid SVG content");
    }

    const doc = new DOMParser().parseFromString(text, "image/svg+xml");
    const svg = doc.querySelector("svg");

    if (!svg) throw new Error("SVG root missing");

    if (!svg.getAttribute("viewBox")) {
      const w = parseFloat(svg.getAttribute("width")) || 800;
      const h = parseFloat(svg.getAttribute("height")) || 600;
      svg.setAttribute("viewBox", `0 0 ${w} ${h}`);
    }

    svg.removeAttribute("width");
    svg.removeAttribute("height");
    svg.setAttribute("preserveAspectRatio","xMidYMid meet");

    content.innerHTML = "";
    content.appendChild(svg);

    const vb = svg.getAttribute("viewBox").split(" ").map(Number);
    contentW = vb[2];
    contentH = vb[3];

    fitToScreen();

  } catch (err) {
    console.error("SVG load failed:", err);
    renderFallback(deck);
  }
}

/* ============================
   FALLBACK
============================ */
function renderFallback(deck) {
  content.innerHTML = `
    <svg viewBox="0 0 800 600">
      <rect width="800" height="600" fill="#0f4f76"/>
      <text x="400" y="300" font-size="60" fill="white" text-anchor="middle">
        Deck ${deck.n}
      </text>
    </svg>
  `;
  contentW = 800;
  contentH = 600;
  fitToScreen();
}

/* ============================
   TRANSFORM
============================ */
function applyTransform() {
  content.style.transform = `translate(${tx}px,${ty}px) scale(${scale})`;
}

function fitToScreen() {
  const rect = backdrop.getBoundingClientRect();
  const s = Math.min(rect.width/contentW, rect.height/contentH);
  scale = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, s));
  tx = (rect.width - contentW*scale)/2;
  ty = (rect.height - contentH*scale)/2;
  applyTransform();
}

/* ============================
   GRID
============================ */
DECKS.forEach(deck => {
  const card = document.createElement("div");
  card.className = "deck-card";
  card.textContent = `Deck ${deck.n}`;
  card.onclick = () => {
    backdrop.classList.add("is-open");
    title.textContent = `Deck ${deck.n}`;
    loadDeck(deck);
  };
  grid.appendChild(card);
});

/* ============================
   CONTROLS
============================ */
closeBtn.onclick = () => {
  backdrop.classList.remove("is-open");
  content.innerHTML = "";
};

zoomInBtn.onclick = () => {
  scale = Math.min(MAX_ZOOM, scale*(1+ZOOM_STEP));
  applyTransform();
};

zoomOutBtn.onclick = () => {
  scale = Math.max(MIN_ZOOM, scale/(1+ZOOM_STEP));
  applyTransform();
};

zoomFitBtn.onclick = fitToScreen;

})();
</script>
</body>
</html>