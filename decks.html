<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Adventure of the Seas · Deck Navigator</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
/* Minimal style kept identical to prior version */
html,body{margin:0;padding:0;height:100%;overflow:hidden;font-family:Inter,system-ui;}
body{
  background:linear-gradient(180deg,#0f4f76,#083452);
  color:#fff;
}
.viewer{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;}
.frame{width:95%;height:85%;border-radius:24px;background:rgba(255,255,255,.05);position:relative;overflow:hidden;touch-action:none;}
.stage{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;}
.panZoom{transform-origin:center;will-change:transform;transition:transform 240ms cubic-bezier(.2,.8,.25,1);}
.deckObject{width:min(920px,90vw);height:auto;border-radius:24px;background:#efe6d6;}
</style>
</head>

<body>

<div class="viewer">
  <div class="frame" id="frame">
    <div class="stage">
      <div class="panZoom" id="panZoom">
        <object id="deckObject" class="deckObject" type="image/svg+xml"></object>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
"use strict";

/* ─────────────────────────────────────────────────────────────
   DEBUG LOGGER
───────────────────────────────────────────────────────────── */

const DEBUG = true;

const Log = {
  info(label, data){
    if (!DEBUG) return;
    console.log(`%c[DeckNav INFO] ${label}`, "color:#4de7c8;font-weight:600;", data ?? "");
  },
  warn(label, data){
    if (!DEBUG) return;
    console.warn(`%c[DeckNav WARN] ${label}`, "color:#ffb703;font-weight:700;", data ?? "");
  },
  error(label, data){
    if (!DEBUG) return;
    console.error(`%c[DeckNav ERROR] ${label}`, "color:#ff6b6b;font-weight:800;", data ?? "");
  },
  milestone(label){
    if (!DEBUG) return;
    console.log(`%c[DeckNav MILESTONE] ${label}`, "color:#00b4e6;font-weight:800;");
  }
};

Log.milestone("Script Loaded");

/* ─────────────────────────────────────────────────────────────
   Deck Data
───────────────────────────────────────────────────────────── */

const DECKS = [
  { id:"03", svg:"decks/deck-03-final.min.svg" },
  { id:"04", svg:"decks/deck-04-final.min.svg" },
  { id:"05", svg:"decks/deck-05-final.min.svg" }
];

let activeIndex = 1; // default deck 04
Log.info("Initial deck index", activeIndex);

/* ─────────────────────────────────────────────────────────────
   DOM
───────────────────────────────────────────────────────────── */

const frame = document.getElementById("frame");
const panZoom = document.getElementById("panZoom");
const deckObject = document.getElementById("deckObject");

if (!frame || !panZoom || !deckObject){
  Log.error("Missing required DOM nodes");
  return;
}

Log.milestone("DOM Ready");

/* ─────────────────────────────────────────────────────────────
   State
───────────────────────────────────────────────────────────── */

let scale = 1;
let tx = 0;
let ty = 0;
let fitScale = 1;

let baseDeckW = 800;
let baseDeckH = 1200;

const clamp = (v,min,max)=>Math.min(Math.max(v,min),max);

/* ─────────────────────────────────────────────────────────────
   Transform
───────────────────────────────────────────────────────────── */

function applyTransform(){
  panZoom.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
  Log.info("Transform Applied", {scale,tx,ty});
}

/* ─────────────────────────────────────────────────────────────
   Measurement
───────────────────────────────────────────────────────────── */

function measureDeck(){
  const rect = deckObject.getBoundingClientRect();
  Log.info("Deck Bounding Rect", rect);

  if(rect.width < 50 || rect.height < 50){
    Log.warn("Deck measurement suspiciously small", rect);
  }

  baseDeckW = rect.width || baseDeckW;
  baseDeckH = rect.height || baseDeckH;

  Log.info("Base Deck Dimensions", {baseDeckW,baseDeckH});
}

/* ─────────────────────────────────────────────────────────────
   Fit
───────────────────────────────────────────────────────────── */

function computeFit(){
  const r = frame.getBoundingClientRect();
  Log.info("Frame Rect", r);

  const sW = r.width / baseDeckW;
  const sH = r.height / baseDeckH;
  fitScale = Math.min(sW,sH);

  if(!isFinite(fitScale) || fitScale <= 0){
    Log.warn("Invalid fitScale computed", fitScale);
    fitScale = 1;
  }

  Log.info("Computed fitScale", fitScale);
}

function resetToFit(){
  computeFit();
  scale = fitScale;
  tx = 0;
  ty = 0;
  applyTransform();
  Log.milestone("Reset To Fit Complete");
}

/* ─────────────────────────────────────────────────────────────
   Deck Loading
───────────────────────────────────────────────────────────── */

async function loadDeck(index){
  const deck = DECKS[index];
  Log.milestone("Deck Load Requested");
  Log.info("Deck Data", deck);

  if(!deck){
    Log.error("Deck index invalid", index);
    return;
  }

  try{
    const res = await fetch(deck.svg, {cache:"no-cache"});
    Log.info("Fetch Status", res.status);

    if(!res.ok){
      Log.warn("SVG fetch failed", deck.svg);
      return;
    }
  }catch(e){
    Log.error("Fetch threw error", e);
    return;
  }

  deckObject.setAttribute("data", deck.svg);
  Log.info("SVG data attribute set", deck.svg);

  deckObject.onload = ()=>{
    Log.milestone("SVG Object Load Event Fired");

    requestAnimationFrame(()=>{
      measureDeck();
      resetToFit();
    });
  };

  deckObject.onerror = ()=>{
    Log.error("SVG Object Failed To Load", deck.svg);
  };
}

/* ─────────────────────────────────────────────────────────────
   Gesture (PointerEvents only)
───────────────────────────────────────────────────────────── */

let pointers = new Map();
let startPan = {x:0,y:0,tx:0,ty:0};

frame.addEventListener("pointerdown",e=>{
  pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});
  startPan = {x:e.clientX,y:e.clientY,tx,ty};
  frame.setPointerCapture(e.pointerId);
  Log.info("Pointer Down", e.pointerId);
});

frame.addEventListener("pointermove",e=>{
  if(!pointers.has(e.pointerId)) return;

  pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});

  if(pointers.size === 1){
    const dx = e.clientX - startPan.x;
    const dy = e.clientY - startPan.y;
    tx = startPan.tx + dx;
    ty = startPan.ty + dy;
    applyTransform();
  }

  if(pointers.size === 2){
    const pts = Array.from(pointers.values());
    const dx = pts[0].x - pts[1].x;
    const dy = pts[0].y - pts[1].y;
    const dist = Math.hypot(dx,dy);
    scale = clamp(dist/200, .5, 4);
    applyTransform();
    Log.info("Pinch Scale", scale);
  }
});

frame.addEventListener("pointerup",e=>{
  pointers.delete(e.pointerId);
  Log.info("Pointer Up", e.pointerId);
});

/* ─────────────────────────────────────────────────────────────
   Resize
───────────────────────────────────────────────────────────── */

window.addEventListener("resize",()=>{
  Log.milestone("Window Resize Detected");
  resetToFit();
});

/* ─────────────────────────────────────────────────────────────
   INIT
───────────────────────────────────────────────────────────── */

Log.milestone("Initialization Start");
loadDeck(activeIndex);
Log.milestone("Initialization Complete");

})();
</script>

</body>
</html>