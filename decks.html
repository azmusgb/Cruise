<!DOCTYPE html>
<html lang="en" data-theme="light" data-theme-mode="light" data-cruise-mode="before" data-cruise-day="1" data-day-part="evening" data-port-theme="none">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#cfeaff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="manifest" href="manifest.json?v=2">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg">
  <title>Deck Navigator Â· Adventure of the Seas | Royal Caribbean</title>

  <!-- Premium fonts & icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* â€”â€”â€”â€” MODERN RESET & GLOBAL â€”â€”â€”â€” */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(160deg, #f4fbff 0%, #e6f5ff 52%, #def1ff 100%);
      color: #13293d;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    :root {
      --accent: #00a4d8;
      --accent-soft: rgba(0,164,216,0.1);
      --accent-glow: rgba(0,164,216,0.3);
      --deep-navy: #0a1e32;
      --warm-gold: #ffb74d;
      --glass-bg: rgba(255,255,255,0.68);
      --glass-border: rgba(255,255,255,0.5);
      --card-shadow: 0 18px 36px -12px rgba(0,40,80,0.2);
      --transition-magic: 0.4s cubic-bezier(0.2, 0.9, 0.3, 1.1);
      --type-title-xl: clamp(2.0rem, 4vw, 2.8rem);
      --type-title-lg: clamp(1.5rem, 2.8vw, 2.0rem);
      --type-title-md: clamp(1.15rem, 2.0vw, 1.4rem);
      --space-section: 24px;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; width: 100%; }

    /* â€”â€”â€”â€” HERO (slightly condensed) â€”â€”â€”â€” */
    .deck-hero {
      background: linear-gradient(180deg, #eaf6ff 0%, #cfeaff 70%, #bde5ff 100%);
      border-radius: 0 0 40px 40px;
      padding: 48px 24px 40px;
      margin-bottom: 8px;
      color: #0a2a4a;
      box-shadow: 0 8px 20px rgba(0,40,80,0.1);
      position: relative;
      isolation: isolate;
    }
    .deck-hero::after {
      content: '';
      position: absolute;
      inset: 0;
      background: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M10 50 Q 30 30, 50 50 T 90 50" stroke="%23008ec4" opacity="0.12" fill="none" stroke-width="1"/></svg>');
      pointer-events: none;
      border-radius: inherit;
    }
    .deck-hero__eyebrow {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #1f6b97;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .deck-hero__title {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: var(--type-title-xl);
      font-weight: 800;
      line-height: 1.1;
      color: #08395f;
      margin-bottom: 8px;
    }
    .deck-hero__subtitle {
      margin-top: 12px;
      font-size: 1rem;
      color: rgba(12, 74, 110, 0.95);
      max-width: 600px;
      margin-bottom: 20px;
      font-weight: 450;
    }
    .deck-hero__accent {
      width: 60px;
      height: 3px;
      margin-top: 16px;
      background: linear-gradient(to right, var(--warm-gold), rgba(255,183,77,0.3));
      border-radius: 2px;
    }
    .deck-hero__tag {
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(16, 122, 170, 0.18);
      padding: 4px 14px;
      border-radius: 40px;
      font-size: 0.8rem;
      display: inline-block;
      margin-right: 8px;
      color: #0a4d77;
    }
    .page-spine {
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      margin: 28px 0 20px;
    }
    .page-spine__item { border-left: 4px solid var(--accent); padding-left: 14px; }
    .page-spine__label { display: block; font-weight: 700; color: #0d4067; font-size: 1rem; }
    .page-spine__meta { color: #2d6f97; font-size: 0.8rem; }
    .deck-hero__actions { margin-top: 12px; }
    .deck-hero__actions .btn {
      background: white;
      color: #0c4d75;
      border-radius: 40px;
      padding: 12px 28px;
      font-weight: 700;
      margin-right: 10px;
      border: none;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 6px 14px rgba(0,83,126,0.1);
    }
    .btn--primary { background: var(--warm-gold) !important; color: #0a375a !important; box-shadow: 0 8px 20px rgba(255,180,70,0.28); }
    .deck-hero__btn-secondary { background: rgba(255,255,255,0.8) !important; color: #0b547d !important; }

    /* â€”â€”â€”â€” GLASS NAVIGATION â€”â€”â€”â€” */
    .main-navigation {
      background: var(--glass-bg);
      backdrop-filter: blur(18px);
      border: 1px solid var(--glass-border);
      border-radius: 60px;
      margin: -24px auto 24px;
      padding: 8px 16px;
      max-width: 860px;
      box-shadow: 0 8px 18px rgba(0,76,120,0.1);
    }
    .main-navigation__inner { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    .main-navigation__search {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      background: white;
      border-radius: 40px;
      padding: 6px 16px;
      box-shadow: inset 0 1px 4px rgba(0,0,0,0.02), 0 2px 8px rgba(0,164,216,0.12);
    }
    .main-navigation__search i { color: var(--accent); margin-right: 8px; }
    #deckSearch {
      border: none;
      background: transparent;
      padding: 10px 0;
      font-size: 0.95rem;
      width: 100%;
      outline: none;
      font-weight: 500;
    }
    .main-navigation__hint { color: #6b8faa; font-size: 0.7rem; background: #eef6fd; padding: 4px 8px; border-radius: 32px; }
    .pill-btn {
      background: white;
      border: none;
      padding: 8px 20px;
      border-radius: 40px;
      font-weight: 600;
      color: #1f4460;
      border: 1px solid transparent;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .pill-btn.is-active { background: var(--accent); color: white; box-shadow: 0 8px 16px rgba(0,121,212,0.3); border-color: white; }
    .main-navigation__filters { display: flex; gap: 6px; flex-wrap: wrap; }

    /* â€”â€”â€”â€” QUICK RAIL â€”â€”â€”â€” */
    .deck-quickrail-wrap { margin-top: 16px; }
    .deck-quickrail {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 8px 4px 16px;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) #e3ecf2;
    }
    .deck-quickbtn {
      background: white;
      border: 1px solid rgba(0,82,165,0.1);
      border-radius: 40px;
      padding: 10px 20px;
      font-weight: 700;
      color: #0a2a4a;
      transition: all 0.2s ease;
      box-shadow: 0 4px 10px rgba(0,60,120,0.06);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      white-space: nowrap;
    }
    .deck-quickbtn:hover { transform: translateY(-2px); background: white; box-shadow: 0 12px 20px -8px rgba(0,121,212,0.24); }
    .deck-quickbtn.is-active { background: var(--accent); color: white; box-shadow: 0 8px 18px rgba(0,121,212,0.25); }
    .deck-quickbtn__num { font-weight: 800; font-size: 1.1rem; }
    .deck-quickbtn__sub { font-size: 0.7rem; opacity: 0.8; font-weight: 500; }

    /* â€”â€”â€”â€” CATEGORY PILLS â€”â€”â€”â€” */
    .deck-directory__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .deck-directory__title { font-size: 1rem; font-weight: 800; color: #0d3f64; }
    .deck-directory__toggle {
      border: 1px solid rgba(0,121,212,0.22);
      background: #f5fcff;
      color: #0b4a72;
      border-radius: 40px;
      padding: 6px 12px;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
    }
    .deck-directory__panels[hidden] { display: none; }
    .category-card {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.6);
      border-radius: 32px;
      padding: 20px 24px;
      margin-bottom: 16px;
      box-shadow: 0 8px 24px rgba(0,30,60,0.04);
    }
    .category-card__heading { font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: 12px; color: #0f446a; }
    .deck-pills { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
    .deck-pill {
      background: white;
      border: 1px solid rgba(0,82,165,0.1);
      border-radius: 30px;
      padding: 8px 16px;
      font-weight: 600;
      color: #0a2a4a;
      cursor: pointer;
      transition: all 0.2s;
    }
    .deck-pill.is-active { background: var(--accent); color: white; }

    /* â€”â€”â€”â€” DECK CARDS (uniform height) â€”â€”â€”â€” */
    .deck-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }
    .deck-card {
      background: white;
      border-radius: 28px;
      padding: 20px;
      display: flex;
      gap: 16px;
      border: 1px solid rgba(0,80,130,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 8px 22px -10px rgba(0,50,90,0.14);
      backdrop-filter: blur(4px);
      min-height: 180px;
    }
    .deck-card:hover { transform: translateY(-4px); border-color: var(--accent); box-shadow: 0 20px 30px -14px rgba(0,121,212,0.28); }
    .deck-visual { position: relative; width: 90px; flex-shrink: 0; }
    .deck-number {
      position: absolute;
      top: -6px;
      left: -6px;
      background: var(--deep-navy);
      color: white;
      font-weight: 800;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 40px;
      font-size: 1.3rem;
      border: 2px solid white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      z-index: 2;
    }
    .deck-visual img { width: 100%; height: 90px; object-fit: cover; border-radius: 18px; background: #cfe2f0; }
    .deck-info { flex: 1; display: flex; flex-direction: column; }
    .deck-title { font-size: 1.3rem; font-weight: 800; line-height: 1.2; }
    .deck-subtitle { color: var(--accent); font-weight: 600; font-size: 0.9rem; }
    .deck-highlights { display: flex; flex-wrap: wrap; gap: 6px; margin: 10px 0; }
    .deck-highlights span { background: #e9f3fb; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; color: #0c4973; }
    .deck-card__cta {
      margin-top: auto;
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 40px;
      font-weight: 700;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      align-self: flex-start;
    }
    .deck-card__cta:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,121,212,0.3); }

    .deck-grid__header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
      flex-wrap: wrap;
      margin: 20px 0 8px;
    }
    .deck-grid__title { font-size: var(--type-title-lg); font-weight: 800; color: #0a344f; }
    .deck-grid__counts { display: flex; gap: 12px; }
    .count-chip { background: white; padding: 6px 16px; border-radius: 40px; box-shadow: 0 4px 10px rgba(0,0,0,0.04); font-size: 0.9rem; }
    .count-chip--strong { font-weight: 700; }

    .deck-empty { text-align: center; padding: 48px; background: white; border-radius: 40px; margin-top: 24px; }

    /* â€”â€”â€”â€” MODAL (refined controls) â€”â€”â€”â€” */
    .deck-modal {
      position: fixed;
      inset: 0;
      z-index: 6000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .deck-modal.is-open { display: flex; }
    .deck-modal__backdrop {
      position: fixed; inset: 0; background: rgba(13, 63, 97, 0.5);
      backdrop-filter: blur(6px);
    }
    .deck-modal__dialog {
      position: relative;
      background: linear-gradient(145deg, #ffffff, #f6fdff);
      border-radius: 36px;
      max-width: 1300px;
      width: min(96vw, 1300px);
      max-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 30px);
      box-shadow: 0 30px 60px rgba(6,58,92,0.25);
      border: 1px solid rgba(255,255,255,0.8);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      margin: calc(env(safe-area-inset-top) + 15px) 0 calc(env(safe-area-inset-bottom) + 15px);
    }

    /* Floating zoom panel (right side) */
    .zoom-float-panel {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 100;
      pointer-events: none;
    }
    .zoom-float-panel > * {
      pointer-events: auto;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 40px;
      box-shadow: 0 8px 20px rgba(0,20,40,0.15);
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0a2a4a;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .zoom-float-panel > *:hover { background: white; color: var(--accent); }
    .zoom-slider-container {
      width: 48px;
      height: 160px;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(8px);
      border-radius: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 0;
      gap: 8px;
    }
    .zoom-slider {
      writing-mode: bt-lr; /* IE */
      -webkit-appearance: slider-vertical;
      width: 4px;
      height: 100px;
      background: #ddd;
      border-radius: 4px;
      outline: none;
    }
    .zoom-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: 2px solid white;
    }
    .recenter-btn {
      background: var(--accent);
      color: white;
    }

    /* Modal header / toolbar */
    .deck-modal__toolbar {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(24px);
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(0,82,165,0.1);
    }
    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .deck-modal__title {
      font-size: var(--type-title-md);
      font-weight: 800;
      color: #0a2a4a;
    }
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-icon, .labeled-btn {
      background: white;
      border: none;
      padding: 8px 12px;
      border-radius: 30px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.02);
      transition: 0.2s;
      cursor: pointer;
    }
    .btn-icon:hover, .labeled-btn:hover { background: var(--accent); color: white; transform: translateY(-1px); }
    .close-btn {
      background: none;
      border: none;
      font-size: 1.8rem;
      width: 44px;
      height: 44px;
      border-radius: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .close-btn:hover { background: rgba(0,0,0,0.05); }

    .deck-modal__body {
      padding: 20px;
      overflow-y: auto;
      position: relative;
      flex: 1;
    }
    .deck-pan-hint {
      margin-bottom: 8px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      color: #1f5b87;
      background: #e7f5ff;
      border: 1px solid rgba(0,121,212,0.2);
      border-radius: 40px;
      padding: 6px 12px;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity 180ms ease, transform 180ms ease;
    }
    .deck-pan-hint.is-visible { opacity: 1; transform: translateY(0); }
    .deck-focuschips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
    .deck-focuschip {
      background: #eaf3ff;
      padding: 6px 16px;
      border-radius: 40px;
      border: none;
      font-weight: 600;
      color: #0e4d80;
      cursor: pointer;
      transition: all 0.2s;
    }
    .deck-focuschip:hover, .deck-focuschip.is-active { background: #cfe9ff; box-shadow: 0 8px 16px rgba(0,121,212,0.2); }
    .deck-plan-stage {
      background: linear-gradient(165deg, #2f85b3 0%, #47a7cf 40%, #2f95bf 100%);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.4), 0 14px 26px -12px rgba(8,62,96,0.4);
      position: relative;
      overflow: auto;
      padding: 16px;
      min-height: 400px;
    }
    .deck-plan-canvas {
      transition: opacity 220ms ease, transform 220ms ease;
      transform-origin: 0 0;
    }
    .deck-plan-canvas.is-transitioning { opacity: 0; transform: translateY(8px) scale(0.98); }
    .deck-plan-media { width: 100%; height: auto; display: block; border-radius: 16px; }
    .deck-plan-hotspots { position: absolute; inset: 16px; }
    .deck-hotspot {
      position: absolute;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border-radius: 40px;
      background: linear-gradient(145deg, #0ca8ff, #0069d0);
      border: 2px solid white;
      color: white;
      font-weight: 800;
      box-shadow: 0 8px 18px rgba(0,121,212,0.6);
      cursor: pointer;
      transition: transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .deck-hotspot:hover { transform: translate(-50%, -50%) scale(1.1); }
    .deck-hotspot[data-selected="true"] { box-shadow: 0 0 0 4px rgba(255,215,0,0.6); }
    .deck-plan-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }
    .deck-plan-legend-item {
      background: white;
      border: none;
      padding: 8px 16px;
      border-radius: 30px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.04);
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.8rem;
    }
    .deck-plan-legend-item.is-active { background: #dff0ff; box-shadow: 0 8px 16px rgba(0,121,212,0.2); }
    .deck-plan-skeleton {
      min-height: 380px;
      border-radius: 24px;
      background: linear-gradient(110deg, rgba(255,255,255,0.15) 20%, rgba(255,255,255,0.38) 32%, rgba(255,255,255,0.15) 44%) 0 0 / 220% 100%, linear-gradient(160deg, #0f5379, #1273a1);
      animation: deckLoadingSweep 900ms linear infinite;
    }
    @keyframes deckLoadingSweep { to { background-position: 220% 0, 0 0; } }

    /* â€”â€”â€”â€” BOTTOM NAV â€”â€”â€”â€” */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 990;
      display: none;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 8px;
      padding: 8px 12px calc(8px + env(safe-area-inset-bottom));
      background: rgba(241, 250, 255, 0.92);
      border-top: 1px solid rgba(8, 89, 136, 0.18);
      backdrop-filter: blur(10px);
    }
    .bottom-nav__item {
      min-height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(8, 89, 136, 0.14);
      background: rgba(255, 255, 255, 0.64);
      color: #1f567c;
      text-decoration: none;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      font-size: 0.65rem;
      font-weight: 700;
      transition: transform 0.1s;
    }
    .bottom-nav__item:active { transform: scale(0.96); }
    .bottom-nav__item.active { border-color: rgba(255,190,92,0.56); background: rgba(255,190,92,0.22); }
    @media (max-width: 767px) {
      body { padding-bottom: calc(80px + env(safe-area-inset-bottom)); }
      .bottom-nav { display: grid; }
    }

    /* â€”â€”â€”â€” BACK TO TOP â€”â€”â€”â€” */
    .back-to-top {
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 48px;
      height: 48px;
      border-radius: 48px;
      background: var(--accent);
      color: white;
      border: none;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 800;
      opacity: 0.9;
    }
    .back-to-top.show { display: flex; }
  </style>
</head>
<body class="app-theme-rcc decks-page">
  <a href="#main" class="skip-link">Skip to main content</a>
  
  <div id="sharedHeader" data-page="decks">
    <!-- Your original header HTML here (kept exactly as before) -->
    <header class="app-header--minimal app-header--rccl-site" role="banner">
      <div class="header-utility">
        <div class="header-utility__inner">
          <div class="header-utility__left">
            <span class="header-utility__crumb">Adventure of the Seas</span>
            <span class="header-utility__mode mode-before" id="navModeBadge">Before Sail</span>
          </div>
          <span class="header-utility__promo" id="navContextLine">Boarding soon Â· lock final details</span>
        </div>
      </div>

      <div class="header-container">
        <div class="header-brand">
          <a href="index.html" class="header-logo">
            <i class="fas fa-crown" aria-hidden="true"></i>
            <div class="header-logo-text">
              <span class="header-logo-title">Royal Caribbean</span>
              <span class="header-logo-subtitle">Adventure of the Seas Â· Cruise Companion</span>
            </div>
          </a>
        </div>

        <nav class="header-nav" id="headerPrimaryNav" aria-label="Primary navigation" aria-hidden="true" style="display: none;">
          <a href="index.html" class="header-nav__link" data-nav="home"><i class="fas fa-home" aria-hidden="true"></i><span class="header-nav__label">Home</span><span class="header-nav__hint">The Countdown</span></a>
          <a href="plan.html" class="header-nav__link" data-nav="plan"><i class="fas fa-compass" aria-hidden="true"></i><span class="header-nav__label">Game Plan</span><span class="header-nav__hint">What To Do Next</span></a>
          <a href="itinerary.html#today" class="header-nav__link" data-nav="today"><i class="fas fa-calendar-day" aria-hidden="true"></i><span class="header-nav__label">Today</span><span class="header-nav__hint">Right Now</span></a>
          <a href="decks.html" class="header-nav__link active" data-nav="map" aria-current="page"><i class="fas fa-map" aria-hidden="true"></i><span class="header-nav__label">Ship Map</span><span class="header-nav__hint">Find Anything</span></a>
          <a href="dining.html" class="header-nav__link" data-nav="food"><i class="fas fa-utensils" aria-hidden="true"></i><span class="header-nav__label">Food</span><span class="header-nav__hint">Tonight's Pick</span></a>
          <a href="rooms.html" class="header-nav__link" data-nav="family"><i class="fas fa-users" aria-hidden="true"></i><span class="header-nav__label">Family</span><span class="header-nav__hint">Who's Where</span></a>
        </nav>

        <div class="header-actions" id="headerHeaderActions" aria-hidden="true" style="display: none;">
          <button type="button" class="header-cta header-cta--help" id="headerMoreButton" aria-haspopup="dialog" aria-expanded="false" aria-controls="moreDrawer">
            <span>More</span><i class="fas fa-chevron-down" aria-hidden="true"></i>
          </button>
          <button type="button" class="header-cta header-cta--install" id="pwaInstallButton" hidden="" aria-hidden="true">
            <i class="fas fa-download" aria-hidden="true"></i><span>Install App</span>
          </button>
        </div>

        <button class="mobile-nav-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="headerPrimaryNav">
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
    </header>
  </div>

  <main id="main" class="decks-shell">
    <!-- HERO â€“ dramatically refined -->
    <section class="deck-hero">
      <div class="container">
        <div class="deck-hero__eyebrow">Adventure of the Seas Â· Feb 14â€“20, 2026</div>
        <h1 class="deck-hero__title">Deck Navigator</h1>
        <p class="deck-hero__subtitle">Pools. Shows. Food. Cabins. Find anything on the ship in seconds.</p>
        <div class="deck-hero__highlights">
          <span class="deck-hero__tag"><i class="fas fa-route"></i> Intent-first routing</span>
          <span class="deck-hero__tag"><i class="fas fa-layers"></i> Venue clusters</span>
          <span class="deck-hero__tag"><i class="fas fa-bolt"></i> Instant deck switching</span>
        </div>
        <div class="page-spine">
          <div class="page-spine__item"><span class="page-spine__label">Entertainment</span><span class="page-spine__meta">Shows, lounges, nightlife</span></div>
          <div class="page-spine__item"><span class="page-spine__label">Wellness</span><span class="page-spine__meta">Pools, spa, active</span></div>
          <div class="page-spine__item"><span class="page-spine__label">Essentials</span><span class="page-spine__meta">Service, transit, medical</span></div>
        </div>
        <div class="deck-hero__actions">
          <a class="btn btn--primary" href="#deck-directory"><i class="fas fa-compass"></i> Open deck directory</a>
          <a class="btn btn--secondary deck-hero__btn-secondary" href="rooms.html"><i class="fas fa-door-open"></i> Find my stateroom</a>
        </div>
      </div>
    </section>

    <!-- GLASS SEARCH & FILTERS -->
    <section class="main-navigation container" aria-label="Deck navigation">
      <div class="main-navigation__inner">
        <div class="main-navigation__search">
          <i class="fas fa-search"></i>
          <input id="deckSearch" type="search" placeholder="Search decks, venues, or amenities" aria-label="Search decks" autocomplete="off">
          <span class="main-navigation__hint">Press /</span>
        </div>
        <div class="main-navigation__filters">
          <button class="pill-btn is-active" data-filter="all">All</button>
          <button class="pill-btn" data-filter="entertainment">Entertainment</button>
          <button class="pill-btn" data-filter="wellness">Wellness</button>
          <button class="pill-btn" data-filter="essential">Essential</button>
        </div>
      </div>
    </section>

    <!-- DECK QUICK RAIL (SCULPTED) -->
    <section class="deck-quickrail-wrap container">
      <div class="deck-quickrail" id="deckQuickRail">
        <!-- Quick rail buttons will be populated by JS -->
      </div>
    </section>

    <!-- CATEGORY PILLS (DYNAMIC) -->
    <section id="deck-directory" class="deck-directory container">
      <div class="deck-directory__header">
        <h2 class="deck-directory__title">Browse by category</h2>
        <button id="toggleCategoryBrowse" class="deck-directory__toggle" type="button" aria-expanded="false" aria-controls="deckCategoryPanels">
          Show categories <i class="fas fa-chevron-down" aria-hidden="true"></i>
        </button>
      </div>
      <div id="deckCategoryPanels" class="deck-directory__panels" hidden="">
        <article class="category-card" data-category="entertainment">
          <div class="category-card__heading"><i class="fas fa-masks-theater" aria-hidden="true"></i> Entertainment Decks</div>
          <div class="deck-pills" id="pill-entertainment"></div>
        </article>
        <article class="category-card" data-category="wellness">
          <div class="category-card__heading"><i class="fas fa-spa" aria-hidden="true"></i> Wellness Decks</div>
          <div class="deck-pills" id="pill-wellness"></div>
        </article>
        <article class="category-card" data-category="essential">
          <div class="category-card__heading"><i class="fas fa-compass" aria-hidden="true"></i> Essential Decks</div>
          <div class="deck-pills" id="pill-essential"></div>
        </article>
      </div>
    </section>

    <!-- DECK GRID (ENHANCED) -->
    <section class="deck-grid container">
      <div class="deck-grid__header">
        <h2 class="deck-grid__title">Deck overview</h2>
        <div class="deck-grid__counts">
          <span class="count-chip count-chip--strong"><span id="countVisible">15</span> showing</span>
          <span class="count-chip"><span id="countTotal">15</span> total</span>
        </div>
      </div>
      <div id="deckCards" class="deck-cards" role="list"></div>
      <div id="emptyState" class="deck-empty" hidden="">
        <div class="deck-empty__icon">ðŸš¢</div>
        <h3 class="deck-empty__title">No matching decks</h3>
        <button class="btn btn--primary" id="clearFilters">Browse all decks</button>
      </div>
    </section>
  </main>

  <!-- MODAL â€“ cinematic with floating controls -->
  <div class="deck-modal" id="deckModal" aria-hidden="true">
    <div class="deck-modal__backdrop" data-action="close-modal"></div>
    <div class="deck-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">

      <!-- Floating zoom panel (right) -->
      <div class="zoom-float-panel">
        <button class="zoom-in" data-action="zoom-in" aria-label="Zoom in"><i class="fas fa-plus"></i></button>
        <div class="zoom-slider-container">
          <input type="range" min="50" max="300" value="100" class="zoom-slider" id="zoomSlider" orient="vertical" aria-label="Zoom level">
        </div>
        <button class="zoom-out" data-action="zoom-out" aria-label="Zoom out"><i class="fas fa-minus"></i></button>
        <button class="recenter-btn" data-action="zoom-reset" aria-label="Recenter"><i class="fas fa-crosshairs"></i></button>
      </div>

      <!-- Toolbar -->
      <div class="deck-modal__toolbar">
        <div class="toolbar-left">
          <button class="btn-icon" data-action="prev-deck" aria-label="Previous deck"><i class="fas fa-chevron-left"></i></button>
          <button class="btn-icon" data-action="next-deck" aria-label="Next deck"><i class="fas fa-chevron-right"></i></button>
          <h3 id="modalTitle" class="deck-modal__title">Deck 14</h3>
        </div>
        <div class="toolbar-right">
          <button class="labeled-btn" data-action="center-me" aria-label="My location"><i class="fas fa-location-dot"></i> <span class="btn-label">My Location</span></button>
          <a class="labeled-btn" id="downloadPlan" href="#" target="_blank" rel="noopener" aria-disabled="true"><i class="fas fa-file-pdf"></i> <span class="btn-label">PDF</span></a>
          <button class="close-btn" data-action="close-modal" aria-label="Close"><i class="fas fa-times"></i></button>
        </div>
      </div>

      <div class="deck-modal__body">
        <p id="deckPanHint" class="deck-pan-hint" hidden=""><i class="fas fa-hand-paper"></i> Drag to pan while zoomed in</p>
        <div id="deckFocusChips" class="deck-focuschips"></div>
        <div id="modalFrame" class="deck-modal__frame">
          <!-- Content injected dynamically -->
        </div>
      </div>
    </div>
  </div>

  <!-- Back to top button -->
  <button class="back-to-top" id="backToTop" aria-label="Back to top"><i class="fas fa-arrow-up"></i></button>

  <!-- BOTTOM NAV (gloss) -->
  <div id="sharedBottomNav" data-page="decks">
    <nav class="bottom-nav" aria-label="Bottom navigation">
      <a href="index.html" class="bottom-nav__item" data-nav="home"><i class="fas fa-home" aria-hidden="true"></i><span>Home</span></a>
      <a href="plan.html" class="bottom-nav__item" data-nav="plan"><i class="fas fa-compass" aria-hidden="true"></i><span>Plan</span></a>
      <a href="itinerary.html#today" class="bottom-nav__item" data-nav="today"><i class="fas fa-calendar-day" aria-hidden="true"></i><span>Today</span></a>
      <a href="decks.html" class="bottom-nav__item active" data-nav="map" aria-current="page"><i class="fas fa-ship" aria-hidden="true"></i><span>Map</span></a>
      <button type="button" id="moreBtnMobile" class="bottom-nav__item bottom-nav__item--more" data-nav="more" data-bottom-action="open-more-drawer" aria-haspopup="dialog" aria-expanded="false" aria-controls="moreDrawer">
        <i class="fas fa-ellipsis" aria-hidden="true"></i><span>More</span>
      </button>
    </nav>
  </div>

  <!-- FOOTER -->
  <div id="sharedFooter" data-page="decks">
    <footer class="app-footer--minimal app-footer--rccl-site" role="contentinfo">
      <div class="footer-container">
        <div class="footer-social-row" aria-label="Social links">
          <a href="https://facebook.com/royalcaribbean" class="footer-social__link" target="_blank" rel="noopener noreferrer" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
          <a href="https://instagram.com/royalcaribbean" class="footer-social__link" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
          <a href="https://tiktok.com/@royalcaribbean" class="footer-social__link" target="_blank" rel="noopener noreferrer" aria-label="TikTok"><i class="fab fa-tiktok" aria-hidden="true"></i></a>
          <a href="https://youtube.com/@RoyalCaribbeanInternational" class="footer-social__link" target="_blank" rel="noopener noreferrer" aria-label="YouTube"><i class="fab fa-youtube" aria-hidden="true"></i></a>
          <a href="https://x.com/royalcaribbean" class="footer-social__link" target="_blank" rel="noopener noreferrer" aria-label="X"><i class="fab fa-x-twitter" aria-hidden="true"></i></a>
          <a href="https://pinterest.com/royalcaribbean" class="footer-social__link" target="_blank" rel="noopener noreferrer" aria-label="Pinterest"><i class="fab fa-pinterest-p" aria-hidden="true"></i></a>
        </div>
        <div class="footer-country">
          <button type="button" class="footer-country__btn" aria-label="Country: United States"><span>ðŸ‡ºðŸ‡¸</span><span>United States</span></button>
        </div>
        <p class="footer-copyright">Â© 2026 Royal Caribbean Cruises</p>
        <nav class="footer-legal-links" aria-label="Legal links">
          <a href="https://www.royalcaribbean.com/resources/guest-terms" class="footer-legal__link" target="_blank" rel="noopener noreferrer">Cruise contract</a>
          <a href="https://www.royalcaribbean.com/company/about-us" class="footer-legal__link" target="_blank" rel="noopener noreferrer">About us</a>
          <a href="https://www.royalcaribbean.com/resources/privacy-policy" class="footer-legal__link" target="_blank" rel="noopener noreferrer">Privacy policy</a>
          <a href="https://www.royalcaribbean.com/resources/terms-and-conditions" class="footer-legal__link" target="_blank" rel="noopener noreferrer">Terms of use</a>
          <a href="https://www.royalcaribbeangroup.com/careers/" class="footer-legal__link" target="_blank" rel="noopener noreferrer">Careers</a>
          <a href="https://www.royalcaribbean.com/resources/travel-updates" class="footer-legal__link" target="_blank" rel="noopener noreferrer">Travel updates</a>
        </nav>
        <div class="footer-brands" aria-label="Royal Caribbean brands">
          <span class="footer-brand-mark">Royal Caribbean Group</span>
          <span class="footer-brand-mark">Royal Caribbean</span>
          <span class="footer-brand-mark">Celebrity Cruises</span>
          <span class="footer-brand-mark">Silversea</span>
        </div>
      </div>
    </footer>
  </div>

  <!-- More drawer (hidden) -->
  <div class="more-drawer-backdrop" id="moreDrawerBackdrop" hidden=""></div>
  <aside class="more-drawer" id="moreDrawer" role="dialog" aria-modal="true" aria-label="More menu" hidden="">
    <div class="more-drawer__header">
      <h2>More</h2>
      <button type="button" class="more-drawer__close" id="moreDrawerClose" aria-label="Close menu"><i class="fas fa-times" aria-hidden="true"></i></button>
    </div>
    <section class="more-drawer__group" aria-label="Explore">
      <h3 class="more-drawer__group-title">Explore</h3>
      <div class="more-drawer__group-links">
        <a href="ports.html" class="more-drawer__link"><i class="fas fa-map-location-dot" aria-hidden="true"></i><span>Ports</span></a>
        <a href="tips.html" class="more-drawer__link"><i class="fas fa-lightbulb" aria-hidden="true"></i><span>Pro Moves</span></a>
        <a href="photos.html" class="more-drawer__link"><i class="fas fa-images" aria-hidden="true"></i><span>Photos</span></a>
      </div>
    </section>
    <section class="more-drawer__group" aria-label="Utility">
      <h3 class="more-drawer__group-title">Utility</h3>
      <div class="more-drawer__group-links">
        <a href="operations.html" class="more-drawer__link"><i class="fas fa-clipboard-check" aria-hidden="true"></i><span>Checklist</span></a>
        <a href="contacts.html" class="more-drawer__link"><i class="fas fa-phone-volume" aria-hidden="true"></i><span>Contacts</span></a>
        <a href="offline.html" class="more-drawer__link"><i class="fas fa-wifi" aria-hidden="true"></i><span>Offline</span></a>
      </div>
    </section>
  </aside>

  <!-- ========== ENHANCED JAVASCRIPT â€“ SMOOTH, PREMIUM ========== -->
  <script>
    (function() {
      'use strict';

      // ---- DECK DATA (same as original) ----
      const deckData = [
        { number: 0, name: 'All Decks', subtitle: 'Ship Overview Blueprint', highlights: ['Full ship layout', 'Cross-deck context', 'Fast orientation'], description: 'Complete multi-deck blueprint â€“ ultimate orientation.', category: 'essential', image: 'decks/deck-all.svg', svg: 'decks/deck-all.min.svg', pdf: '' },
        { number: 5, name: 'Deck 5', subtitle: 'Promenade Level', highlights: ['Entertainment', 'Dining', 'Retail'], description: 'Royal Promenade â€“ cafes, shops, parades.', category: 'entertainment', image: 'decks/deck-05.png', svg: 'decks/deck-05-final.min.svg', pdf: 'decks/deck-05.pdf' },
        { number: 14, name: 'Deck 14', subtitle: 'Sky Deck', highlights: ['Panoramic views', 'Lounges', 'Sun decks'], description: 'Viking Crown Lounge & sky bar.', category: 'entertainment', image: 'decks/deck-14.png', svg: 'decks/deck-14-final.min.svg', pdf: '' },
        { number: 11, name: 'Deck 11', subtitle: 'Fitness & Spa', highlights: ['Spa', 'Fitness', 'Wellness'], description: 'Vitality Spa & fully equipped fitness.', category: 'wellness', image: 'decks/deck-11.png', svg: 'decks/deck-11-final.min.svg', pdf: '' },
        { number: 12, name: 'Deck 12', subtitle: 'Pool Deck', highlights: ['Main pool', 'Solarium', 'Grill'], description: 'Main pool, adults-only solarium, Windjammer.', category: 'wellness', image: 'decks/deck-12.png', svg: 'decks/deck-12-final.min.svg', pdf: '' },
        { number: 15, name: 'Deck 15', subtitle: 'Sports & Observation', highlights: ['Sports court', 'Jog track', 'Views'], description: 'FlowRider, mini-golf, running track.', category: 'wellness', image: 'decks/deck-15.png', svg: 'decks/deck-15-final.min.svg', pdf: '' },
        { number: 13, name: 'Deck 13', subtitle: 'Adventure Zone', highlights: ['FlowRider', 'Sky deck access', 'Activities'], description: 'Adventure Ocean & rock climbing wall.', category: 'entertainment', image: 'decks/deck-13.png', svg: 'decks/deck-13-final.min.svg', pdf: '' },
        { number: 10, name: 'Deck 10', subtitle: 'Stateroom Corridor', highlights: ['Cabins', 'Elevators', 'Quiet routes'], description: 'Premium staterooms, aft elevator lobby.', category: 'essential', image: 'decks/deck-10.png', svg: 'decks/deck-10-final.min.svg', pdf: '' },
        { number: 9, name: 'Deck 9', subtitle: 'Midship Cabins', highlights: ['Cabins', 'Family zones', 'Wayfinding'], description: 'Family-friendly staterooms.', category: 'essential', image: 'decks/deck-09.png', svg: 'decks/deck-09-final.min.svg', pdf: '' },
        { number: 8, name: 'Deck 8', subtitle: 'Stateroom Access', highlights: ['Cabins', 'Aft access', 'Guest routes'], description: 'Convenient access to upper decks.', category: 'essential', image: 'decks/deck-08.png', svg: 'decks/deck-08-final.min.svg', pdf: '' },
        { number: 7, name: 'Deck 7', subtitle: 'Cabin Transit', highlights: ['Cabins', 'Quiet zones', 'Midship transit'], description: 'Quiet corridor, elevator stacks C/D.', category: 'essential', image: 'decks/deck-07.png', svg: 'decks/deck-07-final.min.svg', pdf: '' },
        { number: 6, name: 'Deck 6', subtitle: 'Stateroom Ring', highlights: ['Cabins', 'Family adjacency', 'Deck transitions'], description: 'Your stateroom zone (6650) near aft.', category: 'essential', image: 'decks/deck-06.png', svg: 'decks/deck-06-final.min.svg', pdf: '' },
        { number: 4, name: 'Deck 4', subtitle: 'Dining & Entertainment', highlights: ['Main dining', 'Show venue', 'Casino'], description: 'Main dining room, theater, casino.', category: 'entertainment', image: 'decks/deck-04.png', svg: 'decks/deck-04-final.min.svg', pdf: '' },
        { number: 3, name: 'Deck 3', subtitle: 'Lobby & Guest Services', highlights: ['Guest services', 'Dining', 'Retail'], description: 'Grand lobby, shore excursions, champagne bar.', category: 'essential', image: 'decks/deck-03.png', svg: 'decks/deck-03-final.min.svg', pdf: '' },
        { number: 2, name: 'Deck 2', subtitle: 'Medical & Crew Support', highlights: ['Medical', 'Crew services', 'Logistics'], description: 'Medical center, crew mess, embarkation.', category: 'essential', image: 'decks/deck-02.png', svg: 'decks/deck-02-final.min.svg', pdf: '' }
      ];

      // ---- DECK HOTSPOTS (enhanced) ----
      const deckHotspots = {
        6: [
          { id: 'aft-cabins', title: 'Aft cabin cluster', note: 'Quieter corridor, wake views. Your room 6650 nearby.', x: 78, y: 58, highlight: true },
          { id: 'midship-elevators', title: 'Midship elevators', note: 'Fastest transfer to dining & promenade.', x: 52, y: 50, highlight: false },
          { id: 'forward-stairs', title: 'Forward stairs', note: 'Best route to theater and deck 4.', x: 26, y: 43 }
        ],
        12: [
          { id: 'main-pool', title: 'Main pool', note: 'Live music, pool games, bar.', x: 40, y: 60 },
          { id: 'solarium', title: 'Solarium', note: 'Adults-only oasis, indoor pool.', x: 70, y: 30, highlight: true },
          { id: 'windjammer', title: 'Windjammer Cafe', note: 'Casual buffet, ocean view.', x: 20, y: 70 }
        ],
        11: [
          { id: 'spa', title: 'Vitality Spa', note: 'Thermal suite, massages.', x: 48, y: 44 },
          { id: 'fitness', title: 'Fitness Center', note: 'Panoramic treadmills.', x: 30, y: 55 }
        ],
        5: [
          { id: 'cafe-promenade', title: 'Cafe Promenade', note: '24h coffee, sandwiches.', x: 55, y: 48 },
          { id: 'guest-services', title: 'Guest Services', note: 'Desk, crown & anchor.', x: 48, y: 60 }
        ]
      };

      // ---- FOCUS CHIPS ----
      const deckFocusMap = {
        12: ['Main Pool', 'Solarium', 'Windjammer'],
        11: ['Vitality Spa', 'Fitness Center'],
        5: ['Cafe Promenade', 'Guest Services'],
        4: ['Main Dining', 'Royal Theater'],
        6: ['Room 6650', 'Midship Elevators']
      };

      // --- STATE ---
      const state = {
        filter: 'all',
        search: '',
        lastOpenedDeck: null,
        currentDeck: null,
        currentZoom: 100,
        dragging: false,
        dragStartX: 0,
        dragStartY: 0,
        dragStartLeft: 0,
        dragStartTop: 0,
        panHintShown: sessionStorage.getItem('deck_pan_hint_shown') === '1'
      };

      // --- DOM elements ---
      const els = {
        search: document.getElementById('deckSearch'),
        quickRail: document.getElementById('deckQuickRail'),
        cards: document.getElementById('deckCards'),
        empty: document.getElementById('emptyState'),
        countVisible: document.getElementById('countVisible'),
        countTotal: document.getElementById('countTotal'),
        clearFilters: document.getElementById('clearFilters'),
        categoryToggle: document.getElementById('toggleCategoryBrowse'),
        categoryPanels: document.getElementById('deckCategoryPanels'),
        modal: document.getElementById('deckModal'),
        modalFrame: document.getElementById('modalFrame'),
        modalTitle: document.getElementById('modalTitle'),
        modalDesc: document.getElementById('modalDesc'), // not used in original but keep
        modalFocusChips: document.getElementById('deckFocusChips'),
        panHint: document.getElementById('deckPanHint'),
        download: document.getElementById('downloadPlan'),
        backToTop: document.getElementById('backToTop'),
        zoomSlider: document.getElementById('zoomSlider')
      };

      // ----- RENDER FUNCTIONS -----
      function renderQuickRail() {
        if (!els.quickRail) return;
        const sorted = [...deckData].sort((a,b) => b.number - a.number);
        els.quickRail.innerHTML = sorted.map(d => `
          <button class="deck-quickbtn" data-deck="${d.number}" aria-label="Open ${d.name}">
            <span class="deck-quickbtn__num">${d.number === 0 ? 'ALL' : `D${d.number}`}</span>
            <span class="deck-quickbtn__sub">${d.subtitle}</span>
          </button>
        `).join('');
      }

      function renderPills() {
        const cats = { entertainment: [], wellness: [], essential: [] };
        deckData.forEach(d => { if (cats[d.category]) cats[d.category].push(d); });
        Object.entries(cats).forEach(([key, decks]) => {
          const host = document.getElementById(`pill-${key}`);
          if (host) {
            host.innerHTML = decks.map(d => `
              <button class="deck-pill" data-deck="${d.number}">
                <span class="deck-pill__number">${d.number === 0 ? 'ALL' : d.number}</span>
                <span class="deck-pill__text">${d.subtitle}</span>
              </button>
            `).join('');
          }
        });
      }

      function getDeckImage(number) {
        if (number === 0) return 'decks/deck-all.svg';
        return `decks/deck-${String(number).padStart(2, '0')}.png`;
      }

      function getCategoryClass(category) {
        return `deck-card--${category}`;
      }

      function renderDeckCards(filter = 'all', search = '') {
        const container = els.cards;
        if (!container) return;

        const filtered = deckData.filter(deck => {
          const matchesCategory = filter === 'all' || deck.category === filter;
          const matchesSearch = search === '' ||
            deck.name.toLowerCase().includes(search) ||
            deck.subtitle.toLowerCase().includes(search) ||
            deck.highlights.join(' ').toLowerCase().includes(search);
          return matchesCategory && matchesSearch;
        });

        container.innerHTML = filtered.map(deck => `
          <article class="deck-card ${getCategoryClass(deck.category)}" data-deck="${deck.number}" role="listitem">
            <div class="deck-visual">
              <span class="deck-number">${deck.number === 0 ? 'ALL' : deck.number}</span>
              <img src="${getDeckImage(deck.number)}" alt="${deck.name}" loading="lazy" decoding="async">
            </div>
            <div class="deck-info">
              <h3 class="deck-title">${deck.name}</h3>
              <p class="deck-subtitle">${deck.subtitle}</p>
              <div class="deck-highlights">
                ${deck.highlights.map(h => `<span>${h}</span>`).join('')}
              </div>
              <button class="deck-card__cta" data-action="open" data-deck="${deck.number}">Explore deck â†’</button>
            </div>
          </article>
        `).join('');

        els.countVisible.textContent = filtered.length;
        els.countTotal.textContent = deckData.length;
        els.empty.hidden = filtered.length !== 0;
      }

      // --- MODAL FUNCTIONS ---
      function openModal(deck) {
        state.currentDeck = deck;
        state.lastOpenedDeck = deck.number;
        setActiveDeck(deck.number);
        renderFocusChips(deck);
        animateModalTitle(deck.name);
        renderModalPlan(deck);
        if (deck.pdf) {
          els.download.href = deck.pdf;
          els.download.removeAttribute('aria-disabled');
        } else {
          els.download.href = '#';
          els.download.setAttribute('aria-disabled', 'true');
        }
        els.modal.classList.add('is-open');
        els.modal.setAttribute('aria-hidden', 'false');
        setZoom(100);
      }

      function closeModal() {
        els.modal.classList.remove('is-open');
        els.modal.setAttribute('aria-hidden', 'true');
        togglePanHint(false);
      }

      function animateModalTitle(nextText) {
        els.modalTitle.classList.add('is-swapping');
        setTimeout(() => {
          els.modalTitle.textContent = nextText;
          els.modalTitle.classList.remove('is-swapping');
        }, 160);
      }

      function togglePanHint(show) {
        if (!els.panHint) return;
        if (show) {
          els.panHint.hidden = false;
          requestAnimationFrame(() => els.panHint.classList.add('is-visible'));
          return;
        }
        els.panHint.classList.remove('is-visible');
        setTimeout(() => {
          if (!els.panHint.classList.contains('is-visible')) els.panHint.hidden = true;
        }, 180);
      }

      function setZoom(v) {
        v = Math.min(300, Math.max(50, v));
        state.currentZoom = v;
        if (els.zoomSlider) els.zoomSlider.value = v;
        const canvas = document.getElementById('deckPlanCanvas');
        if (canvas) canvas.style.transform = `scale(${v/100})`;
        if (v > 100 && !state.panHintShown) {
          togglePanHint(true);
          state.panHintShown = true;
          sessionStorage.setItem('deck_pan_hint_shown', '1');
          setTimeout(() => togglePanHint(false), 2400);
        }
      }

      function renderModalPlan(deck) {
        const existingCanvas = document.getElementById('deckPlanCanvas');
        if (existingCanvas) existingCanvas.classList.add('is-transitioning');

        els.modalFrame.innerHTML = `<div class="deck-plan-skeleton" aria-hidden="true"></div>`;

        setTimeout(() => {
          const hotspots = deckHotspots[deck.number] || [];
          const chips = deckFocusMap[deck.number] || [];
          els.modalFocusChips.innerHTML = chips.map(l => `<button class="deck-focuschip">${l}</button>`).join('');
          const hotspotButtons = hotspots.map((s,i) => `
            <button class="deck-hotspot" style="left:${s.x}%; top:${s.y}%;" data-hotspot-id="${s.id}" data-title="${s.title}" data-note="${s.note}" data-highlight="${s.highlight ? 'true' : 'false'}">${i+1}</button>
          `).join('');

          els.modalFrame.innerHTML = `
            <div class="deck-plan-stage" id="deckPlanStage">
              <div class="deck-plan-canvas is-transitioning" id="deckPlanCanvas" style="transform:scale(${state.currentZoom/100});">
                <img class="deck-plan-media" src="${deck.svg || 'decks/deck-12.png'}" alt="${deck.name}">
                ${hotspots.length ? `<div class="deck-plan-hotspots">${hotspotButtons}</div>` : ''}
              </div>
            </div>
            ${hotspots.length ? `<div class="deck-plan-legend">${hotspots.map((s,i)=> `<button class="deck-plan-legend-item" data-hotspot-id="${s.id}"><strong>${i+1}. ${s.title}</strong><span>${s.note}</span></button>`).join('')}</div>` : ''}
          `;
          attachPan();

          const newCanvas = document.getElementById('deckPlanCanvas');
          if (newCanvas) {
            requestAnimationFrame(() => newCanvas.classList.remove('is-transitioning'));
          }
        }, 180);
      }

      function renderFocusChips(deck) {
        // already done in renderModalPlan
      }

      function selectHotspotById(hotspotId) {
        const target = els.modalFrame.querySelector(`.deck-hotspot[data-hotspot-id="${hotspotId}"]`);
        if (!target) return;
        els.modalFrame.querySelectorAll('.deck-hotspot').forEach(btn => {
          btn.dataset.selected = (btn.dataset.hotspotId === hotspotId) ? 'true' : 'false';
        });
        els.modalFrame.querySelectorAll('.deck-plan-legend-item').forEach(btn => {
          btn.classList.toggle('is-active', btn.dataset.hotspotId === hotspotId);
        });
        target.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
      }

      function attachPan() {
        const stage = document.getElementById('deckPlanStage');
        if (!stage) return;
        stage.addEventListener('pointerdown', (e) => {
          if (state.currentZoom <= 100) return;
          state.dragging = true;
          state.dragStartX = e.clientX;
          state.dragStartY = e.clientY;
          state.dragStartLeft = stage.scrollLeft;
          state.dragStartTop = stage.scrollTop;
          stage.setPointerCapture(e.pointerId);
        });
        stage.addEventListener('pointermove', (e) => {
          if (!state.dragging) return;
          stage.scrollLeft = state.dragStartLeft - (e.clientX - state.dragStartX);
          stage.scrollTop = state.dragStartTop - (e.clientY - state.dragStartY);
        });
        stage.addEventListener('pointerup', () => state.dragging = false);
        stage.addEventListener('pointercancel', () => state.dragging = false);
      }

      function setActiveDeck(num) {
        document.querySelectorAll('.deck-quickbtn').forEach(b => b.classList.toggle('is-active', Number(b.dataset.deck) === num));
        document.querySelectorAll('.deck-pill').forEach(b => b.classList.toggle('is-active', Number(b.dataset.deck) === num));
      }

      // --- EVENT LISTENERS ---
      function bindEvents() {
        // Filter buttons
        document.querySelectorAll('.pill-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('is-active'));
            btn.classList.add('is-active');
            state.filter = btn.dataset.filter;
            renderDeckCards(state.filter, state.search);
          });
        });

        els.search.addEventListener('input', e => {
          state.search = e.target.value.toLowerCase();
          renderDeckCards(state.filter, state.search);
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === '/' && document.activeElement !== els.search) {
            e.preventDefault();
            els.search.focus();
          }
          if (e.key === 'Escape') closeModal();
        });

        // Open card from grid
        els.cards.addEventListener('click', (e) => {
          const card = e.target.closest('.deck-card');
          if (!card) return;
          const deck = deckData.find(d => d.number === Number(card.dataset.deck));
          if (deck) openModal(deck);
        });

        // Quick rail
        els.quickRail.addEventListener('click', (e) => {
          const btn = e.target.closest('.deck-quickbtn');
          if (btn) {
            const deck = deckData.find(d => d.number === Number(btn.dataset.deck));
            if (deck) openModal(deck);
          }
        });

        // Category pills
        document.addEventListener('click', (e) => {
          const pill = e.target.closest('.deck-pill');
          if (pill) {
            const deck = deckData.find(d => d.number === Number(pill.dataset.deck));
            if (deck) openModal(deck);
          }
        });

        // Modal actions
        els.modal.addEventListener('click', (e) => {
          const hotspot = e.target.closest('.deck-hotspot');
          if (hotspot) {
            selectHotspotById(hotspot.dataset.hotspotId);
            return;
          }
          const legend = e.target.closest('.deck-plan-legend-item');
          if (legend) {
            selectHotspotById(legend.dataset.hotspotId);
            return;
          }
          const focusChip = e.target.closest('.deck-focuschip');
          if (focusChip) {
            els.modalFocusChips.querySelectorAll('.deck-focuschip').forEach(btn => btn.classList.remove('is-active'));
            focusChip.classList.add('is-active');
            const needle = (focusChip.textContent || '').toLowerCase();
            const match = [...els.modalFrame.querySelectorAll('.deck-hotspot')]
              .find(btn => (btn.dataset.title || '').toLowerCase().includes(needle));
            if (match) selectHotspotById(match.dataset.hotspotId);
            return;
          }
          const trigger = e.target.closest('[data-action]');
          const act = trigger?.dataset.action;
          if (act === 'close-modal') closeModal();
          if (act === 'zoom-in') setZoom(state.currentZoom + 25);
          if (act === 'zoom-out') setZoom(state.currentZoom - 25);
          if (act === 'zoom-reset') setZoom(100);
          if (act === 'prev-deck') {
            const sorted = deckData.filter(d => d.number !== 0).sort((a,b) => a.number - b.number);
            const idx = sorted.findIndex(d => d.number === state.currentDeck?.number);
            if (idx > 0) openModal(sorted[idx-1]);
          }
          if (act === 'next-deck') {
            const sorted = deckData.filter(d => d.number !== 0).sort((a,b) => a.number - b.number);
            const idx = sorted.findIndex(d => d.number === state.currentDeck?.number);
            if (idx < sorted.length-1) openModal(sorted[idx+1]);
          }
          if (act === 'center-me' && state.currentDeck?.number === 6) {
            const aft = document.querySelector('[data-hotspot-id="aft-cabins"]');
            if (aft) aft.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
          }
        });

        // Zoom slider
        if (els.zoomSlider) {
          els.zoomSlider.addEventListener('input', (e) => {
            setZoom(parseInt(e.target.value, 10));
          });
        }

        // Clear filters
        if (els.clearFilters) {
          els.clearFilters.addEventListener('click', () => {
            state.search = '';
            els.search.value = '';
            state.filter = 'all';
            document.querySelectorAll('.pill-btn').forEach(b => b.classList.toggle('is-active', b.dataset.filter === 'all'));
            renderDeckCards('all', '');
          });
        }

        // Category toggle
        if (els.categoryToggle && els.categoryPanels) {
          els.categoryToggle.addEventListener('click', () => {
            const expanded = els.categoryToggle.getAttribute('aria-expanded') === 'true';
            const next = !expanded;
            els.categoryToggle.setAttribute('aria-expanded', String(next));
            els.categoryPanels.hidden = !next;
            els.categoryToggle.innerHTML = `${next ? 'Hide categories' : 'Show categories'} <i class="fas fa-chevron-down" aria-hidden="true"></i>`;
          });
        }

        // Back to top
        window.addEventListener('scroll', () => {
          if (window.scrollY > 400) {
            els.backToTop.classList.add('show');
          } else {
            els.backToTop.classList.remove('show');
          }
        });
        els.backToTop.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      function init() {
        renderQuickRail();
        renderPills();
        renderDeckCards();
        bindEvents();

        if (window.matchMedia('(max-width: 900px)').matches) {
          setTimeout(() => {
            const btn = document.querySelector('.deck-quickbtn[data-deck="6"]');
            if (btn) btn.scrollIntoView({ inline: 'center', behavior: 'smooth' });
          }, 300);
        }

        if (!localStorage.getItem('embarkationSeen')) {
          const hero = document.querySelector('.deck-hero');
          if (hero) hero.style.animation = 'heroGlow 2.5s ease-out';
          localStorage.setItem('embarkationSeen', 'true');
        }
      }

      init();
    })();
  </script>
</body>
</html>