<!DOCTYPE html>
<html lang="en" data-theme="light" data-theme-mode="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0079d4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="manifest" href="manifest.json?v=2">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg">
  <title>Deck Plans | Adventure of the Seas | Royal Caribbean</title>

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base.css?v=3">
  <link rel="stylesheet" href="css/utilities.css?v=3">
  <link rel="stylesheet" href="css/components.css?v=3">


  <style>
    .decks-page .deck-modal__toolbar,
    .decks-page .deck-modal__header,
    .decks-page .deck-modal__footer {
      background: #f8fcff;
      border-color: rgba(0, 82, 165, 0.14);
    }

    .decks-page .main-navigation__filters .pill-btn {
      transition: transform 180ms ease, box-shadow 180ms ease, background-color 180ms ease, border-color 180ms ease;
      box-shadow: 0 4px 12px rgba(6, 34, 68, 0.08);
    }

    .decks-page .main-navigation__filters .pill-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(6, 34, 68, 0.12);
    }

    .decks-page .main-navigation__filters .pill-btn:active {
      transform: translateY(0) scale(0.985);
      box-shadow: 0 3px 8px rgba(6, 34, 68, 0.1);
    }

    .decks-page .main-navigation__filters .pill-btn.is-active {
      box-shadow: 0 10px 22px rgba(0, 121, 212, 0.22);
    }

    .decks-page .deck-pill {
      transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease, background-color 180ms ease;
    }

    .decks-page .deck-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(6, 34, 68, 0.14);
    }

    .decks-page .deck-pill:active {
      transform: translateY(0) scale(0.985);
    }

    .decks-page .deck-pill.is-active {
      border-color: rgba(0, 121, 212, 0.48);
      background: linear-gradient(135deg, rgba(0, 121, 212, 0.12), rgba(255, 255, 255, 0.94));
      box-shadow: 0 10px 22px rgba(0, 121, 212, 0.2);
    }

    .decks-page .deck-cards {
      transition: opacity 220ms ease, transform 220ms ease;
    }

    .decks-page .deck-cards.is-switching {
      opacity: 0.58;
      transform: translateY(5px);
    }

    .decks-page .deck-card {
      transition: transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease, background-color 220ms ease;
    }

    .decks-page .deck-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(5, 24, 46, 0.14);
    }

    .decks-page .deck-card--active {
      border-color: rgba(0, 121, 212, 0.45);
      box-shadow: 0 16px 34px rgba(0, 121, 212, 0.2);
      background: linear-gradient(180deg, rgba(0, 121, 212, 0.06), rgba(255, 255, 255, 1) 44%);
    }

    .decks-page .deck-plan-stage {
      position: relative;
      width: 100%;
      min-height: 360px;
      max-height: 64vh;
      border-radius: 16px;
      overflow: auto;
      border: 1px solid rgba(0, 82, 165, 0.2);
      background:
        radial-gradient(circle at 14% 16%, rgba(0, 156, 255, 0.16), transparent 34%),
        linear-gradient(160deg, rgba(0, 42, 99, 0.9), rgba(0, 75, 161, 0.72));
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06), 0 10px 22px rgba(5, 22, 46, 0.22);
    }

    .decks-page .deck-plan-canvas {
      --plan-scale: 1;
      width: max-content;
      transform-origin: top left;
      transform: scale(var(--plan-scale));
      transition: transform 180ms ease;
      padding: 14px;
      position: relative;
    }

    .decks-page .deck-plan-media {
      width: min(1180px, calc(100vw - 90px));
      max-width: none;
      height: auto;
      display: block;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 8px 18px rgba(3, 24, 58, 0.24);
    }

    .decks-page .deck-plan-hotspots {
      position: absolute;
      inset: 14px;
      pointer-events: none;
    }

    .decks-page .deck-hotspot {
      position: absolute;
      transform: translate(-50%, -50%);
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.94);
      background: linear-gradient(145deg, #0ca8ff, #0069d0);
      color: #fff;
      font-size: 0.82rem;
      font-weight: 800;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 8px 18px rgba(0, 44, 110, 0.34);
      transition: transform 140ms ease, box-shadow 140ms ease;
    }

    .decks-page .deck-hotspot:hover,
    .decks-page .deck-hotspot:focus-visible {
      transform: translate(-50%, -50%) scale(1.08);
      box-shadow: 0 10px 22px rgba(0, 52, 126, 0.42);
      outline: none;
    }

    .decks-page .deck-hotspot[data-highlight="true"] {
      background: linear-gradient(145deg, #ffd86f, #f0a500);
      color: #17305d;
    }

    .decks-page .deck-plan-legend {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 10px;
    }

    .decks-page .deck-plan-legend-item {
      border: 1px solid rgba(0, 82, 165, 0.16);
      background: #f5fbff;
      border-radius: 11px;
      padding: 9px 11px;
      font-size: 0.84rem;
      color: #0f3f74;
      text-align: left;
      cursor: pointer;
      transition: background-color 120ms ease, border-color 120ms ease, transform 120ms ease;
    }

    .decks-page .deck-plan-legend-item:hover,
    .decks-page .deck-plan-legend-item:focus-visible {
      background: #e9f6ff;
      border-color: rgba(0, 121, 212, 0.36);
      transform: translateY(-1px);
      outline: none;
    }

    .decks-page .deck-plan-legend-item strong {
      display: block;
      font-size: 0.86rem;
      margin-bottom: 3px;
      color: #08335f;
    }

    @media (max-width: 768px) {
      .decks-page .deck-plan-stage {
        min-height: 300px;
      }

      .decks-page .deck-plan-media {
        width: min(1120px, calc(100vw - 56px));
      }
    }

  </style>
  <link rel="stylesheet" href="css/mobile-first.css?v=3">

  <!-- Shared shell -->
  <script src="js/shared-layout.js?v=16" defer></script>
</head>

<body class="app-theme-rcc decks-page page-shell">
  <a href="#main" class="skip-link">Skip to main content</a>
  <div id="sharedHeader" data-page="decks" data-ship-class="Voyager Class ‚Ä¢ 138,193 GT ‚Ä¢ 3,114 Guests" data-days-at-sea="6 Nights" data-port="Port Canaveral"></div>

  <main id="main" class="decks-shell" aria-label="Deck plans">
    <section class="deck-hero">
      <div class="container">
        <div class="deck-hero__eyebrow">Adventure of the Seas ¬∑ Feb 14‚Äì20, 2026</div>
        <h1 class="deck-hero__title">Deck Navigator</h1>
        <p class="deck-hero__subtitle">Find venues by intent fast: entertainment, wellness, and essential guest services.</p>
        <div class="deck-hero__highlights" aria-label="Deck highlights">
          <span class="deck-hero__tag"><i class="fas fa-compass" aria-hidden="true"></i> Route-first wayfinding</span>
          <span class="deck-hero__tag"><i class="fas fa-masks-theater" aria-hidden="true"></i> Venue clusters by deck</span>
          <span class="deck-hero__tag"><i class="fas fa-clock" aria-hidden="true"></i> Faster day-of movement</span>
        </div>
        <div class="page-spine" aria-label="Deck planning guide">
          <div class="page-spine__item">
            <span class="page-spine__label">Entertainment</span>
            <span class="page-spine__meta">Shows, lounges, and late-night zones</span>
          </div>
          <div class="page-spine__item">
            <span class="page-spine__label">Wellness</span>
            <span class="page-spine__meta">Pools, spa, and active-day decks</span>
          </div>
          <div class="page-spine__item">
            <span class="page-spine__label">Essentials</span>
            <span class="page-spine__meta">Transit routes and service desks</span>
          </div>
        </div>
        <div class="deck-hero__actions">
          <a class="btn btn--primary" href="#deck-directory">Open deck directory</a>
          <a class="btn btn--secondary" href="rooms.html">Find stateroom deck</a>
        </div>
      </div>
    </section>

    <section class="main-navigation" aria-label="Deck navigation">
      <div class="container main-navigation__inner">
        <div class="main-navigation__search" role="search">
          <i class="fas fa-search" aria-hidden="true"></i>
          <input id="deckSearch" type="search" placeholder="Search decks, venues, or amenities" aria-label="Search decks" autocomplete="off" />
          <span class="main-navigation__hint">Press / to focus</span>
        </div>
        <div class="main-navigation__filters" aria-label="Deck categories">
          <button class="pill-btn is-active" data-filter="all">All</button>
          <button class="pill-btn" data-filter="entertainment">Entertainment</button>
          <button class="pill-btn" data-filter="wellness">Wellness</button>
          <button class="pill-btn" data-filter="essential">Essential</button>
        </div>
      </div>
    </section>

    <section id="deck-directory" class="deck-directory container" aria-label="Deck directory by category">
      <article class="category-card" data-category="entertainment">
        <div class="category-card__heading">üé≠ Entertainment Decks</div>
        <div class="deck-pills" id="pill-entertainment"></div>
      </article>
      <article class="category-card" data-category="wellness">
        <div class="category-card__heading">üßò Wellness Decks</div>
        <div class="deck-pills" id="pill-wellness"></div>
      </article>
      <article class="category-card" data-category="essential">
        <div class="category-card__heading">üß≠ Essential Decks</div>
        <div class="deck-pills" id="pill-essential"></div>
      </article>
    </section>

    <section class="deck-grid container" aria-label="Deck list">
      <div class="deck-grid__header">
        <div>
          <h2 class="deck-grid__title">Deck Overview</h2>
          <p class="deck-grid__subtitle">Tap any deck to open the interactive plan.</p>
        </div>
        <div class="deck-grid__counts">
          <div class="count-chip"><span id="countVisible">0</span> showing</div>
          <div class="count-chip"><span id="countTotal">0</span> total</div>
        </div>
      </div>
      <div id="deckCards" class="deck-cards" role="list"></div>
      <div id="emptyState" class="deck-empty" hidden>
        <div class="empty-illustration" aria-hidden="true">üö¢</div>
        <h3>No matching decks found</h3>
        <div class="empty-diagnostics">
          <p>Your search didn‚Äôt match any decks.</p>
          <p>Try one of these quick links:</p>
          <ul>
            <li><button class="link-button" data-suggest="pool">Main Pool ¬∑ Deck 12</button></li>
            <li><button class="link-button" data-suggest="spa">Vitality Spa ¬∑ Deck 11</button></li>
            <li><button class="link-button" data-suggest="promenade">Promenade ¬∑ Deck 5</button></li>
          </ul>
        </div>
        <div class="empty-actions">
          <button class="btn btn--primary" id="clearFilters">Clear filters</button>
          <button class="btn btn--secondary" id="showAll">Browse all decks</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Deck modal -->
  <div class="deck-modal" id="deckModal" aria-hidden="true">
    <div class="deck-modal__backdrop" data-action="close-modal"></div>
    <div class="deck-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
      <div class="deck-modal__toolbar">
        <div class="toolbar-group" aria-label="Zoom controls">
          <button class="btn-icon" data-action="zoom-in" aria-label="Zoom in">+</button>
          <button class="btn-icon" data-action="zoom-out" aria-label="Zoom out">‚àí</button>
          <button class="btn-icon" data-action="zoom-reset" aria-label="Reset view">‚Ü∫</button>
          <span class="zoom-level" id="zoomLevel">100%</span>
        </div>
        <div class="toolbar-group" aria-label="Context actions">
          <button class="labeled-btn" data-action="center-me"><span>üìç</span> My Location</button>
          <a class="labeled-btn" id="downloadPlan" href="#" target="_blank" rel="noopener" aria-disabled="true"><span>‚¨á</span> Download PDF (Select deck)</a>
        </div>
        <button class="close-btn" data-action="close-modal" aria-label="Close">√ó</button>
      </div>
      <div class="deck-modal__body">
        <h3 id="modalTitle" class="deck-modal__title"></h3>
        <p id="modalDesc" class="deck-modal__subtitle"></p>
        <div class="deck-modal__frame" id="modalFrame" role="document"></div>
      </div>
    </div>
  </div>

  <div id="sharedFooter"></div>
  <div id="sharedBottomNav" data-page="decks"></div>

  <script>
    const deckData = [
      {
        number: 0,
        name: 'All Decks',
        subtitle: 'Ship Overview Blueprint',
        highlights: ['Full ship layout', 'Cross-deck context', 'Fast orientation'],
        description: 'Complete multi-deck blueprint for quick whole-ship orientation.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-all.min.svg',
        pdf: ''
      },
      {
        number: 5,
        name: 'Deck 5',
        subtitle: 'Promenade Level',
        highlights: ['Entertainment', 'Dining', 'Retail'],
        description: 'Entertainment, dining, and retail hub.',
        category: 'entertainment',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-05.svg',
        pdf: 'decks/deck-05.pdf'
      },
      {
        number: 14,
        name: 'Deck 14',
        subtitle: 'Sky Deck',
        highlights: ['Panoramic views', 'Lounges', 'Sun decks'],
        description: 'Panoramic observation and lounges.',
        category: 'entertainment',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-14.svg',
        pdf: 'decks/deck-14.pdf'
      },
      {
        number: 11,
        name: 'Deck 11',
        subtitle: 'Fitness & Spa',
        highlights: ['Spa', 'Fitness', 'Wellness'],
        description: 'Spa, fitness center, and relaxation zones.',
        category: 'wellness',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-11.svg',
        pdf: 'decks/deck-11.pdf'
      },
      {
        number: 12,
        name: 'Deck 12',
        subtitle: 'Pool Deck',
        highlights: ['Main pool', 'Solarium', 'Grill'],
        description: 'Pools, solarium, and casual dining.',
        category: 'wellness',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-12.svg',
        pdf: 'decks/deck-12.pdf'
      },
      {
        number: 15,
        name: 'Deck 15',
        subtitle: 'Sports & Observation',
        highlights: ['Sports court', 'Jog track', 'Views'],
        description: 'Upper sports and open-air running routes.',
        category: 'wellness',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-15.svg',
        pdf: 'decks/deck-15.pdf'
      },
      {
        number: 13,
        name: 'Deck 13',
        subtitle: 'Adventure Zone',
        highlights: ['FlowRider', 'Sky deck access', 'Activities'],
        description: 'High-energy activity spaces and top-deck transitions.',
        category: 'entertainment',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-13.svg',
        pdf: 'decks/deck-13.pdf'
      },
      {
        number: 10,
        name: 'Deck 10',
        subtitle: 'Stateroom Corridor',
        highlights: ['Cabins', 'Elevators', 'Quiet routes'],
        description: 'Primary stateroom deck with vertical transit access.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-10.svg',
        pdf: 'decks/deck-10.pdf'
      },
      {
        number: 9,
        name: 'Deck 9',
        subtitle: 'Midship Cabins',
        highlights: ['Cabins', 'Family zones', 'Wayfinding'],
        description: 'Cabin-focused deck with central wayfinding landmarks.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-09.svg',
        pdf: 'decks/deck-09.pdf'
      },
      {
        number: 8,
        name: 'Deck 8',
        subtitle: 'Stateroom Access',
        highlights: ['Cabins', 'Aft access', 'Guest routes'],
        description: 'Stateroom-heavy deck with quick access to upper venues.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-08.svg',
        pdf: 'decks/deck-08.pdf'
      },
      {
        number: 7,
        name: 'Deck 7',
        subtitle: 'Cabin Transit',
        highlights: ['Cabins', 'Quiet zones', 'Midship transit'],
        description: 'Cabin transit layer connecting core elevator stacks.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-07.svg',
        pdf: 'decks/deck-07.pdf'
      },
      {
        number: 6,
        name: 'Deck 6',
        subtitle: 'Stateroom Ring',
        highlights: ['Cabins', 'Family adjacency', 'Deck transitions'],
        description: 'Lower stateroom ring with family-friendly adjacency.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-06-final.min.svg',
        pdf: 'decks/deck-06.pdf'
      },
      {
        number: 4,
        name: 'Deck 4',
        subtitle: 'Dining & Entertainment',
        highlights: ['Main dining', 'Show venue', 'Guest circulation'],
        description: 'Lower entertainment and dining circulation deck.',
        category: 'entertainment',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-04.svg',
        pdf: 'decks/deck-04.pdf'
      },
      {
        number: 3,
        name: 'Deck 3',
        subtitle: 'Lobby & Guest Services',
        highlights: ['Guest services', 'Dining', 'Retail'],
        description: 'Main lobby, dining, and guest support.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-03.svg',
        pdf: 'decks/deck-03.pdf'
      },
      {
        number: 2,
        name: 'Deck 2',
        subtitle: 'Medical & Crew Support',
        highlights: ['Medical', 'Crew services', 'Logistics'],
        description: 'Medical center and crew-only services.',
        category: 'essential',
        image: 'deck-plans/deck-12.png',
        svg: 'decks/deck-02.svg',
        pdf: 'decks/deck-02.pdf'
      }
    ];

    const state = {
      filter: 'all',
      search: '',
      observer: null,
      trapFocus: null,
      lastOpenedDeck: null,
      switchTimer: null,
      currentDeck: null,
      currentZoom: 100
    };

    const deckHotspots = {
      6: [
        { id: 'aft-cabins', title: 'Aft cabin cluster', note: 'Quieter corridor with faster wake-view access.', x: 78, y: 58 },
        { id: 'midship-elevators', title: 'Midship elevators', note: 'Fastest transfer point to dining and promenade decks.', x: 52, y: 50 },
        { id: 'forward-stairs', title: 'Forward stairs', note: 'Best route to theater and lower-deck venues.', x: 26, y: 43 },
        { id: 'room-6650', title: 'Room 6650', note: 'Your stateroom zone is near the aft elevator bank.', x: 72, y: 56, highlight: true }
      ]
    };

    const els = {
      search: document.getElementById('deckSearch'),
      cards: document.getElementById('deckCards'),
      empty: document.getElementById('emptyState'),
      countVisible: document.getElementById('countVisible'),
      countTotal: document.getElementById('countTotal'),
      clearFilters: document.getElementById('clearFilters'),
      showAll: document.getElementById('showAll'),
      modal: document.getElementById('deckModal'),
      modalFrame: document.getElementById('modalFrame'),
      modalTitle: document.getElementById('modalTitle'),
      modalDesc: document.getElementById('modalDesc'),
      zoomLevel: document.getElementById('zoomLevel'),
      download: document.getElementById('downloadPlan')
    };

    const debounce = (fn, delay = 200) => {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), delay);
      };
    };

    function applyFilter(filter) {
      state.filter = filter;
      document.querySelectorAll('.pill-btn').forEach(btn => {
        btn.classList.toggle('is-active', btn.dataset.filter === filter);
      });
      if (state.switchTimer) clearTimeout(state.switchTimer);
      els.cards.classList.add('is-switching');
      renderCards();
      state.switchTimer = setTimeout(() => {
        els.cards.classList.remove('is-switching');
      }, 220);
    }

    function filterDecks() {
      const query = state.search.toLowerCase().trim();
      return deckData.filter(deck => {
        const matchesFilter = state.filter === 'all' || deck.category === state.filter;
        const searchable = `${deck.name} ${deck.subtitle} ${deck.highlights.join(' ')}`.toLowerCase();
        const matchesQuery = !query || searchable.includes(query);
        return matchesFilter && matchesQuery;
      });
    }

    function renderPills() {
      const buckets = { entertainment: [], wellness: [], essential: [] };
      deckData.forEach(deck => {
        if (buckets[deck.category]) buckets[deck.category].push(deck);
      });
      Object.entries(buckets).forEach(([key, decks]) => {
        const host = document.getElementById(`pill-${key}`);
        if (!host) return;
        host.innerHTML = decks.map(deck => `
          <button class="deck-pill" data-deck="${deck.number}" aria-label="Go to ${deck.number === 0 ? 'All Decks overview' : `Deck ${deck.number} ${deck.subtitle}`}">
            <span class="deck-pill__number">${deck.number === 0 ? 'ALL' : deck.number}</span>
            <span class="deck-pill__text">${deck.subtitle}</span>
          </button>
        `).join('');
      });
    }

    function lazyLoadImages() {
      if (state.observer) state.observer.disconnect();
      state.observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            state.observer.unobserve(img);
          }
        });
      }, { rootMargin: '120px 0px' });
      document.querySelectorAll('img[data-src]').forEach(img => state.observer.observe(img));
    }

    function renderCards() {
      const decks = filterDecks();
      els.countTotal.textContent = deckData.length;
      els.countVisible.textContent = decks.length;
      els.empty.hidden = decks.length > 0;
      els.cards.innerHTML = decks.map(deck => `
        <article class="deck-card ${state.lastOpenedDeck === deck.number ? 'deck-card--active' : ''}" role="listitem" tabindex="0" data-deck="${deck.number}" aria-label="${deck.name} ${deck.subtitle}">
          <div class="deck-visual">
            <span class="deck-number">${deck.number === 0 ? 'ALL' : deck.number}</span>
            <img data-src="${deck.image}" alt="${deck.name} preview" />
          </div>
          <div class="deck-info">
            <div class="deck-info__heading">
              <h3>${deck.name}</h3>
              <p class="deck-subtitle">${deck.subtitle}</p>
            </div>
            <div class="deck-meta">
              <span class="deck-meta__item">Voyager Class</span>
              <span class="deck-meta__item">Adventure of the Seas</span>
            </div>
            <div class="deck-highlights">
              ${deck.highlights.slice(0,3).map(text => `<span>${text}</span>`).join('')}
            </div>
            <p class="deck-subtitle" style="margin-top:10px;">
              ${deck.category === 'wellness'
                ? 'Related: Dining and pool-day planning'
                : deck.category === 'entertainment'
                  ? 'Related: Itinerary showtimes and evening flow'
                  : 'Related: Stateroom access and embarkation routes'}
            </p>
            <button class="deck-card__cta btn btn--nautical" data-action="open" aria-label="Open ${deck.name} plan">Explore ‚Üí</button>
          </div>
        </article>
      `).join('');
      lazyLoadImages();
    }

    function setActiveDeckPill(deckNumber) {
      document.querySelectorAll('.deck-pill').forEach(btn => {
        btn.classList.toggle('is-active', Number(btn.dataset.deck) === Number(deckNumber));
      });
    }

    function openModal(deck) {
      state.lastOpenedDeck = deck.number;
      state.currentDeck = deck;
      setActiveDeckPill(deck.number);
      renderCards();
      els.modalTitle.textContent = `${deck.name}`;
      els.modalDesc.textContent = deck.description;
      if (deck.pdf) {
        els.download.href = deck.pdf;
        els.download.setAttribute('aria-disabled', 'false');
        els.download.innerHTML = '<span>‚¨á</span> Download PDF';
      } else {
        els.download.href = '#';
        els.download.setAttribute('aria-disabled', 'true');
        els.download.innerHTML = '<span>‚¨á</span> PDF unavailable';
      }
      renderModalPlan(deck);
      els.modal.setAttribute('aria-hidden', 'false');
      els.modal.classList.add('is-open');
      setZoom(100);
      const focusable = els.modal.querySelectorAll('button, a');
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      state.trapFocus = (e) => {
        if (e.key !== 'Tab') return;
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      };
      document.addEventListener('keydown', state.trapFocus);
      first.focus({ preventScroll: true });
    }

    function closeModal() {
      els.modal.classList.remove('is-open');
      els.modal.setAttribute('aria-hidden', 'true');
      els.modalFrame.innerHTML = '';
      state.currentDeck = null;
      document.removeEventListener('keydown', state.trapFocus);
      state.trapFocus = null;
    }

    function setZoom(value) {
      const clamped = Math.min(300, Math.max(50, value));
      state.currentZoom = clamped;
      els.zoomLevel.textContent = `${clamped}%`;
      const canvas = document.getElementById('deckPlanCanvas');
      if (canvas) {
        canvas.style.setProperty('--plan-scale', (clamped / 100).toFixed(2));
      }
    }

    function adjustZoom(delta) {
      const current = parseInt(els.zoomLevel.textContent.replace('%', ''), 10) || 100;
      setZoom(current + delta);
    }

    function handleCardClick(e) {
      const card = e.target.closest('.deck-card');
      if (!card) return;
      const deckNum = Number(card.dataset.deck);
      const deck = deckData.find(d => d.number === deckNum);
      if (deck) openModal(deck);
    }

    function renderModalPlan(deck) {
      const hotspots = deckHotspots[deck.number] || [];
      const hotspotMarkup = hotspots.map((spot, index) => `
        <button
          class="deck-hotspot"
          type="button"
          data-hotspot-id="${spot.id}"
          data-note="${spot.note}"
          data-title="${spot.title}"
          data-highlight="${spot.highlight ? 'true' : 'false'}"
          style="left:${spot.x}%; top:${spot.y}%;"
          aria-label="${spot.title}"
          title="${spot.title}"
        >${index + 1}</button>
      `).join('');

      const legendMarkup = hotspots.length ? `
        <div class="deck-plan-legend" aria-label="Deck focus points">
          ${hotspots.map((spot, index) => `
            <button class="deck-plan-legend-item" type="button" data-hotspot-id="${spot.id}">
              <strong>${index + 1}. ${spot.title}</strong>
              <span>${spot.note}</span>
            </button>
          `).join('')}
        </div>
      ` : '';

      els.modalFrame.innerHTML = `
        <div class="deck-plan-stage" id="deckPlanStage">
          <div class="deck-plan-canvas" id="deckPlanCanvas">
            <img class="deck-plan-media" src="${deck.svg}" alt="${deck.name} plan" loading="eager" />
            ${hotspots.length ? `<div class="deck-plan-hotspots">${hotspotMarkup}</div>` : ''}
          </div>
        </div>
        ${legendMarkup}
      `;
    }

    function bindEvents() {
      document.querySelectorAll('.pill-btn').forEach(btn => {
        btn.addEventListener('click', () => applyFilter(btn.dataset.filter));
      });

      els.search.addEventListener('input', debounce((e) => {
        state.search = e.target.value;
        renderCards();
      }, 180));

      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && document.activeElement !== els.search) {
          e.preventDefault();
          els.search.focus();
        }
        if (e.key === 'Escape') closeModal();
        if (e.key === 'Enter' && document.activeElement?.classList.contains('deck-card__cta')) {
          document.activeElement.click();
        }
      });

      document.getElementById('deckCards').addEventListener('click', (e) => {
        if (e.target.matches('[data-action="open"]') || e.target.closest('.deck-card')) {
          handleCardClick(e);
        }
      });

      document.getElementById('deckCards').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          handleCardClick(e);
        }
      });

      document.querySelectorAll('[data-action="close-modal"]').forEach(el => {
        el.addEventListener('click', closeModal);
      });

      els.modal.addEventListener('click', (e) => {
        const action = e.target.dataset.action;
        if (action === 'zoom-in') adjustZoom(25);
        if (action === 'zoom-out') adjustZoom(-25);
        if (action === 'zoom-reset') setZoom(100);
        if (action === 'center-me') {
          const focusTarget =
            els.modalFrame.querySelector('.deck-hotspot[data-highlight="true"]') ||
            els.modalFrame.querySelector('.deck-hotspot');
          if (focusTarget) {
            focusTarget.focus({ preventScroll: true });
            focusTarget.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
            els.modalDesc.textContent = focusTarget.dataset.note || 'Centered on your location marker.';
          } else {
            els.modalDesc.textContent = 'No location markers available on this deck.';
          }
        }
      });

      els.modalFrame.addEventListener('click', (e) => {
        const hotspot = e.target.closest('.deck-hotspot, .deck-plan-legend-item');
        if (!hotspot) return;
        const id = hotspot.dataset.hotspotId;
        const target = id ? els.modalFrame.querySelector(`.deck-hotspot[data-hotspot-id="${id}"]`) : null;
        if (!target) return;
        target.focus({ preventScroll: true });
        target.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
        els.modalDesc.textContent = target.dataset.note || target.dataset.title || state.currentDeck?.description || '';
      });

      els.download.addEventListener('click', (e) => {
        if (els.download.getAttribute('aria-disabled') === 'true') {
          e.preventDefault();
        }
      });

      document.querySelectorAll('.deck-pill').forEach(btn => {
        btn.addEventListener('click', () => {
          const deck = deckData.find(d => d.number === Number(btn.dataset.deck));
          if (!deck) return;
          setActiveDeckPill(deck.number);
          openModal(deck);
        });
      });

      els.clearFilters.addEventListener('click', () => {
        state.search = '';
        els.search.value = '';
        applyFilter('all');
      });
      els.showAll.addEventListener('click', () => {
        state.search = '';
        els.search.value = '';
        applyFilter('all');
      });

      document.querySelectorAll('.link-button').forEach(btn => {
        btn.addEventListener('click', () => {
          els.search.value = btn.dataset.suggest || '';
          state.search = els.search.value;
          renderCards();
        });
      });
    }

    function init() {
      renderPills();
      renderCards();
      bindEvents();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
