<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <title>Deck Plans | Adventure of the Seas</title>

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- 3D Library -->
    <script src="https://unpkg.com/three@0.132.2/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    <script src="shared-layout.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --gradient-primary: linear-gradient(135deg, #2563eb 0%, #8b5cf6 100%);
            --gradient-dark: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --gradient-accent: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --glow: 0 0 20px rgba(37, 99, 235, 0.3);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(37, 99, 235, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            opacity: 0.3;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Glass Morphism */
        .glass {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-xl);
        }

        .glass-light {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Header Enhancements */
        .header {
            background: var(--gradient-dark);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-xl);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Hero Section */
        .hero {
            position: relative;
            padding: 6rem 2rem 4rem;
            background: var(--gradient-dark);
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><path fill="%2306b6d4" opacity="0.1" d="M0 0h1200v600H0z"/><g fill="none" stroke="%232563eb" stroke-width="2"><path d="M0 300h1200M600 0v600"/><circle cx="600" cy="300" r="200"/></g></svg>') center/cover no-repeat;
            opacity: 0.1;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .hero-badges {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .hero-badge {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid rgba(6, 182, 212, 0.3);
            color: var(--accent);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .hero-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(6, 182, 212, 0.2);
        }

        .hero-badge--gold {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
            border-color: rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }

        .hero-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.8);
            max-width: 800px;
            margin: 0 auto 3rem;
            line-height: 1.6;
        }

        /* Interactive Elements */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: var(--transition);
            font-family: 'Montserrat', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl), var(--glow);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: white;
            transform: translateY(-3px);
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-icon:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: var(--shadow-lg), var(--glow);
        }

        /* Main Layout */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        /* Enhanced Sidebar */
        .sidebar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: 2rem;
            height: fit-content;
            position: sticky;
            top: 120px;
            box-shadow: var(--shadow-xl);
        }

        .sidebar-section {
            margin-bottom: 2.5rem;
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Deck Navigation */
        .deck-nav {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .deck-nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .deck-nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .deck-nav-item:hover::before {
            left: 100%;
        }

        .deck-nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            color: white;
            transform: translateX(8px);
        }

        .deck-nav-item.active {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.2), rgba(139, 92, 246, 0.2));
            border-color: var(--primary);
            color: white;
            box-shadow: var(--glow);
        }

        .deck-number-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .deck-nav-item.active .deck-number-badge {
            background: var(--gradient-primary);
            color: white;
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-md);
        }

        /* Filter Chips */
        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .filter-chip {
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .filter-chip:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        /* Main Content */
        .content-main {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            box-shadow: var(--shadow-xl);
        }

        /* Content Header */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-left h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-left p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }

        /* Stats Cards */
        .deck-stats {
            display: flex;
            gap: 1.5rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            min-width: 150px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Enhanced Search */
        .search-container {
            position: relative;
            margin-bottom: 2.5rem;
        }

        .search-input {
            width: 100%;
            padding: 1.5rem 1.5rem 1.5rem 4rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            color: white;
            font-size: 1.1rem;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2), var(--glow);
            background: rgba(255, 255, 255, 0.1);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-icon {
            position: absolute;
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-size: 1.25rem;
        }

        .search-hint {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            opacity: 0.8;
            pointer-events: none;
        }

        /* Deck Cards Grid */
        .decks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 2rem;
            opacity: 0;
            animation: fadeIn 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .decks-grid.compact {
            grid-template-columns: 1fr;
        }

        @media (max-width: 768px) {
            .decks-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Enhanced Deck Card */
        .deck-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: 2rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.4s ease-out forwards;
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .deck-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition);
        }

        .deck-card:hover::before {
            opacity: 1;
        }

        .deck-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            box-shadow: var(--shadow-2xl), var(--glow);
        }

        .deck-card.active {
            border-color: var(--primary);
            box-shadow: var(--shadow-2xl), var(--glow);
        }

        .deck-card-content {
            display: grid;
            gap: 2rem;
        }

        /* Deck Image with Hover Effect */
        .deck-image {
            width: 100%;
            height: 220px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .deck-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition-slow);
        }

        .deck-card:hover .deck-image img {
            transform: scale(1.1);
        }

        .deck-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(15, 23, 42, 0.8));
            pointer-events: none;
        }

        /* Deck Header */
        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .deck-title {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .deck-number {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            color: white;
            box-shadow: var(--shadow-xl);
            flex-shrink: 0;
            transition: var(--transition);
        }

        .deck-card:hover .deck-number {
            transform: scale(1.1) rotate(15deg);
        }

        .deck-title-text h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }

        .deck-title-text p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        /* Features Grid */
        .deck-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: var(--transition);
        }

        .feature-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .feature-icon {
            color: var(--accent);
            font-size: 1.25rem;
        }

        /* Action Buttons */
        .deck-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition-slow);
        }

        .deck-card:hover .deck-actions,
        .deck-card.active .deck-actions {
            opacity: 1;
            transform: translateY(0);
        }

        .action-btn {
            flex: 1;
            padding: 1.25rem 1.5rem;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn.primary {
            background: var(--gradient-primary);
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl), var(--glow);
        }

        .action-btn.secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .action-btn.secondary:hover {
            background: rgba(37, 99, 235, 0.1);
            transform: translateY(-3px);
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            display: flex;
            gap: 0.75rem;
            opacity: 0;
            transform: translateX(20px);
            transition: var(--transition);
            z-index: 10;
        }

        .deck-card:hover .quick-actions {
            opacity: 1;
            transform: translateX(0);
        }

        .quick-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-btn:hover {
            background: var(--gradient-primary);
            color: white;
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-md);
        }

        /* Modal Enhancements */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.9);
            backdrop-filter: blur(20px);
            display: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .modal-overlay.active {
            display: block;
            opacity: 1;
        }

        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            width: 95%;
            max-width: 1400px;
            max-height: 90vh;
            overflow: hidden;
            z-index: 2001;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition-slow);
            box-shadow: var(--shadow-2xl);
        }

        .modal-container.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .modal-header {
            padding: 1.5rem 2rem;
            background: rgba(2, 6, 23, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .modal-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Canvas for 3D */
        #deck3d {
            width: 100%;
            height: 500px;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            display: none;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 1.25rem 1.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 3000;
            box-shadow: var(--shadow-xl);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-icon {
            color: var(--success);
            font-size: 1.5rem;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: var(--shadow-2xl), var(--glow);
        }

        /* Progress Indicator */
        .progress-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform-origin: 0%;
            transform: scaleX(0);
            z-index: 1001;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .main-container {
                padding: 1rem;
            }
            
            .content-header {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }
            
            .deck-stats {
                justify-content: center;
            }
            
            .deck-actions {
                flex-direction: column;
            }
            
            .fab {
                bottom: 5rem;
            }
        }

        /* View Mode Toggle */
        .view-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 0.5rem;
        }

        .view-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .view-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .view-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        /* Deck Type Badges */
        .deck-badge {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(37, 99, 235, 0.2));
            color: var(--accent);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }
    </style>
</head>
<body>
    <div id="sharedHeader" data-page="decks" data-menu-toggle="true"></div>

    <!-- Progress Indicator -->
    <div class="progress-indicator" id="progressIndicator"></div>

    <!-- Floating Action Button -->
    <button class="fab" id="fabToggle" title="Toggle 3D View">
        <i class="fas fa-cube"></i>
    </button>

    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container hero-content">
            <div class="hero-badges">
                <span class="hero-badge"><i class="fas fa-map-marked-alt"></i> Interactive Deck Navigator</span>
                <span class="hero-badge hero-badge--gold"><i class="fas fa-ship"></i> Adventure of the Seas</span>
                <span class="hero-badge"><i class="fas fa-expand-arrows-alt"></i> 14 Decks</span>
            </div>
            <h1 class="hero-title">Navigate Your Adventure</h1>
            <p class="hero-subtitle">Explore interactive deck plans with 3D visualization, real-time filtering, and immersive ship navigation. Find amenities, staterooms, and entertainment venues with ease.</p>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="toggle3DView()">
                    <i class="fas fa-cube"></i>
                    3D Ship View
                </button>
                <button class="btn btn-outline" onclick="showAllDecks()">
                    <i class="fas fa-layer-group"></i>
                    Show All Decks
                </button>
                <button class="btn btn-outline" onclick="toggleVirtualTour()">
                    <i class="fas fa-vr-cardboard"></i>
                    Virtual Tour
                </button>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar glass">
            <div class="sidebar-section">
                <h3 class="section-title">
                    <i class="fas fa-ship"></i>
                    Deck Navigation
                </h3>
                <div class="deck-nav" id="deckNav">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="section-title">
                    <i class="fas fa-filter"></i>
                    Filter Amenities
                </h3>
                <div class="filter-chips" id="filterChips">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="section-title">
                    <i class="fas fa-eye"></i>
                    View Options
                </h3>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid" onclick="changeViewMode('grid')">
                        <i class="fas fa-th-large"></i>
                        Grid
                    </button>
                    <button class="view-btn" data-view="compact" onclick="changeViewMode('compact')">
                        <i class="fas fa-list"></i>
                        List
                    </button>
                    <button class="view-btn" data-view="detailed" onclick="changeViewMode('detailed')">
                        <i class="fas fa-expand"></i>
                        Detailed
                    </button>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="section-title">
                    <i class="fas fa-route"></i>
                    Quick Routes
                </h3>
                <div class="quick-routes">
                    <button class="filter-chip" onclick="routeTo('dining')">
                        <i class="fas fa-utensils"></i>
                        Dining Decks
                    </button>
                    <button class="filter-chip" onclick="routeTo('entertainment')">
                        <i class="fas fa-masks-theater"></i>
                        Entertainment
                    </button>
                    <button class="filter-chip" onclick="routeTo('pools')">
                        <i class="fas fa-swimming-pool"></i>
                        Pool Areas
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content-main glass">
            <!-- 3D View Canvas -->
            <canvas id="deck3d"></canvas>
            
            <div class="content-header">
                <div class="header-left">
                    <h2 id="currentDeckTitle">Ship Deck Plans</h2>
                    <p id="deckSubtitle">Interactive navigation with 3D visualization</p>
                </div>
                <div class="deck-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalDecks">14</div>
                        <div class="stat-label">Total Decks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="visibleDecks">14</div>
                        <div class="stat-label">Showing</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="amenitiesCount">36</div>
                        <div class="stat-label">Amenities</div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Search -->
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="Search decks, venues, restaurants, pools...">
                <div class="search-hint" id="searchHint">Try "pool" or "restaurant"</div>
            </div>
            
            <!-- Decks Grid -->
            <div class="decks-grid" id="decksGrid">
                <!-- Generated by JavaScript -->
            </div>
            
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <i class="fas fa-map-marked-alt"></i>
                <h3>No Decks Found</h3>
                <p>Try adjusting your search or clearing filters</p>
                <button class="action-btn secondary" onclick="clearFilters()">
                    <i class="fas fa-times-circle"></i>
                    Clear All Filters
                </button>
            </div>
        </main>
    </div>

    <!-- Enhanced Modal -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal-container glass" id="modalContainer">
        <div class="modal-header">
            <h3 id="modalTitle">
                <i class="fas fa-ship"></i>
                Deck Plan Viewer
            </h3>
            <div class="modal-actions">
                <button class="btn-icon" onclick="zoomIn()" title="Zoom In">
                    <i class="fas fa-search-plus"></i>
                </button>
                <button class="btn-icon" onclick="zoomOut()" title="Zoom Out">
                    <i class="fas fa-search-minus"></i>
                </button>
                <a class="btn btn-primary" id="modalDownload" href="#" target="_blank" rel="noopener">
                    <i class="fas fa-download"></i>
                    Download PDF
                </a>
                <button class="btn-icon" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="modal-body">
            <div class="modal-loading" id="modalLoading">
                <div class="spinner"></div>
                <p>Loading high-resolution deck plan...</p>
            </div>
            <div class="modal-content" id="modalContent">
                <img id="modalImage" class="modal-image" alt="Deck plan preview" loading="lazy">
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast glass" id="toast">
        <i class="fas fa-check-circle toast-icon"></i>
        <div class="toast-content">
            <div class="toast-title" id="toastTitle">Success</div>
            <div class="toast-message" id="toastMessage">Operation completed</div>
        </div>
    </div>

    <!-- Virtual Tour Modal -->
    <div class="modal-overlay" id="tourOverlay"></div>
    <div class="modal-container glass" id="tourModal">
        <div class="modal-header">
            <h3><i class="fas fa-vr-cardboard"></i> Virtual Ship Tour</h3>
            <div class="modal-actions">
                <button class="btn-icon" onclick="prevTourStop()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="btn-icon" onclick="nextTourStop()">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn-icon" onclick="closeTour()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="modal-body">
            <div id="tourContent"></div>
        </div>
    </div>

    <div id="sharedFooter" data-page="decks"></div>

    <nav class="mobile-nav glass">
        <a href="index.html" class="mobile-nav-item"><span class="mobile-nav-icon"><i class="fas fa-home"></i></span><span>Home</span></a>
        <a href="itinerary.html" class="mobile-nav-item"><span class="mobile-nav-icon"><i class="fas fa-calendar-alt"></i></span><span>Schedule</span></a>
        <a href="operations.html" class="mobile-nav-item"><span class="mobile-nav-icon"><i class="fas fa-cogs"></i></span><span>Ops</span></a>
        <a href="rooms.html" class="mobile-nav-item"><span class="mobile-nav-icon"><i class="fas fa-bed"></i></span><span>Rooms</span></a>
        <a href="decks.html" class="mobile-nav-item active"><span class="mobile-nav-icon"><i class="fas fa-map"></i></span><span>Decks</span></a>
        <a href="dining.html" class="mobile-nav-item"><span class="mobile-nav-icon"><i class="fas fa-utensils"></i></span><span>Dining</span></a>
        <a href="tips.html" class="mobile-nav-item"><span class="mobile-nav-icon"><i class="fas fa-star"></i></span><span>Tips</span></a>
    </nav>

    <script>
        // Enhanced deck data with more details
        const deckData = [
            {
                number: 2,
                name: 'Deck 2',
                subtitle: 'Medical & Crew Support',
                description: 'Medical center and crew-only services.',
                amenities: ['Medical', 'Crew Areas', 'Laundry', 'Storage'],
                highlights: ['Medical Center', 'Crew Quarters', 'Laundry Services', 'Technical Storage'],
                pdf: 'decks/deck-02.pdf',
                svg: 'decks/deck-02.svg',
                image: 'https://images.unsplash.com/photo-1582750433449-648ed127bb54?auto=format&fit=crop&w=800&q=80',
                type: 'service',
                color: '#06b6d4'
            },
            {
                number: 3,
                name: 'Deck 3',
                subtitle: 'Lobby & Guest Services',
                description: 'Main lobby, dining, and guest support.',
                amenities: ['Guest Services', 'Dining', 'Retail', 'Information'],
                highlights: ['Royal Promenade', 'Guest Services', 'Shops', 'Information Desk'],
                pdf: 'decks/deck-03.pdf',
                svg: 'decks/deck-03.svg',
                image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=800&q=80',
                type: 'main',
                color: '#2563eb'
            },
            {
                number: 5,
                name: 'Deck 5',
                subtitle: 'Promenade Level',
                description: 'Entertainment, dining, and retail hub.',
                amenities: ['Entertainment', 'Dining', 'Retail', 'Bars'],
                highlights: ['Promenade Cafes', 'Retail Arcade', 'Bars & Lounges', 'Live Music'],
                pdf: 'decks/deck-05.pdf',
                svg: 'decks/deck-05.svg',
                image: 'https://images.unsplash.com/photo-1519677100203-6f5d4c7a08c9?auto=format&fit=crop&w=800&q=80',
                type: 'entertainment',
                color: '#8b5cf6'
            },
            {
                number: 11,
                name: 'Deck 11',
                subtitle: 'Fitness & Spa',
                description: 'Spa, fitness center, and relaxation zones.',
                amenities: ['Fitness', 'Spa', 'Wellness', 'Sauna'],
                highlights: ['Fitness Center', 'Spa Treatments', 'Relaxation Lounge', 'Sauna & Steam'],
                pdf: 'decks/deck-11.pdf',
                svg: 'decks/deck-11.svg',
                image: 'https://images.unsplash.com/photo-1540497077202-7c8a3999166f?auto=format&fit=crop&w=800&q=80',
                type: 'wellness',
                color: '#10b981'
            },
            {
                number: 12,
                name: 'Deck 12',
                subtitle: 'Pool Deck',
                description: 'Main pools, sun decks, and casual dining.',
                amenities: ['Pools', 'Dining', 'Outdoors', 'Bar'],
                highlights: ['Main Pool', 'Solarium', 'Poolside Grill', 'Pool Bar'],
                pdf: 'decks/deck-12.pdf',
                svg: 'decks/deck-12.svg',
                image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&w=800&q=80',
                type: 'recreation',
                color: '#0ea5e9'
            },
            {
                number: 14,
                name: 'Deck 14',
                subtitle: 'Sky Deck',
                description: 'Panoramic decks and entertainment.',
                amenities: ['Outdoors', 'Entertainment', 'Views'],
                highlights: ['Sky Lounge', 'Observation Areas', 'Sun Deck', 'Stargazing'],
                pdf: 'decks/deck-14.pdf',
                svg: 'decks/deck-14.svg',
                image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=800&q=80',
                type: 'premium',
                color: '#f59e0b'
            }
        ];

        // Enhanced filter configuration
        const filterConfig = [
            { key: 'Staterooms', label: 'Staterooms', icon: 'fa-bed', color: '#3b82f6' },
            { key: 'Dining', label: 'Dining', icon: 'fa-utensils', color: '#10b981' },
            { key: 'Entertainment', label: 'Entertainment', icon: 'fa-masks-theater', color: '#8b5cf6' },
            { key: 'Pools', label: 'Pools', icon: 'fa-person-swimming', color: '#06b6d4' },
            { key: 'Fitness', label: 'Fitness', icon: 'fa-dumbbell', color: '#ef4444' },
            { key: 'Spa', label: 'Spa', icon: 'fa-spa', color: '#ec4899' },
            { key: 'Retail', label: 'Shops', icon: 'fa-shopping-bag', color: '#f59e0b' },
            { key: 'Guest Services', label: 'Services', icon: 'fa-concierge-bell', color: '#64748b' },
            { key: 'Outdoors', label: 'Outdoors', icon: 'fa-mountain-sun', color: '#22c55e' }
        ];

        // Application state
        const state = {
            activeFilters: new Set(),
            activeDeck: null,
            viewMode: 'grid',
            searchQuery: '',
            zoomLevel: 1,
            is3DView: false,
            tourActive: false,
            tourStep: 0
        };

        // DOM Elements
        const elements = {
            deckNav: document.getElementById('deckNav'),
            decksGrid: document.getElementById('decksGrid'),
            filterChips: document.getElementById('filterChips'),
            searchInput: document.getElementById('searchInput'),
            emptyState: document.getElementById('emptyState'),
            totalDecks: document.getElementById('totalDecks'),
            visibleDecks: document.getElementById('visibleDecks'),
            amenitiesCount: document.getElementById('amenitiesCount'),
            currentDeckTitle: document.getElementById('currentDeckTitle'),
            deckSubtitle: document.getElementById('deckSubtitle'),
            modalOverlay: document.getElementById('modalOverlay'),
            modalContainer: document.getElementById('modalContainer'),
            modalTitle: document.getElementById('modalTitle'),
            modalDownload: document.getElementById('modalDownload'),
            modalImage: document.getElementById('modalImage'),
            modalLoading: document.getElementById('modalLoading'),
            modalContent: document.getElementById('modalContent'),
            toast: document.getElementById('toast'),
            toastTitle: document.getElementById('toastTitle'),
            toastMessage: document.getElementById('toastMessage'),
            fabToggle: document.getElementById('fabToggle'),
            deck3d: document.getElementById('deck3d'),
            progressIndicator: document.getElementById('progressIndicator'),
            particles: document.getElementById('particles'),
            tourOverlay: document.getElementById('tourOverlay'),
            tourModal: document.getElementById('tourModal'),
            tourContent: document.getElementById('tourContent')
        };

        // Initialize particles
        function initParticles() {
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = `${Math.random() * 4 + 2}px`;
                particle.style.height = particle.style.width;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 20}s`;
                particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
                elements.particles.appendChild(particle);
            }
        }

        // Initialize 3D view
        function init3DView() {
            const canvas = elements.deck3d;
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            
            renderer.setSize(canvas.width, canvas.height);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            
            // Create ship hull
            const hullGeometry = new THREE.BoxGeometry(20, 8, 60);
            const hullMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x2563eb,
                shininess: 100
            });
            const hull = new THREE.Mesh(hullGeometry, hullMaterial);
            scene.add(hull);
            
            // Add decks as layers
            deckData.forEach((deck, i) => {
                const deckGeometry = new THREE.BoxGeometry(18, 0.5, 58);
                const deckMaterial = new THREE.MeshPhongMaterial({ 
                    color: parseInt(deck.color.replace('#', '0x')),
                    transparent: true,
                    opacity: 0.7
                });
                const deckMesh = new THREE.Mesh(deckGeometry, deckMaterial);
                deckMesh.position.y = i * 0.6 - 3;
                scene.add(deckMesh);
            });
            
            camera.position.set(30, 20, 30);
            
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            
            animate();
        }

        // Enhanced deck navigation
        function buildDeckNav() {
            elements.deckNav.innerHTML = '';
            deckData.forEach((deck) => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'deck-nav-item';
                button.dataset.deckNumber = deck.number;
                button.innerHTML = `
                    <span class="deck-number-badge" style="background: ${deck.color}22; color: ${deck.color}">
                        ${deck.number}
                    </span>
                    <span class="deck-info">
                        <span class="deck-name">${deck.name}</span>
                        <span class="deck-desc">${deck.subtitle}</span>
                    </span>
                    <i class="fas fa-chevron-right" style="color: ${deck.color}"></i>
                `;
                button.addEventListener('click', () => {
                    state.activeDeck = deck.number;
                    updateDeckNavActive();
                    scrollToDeck(deck.number);
                    updateHeader(deck.name, deck.subtitle);
                    showToast('Deck Selected', `Now viewing ${deck.name}`);
                });
                elements.deckNav.appendChild(button);
            });
        }

        // Enhanced filter chips
        function buildFilterChips() {
            elements.filterChips.innerHTML = '';
            filterConfig.forEach((filter) => {
                const chip = document.createElement('button');
                chip.type = 'button';
                chip.className = 'filter-chip';
                chip.dataset.filter = filter.key;
                chip.style.borderColor = `${filter.color}40`;
                chip.innerHTML = `
                    <i class="fas ${filter.icon}" style="color: ${filter.color}"></i>
                    <span>${filter.label}</span>
                `;
                chip.addEventListener('click', () => {
                    chip.classList.toggle('active');
                    if (state.activeFilters.has(filter.key)) {
                        state.activeFilters.delete(filter.key);
                        chip.style.background = 'rgba(255, 255, 255, 0.05)';
                    } else {
                        state.activeFilters.add(filter.key);
                        chip.style.background = `${filter.color}20`;
                    }
                    scheduleRender();
                });
                elements.filterChips.appendChild(chip);
            });
        }

        // Enhanced deck cards rendering
        function renderDecks() {
            const filteredDecks = deckData.filter(deckMatchesFilters);
            elements.decksGrid.innerHTML = '';
            const fragment = document.createDocumentFragment();

            filteredDecks.forEach((deck, index) => {
                const card = document.createElement('article');
                card.className = 'deck-card';
                card.dataset.deckNumber = deck.number;
                card.style.animationDelay = `${index * 60}ms`;

                card.innerHTML = `
                    <div class="quick-actions">
                        <button class="quick-btn" data-action="preview" title="Quick preview">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="quick-btn" data-action="tour" title="Virtual tour">
                            <i class="fas fa-vr-cardboard"></i>
                        </button>
                        <button class="quick-btn" data-action="favorite" title="Add to favorites">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="deck-card-content">
                        <div class="deck-image">
                            <img src="${deck.image}" alt="${deck.name} preview" loading="lazy">
                        </div>
                        <div>
                            <div class="deck-header">
                                <div class="deck-title">
                                    <div class="deck-number" style="background: ${deck.color}">
                                        ${deck.number}
                                    </div>
                                    <div class="deck-title-text">
                                        <h3>${deck.name}</h3>
                                        <p>${deck.subtitle}</p>
                                    </div>
                                </div>
                                <span class="deck-badge" style="border-color: ${deck.color}40; color: ${deck.color}">
                                    <i class="fas fa-${getDeckIcon(deck.type)}"></i>
                                    ${deck.type.charAt(0).toUpperCase() + deck.type.slice(1)}
                                </span>
                            </div>
                            <div class="deck-features">
                                ${deck.amenities.map(amenity => `
                                    <div class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>${amenity}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="deck-actions">
                                <button class="action-btn primary" data-action="view">
                                    <i class="fas fa-expand"></i>
                                    Explore Deck
                                </button>
                                <button class="action-btn secondary" data-action="directions">
                                    <i class="fas fa-directions"></i>
                                    Get Directions
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                // Add event listeners
                card.querySelector('[data-action="view"]').addEventListener('click', (e) => {
                    e.stopPropagation();
                    openModal(deck);
                });

                card.querySelector('[data-action="directions"]').addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDirections(deck);
                });

                card.querySelector('[data-action="preview"]').addEventListener('click', (e) => {
                    e.stopPropagation();
                    openPreview(deck);
                });

                card.querySelector('[data-action="tour"]').addEventListener('click', (e) => {
                    e.stopPropagation();
                    startTour(deck);
                });

                card.querySelector('[data-action="favorite"]').addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const heart = e.target.closest('button').querySelector('i');
                    heart.classList.toggle('far');
                    heart.classList.toggle('fas');
                    showToast('Added to Favorites', `${deck.name} saved to your favorites`);
                });

                card.addEventListener('click', () => openModal(deck));
                fragment.appendChild(card);
            });

            elements.decksGrid.appendChild(fragment);
            updateStats(filteredDecks);
        }

        // Helper functions
        function getDeckIcon(type) {
            const icons = {
                service: 'first-aid',
                main: 'star',
                entertainment: 'music',
                wellness: 'spa',
                recreation: 'swimming-pool',
                premium: 'crown'
            };
            return icons[type] || 'map';
        }

        function deckMatchesFilters(deck) {
            const query = state.searchQuery.trim().toLowerCase();
            const searchTarget = [
                deck.name,
                deck.subtitle,
                deck.description,
                ...deck.amenities,
                ...deck.highlights
            ].join(' ').toLowerCase();

            const matchesSearch = !query || searchTarget.includes(query);
            const matchesFilters = state.activeFilters.size === 0 ||
                Array.from(state.activeFilters).every((filter) => deck.amenities.includes(filter));

            return matchesSearch && matchesFilters;
        }

        function updateStats(filteredDecks) {
            elements.totalDecks.textContent = deckData.length;
            elements.visibleDecks.textContent = filteredDecks.length;
            
            // Calculate total amenities
            const allAmenities = new Set();
            deckData.forEach(deck => deck.amenities.forEach(a => allAmenities.add(a)));
            elements.amenitiesCount.textContent = allAmenities.size;

            elements.emptyState.style.display = filteredDecks.length === 0 ? 'block' : 'none';
        }

        // Enhanced modal
        function openModal(deck) {
            elements.modalTitle.innerHTML = `
                <i class="fas fa-ship" style="color: ${deck.color}"></i>
                ${deck.name} - ${deck.subtitle}
            `;
            elements.modalDownload.href = deck.pdf;
            elements.modalImage.src = deck.image;
            elements.modalImage.style.transform = `scale(${state.zoomLevel})`;
            
            elements.modalOverlay.classList.add('active');
            elements.modalContainer.classList.add('active');
            
            // Add modal content
            elements.modalContent.innerHTML = `
                <div class="modal-grid">
                    <img src="${deck.image}" alt="${deck.name}" class="modal-image" id="modalImage">
                    <div class="modal-sidebar">
                        <h4>Deck Features</h4>
                        ${deck.highlights.map(h => `
                            <div class="modal-feature">
                                <i class="fas fa-check" style="color: ${deck.color}"></i>
                                <span>${h}</span>
                            </div>
                        `).join('')}
                        <div class="modal-amenities">
                            ${deck.amenities.map(a => `<span class="modal-amenity">${a}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function closeModal() {
            elements.modalOverlay.classList.remove('active');
            elements.modalContainer.classList.remove('active');
        }

        // Toast notification
        function showToast(title, message, type = 'success') {
            elements.toastTitle.textContent = title;
            elements.toastMessage.textContent = message;
            elements.toast.style.borderColor = type === 'success' ? '#10b981' : '#ef4444';
            elements.toast.querySelector('.toast-icon').style.color = type === 'success' ? '#10b981' : '#ef4444';
            
            elements.toast.classList.add('show');
            setTimeout(() => elements.toast.classList.remove('show'), 3000);
        }

        // View mode changes
        function changeViewMode(mode) {
            state.viewMode = mode;
            elements.decksGrid.classList.remove('compact', 'detailed');
            if (mode === 'compact') elements.decksGrid.classList.add('compact');
            if (mode === 'detailed') elements.decksGrid.classList.add('detailed');
            
            document.querySelectorAll('.view-btn').forEach((btn) => {
                btn.classList.toggle('active', btn.dataset.view === mode);
            });
            
            showToast('View Changed', `Switched to ${mode} view`);
        }

        // 3D View toggle
        function toggle3DView() {
            state.is3DView = !state.is3DView;
            elements.deck3d.style.display = state.is3DView ? 'block' : 'none';
            elements.fabToggle.innerHTML = state.is3DView ? 
                '<i class="fas fa-th-large"></i>' : 
                '<i class="fas fa-cube"></i>';
            
            if (state.is3DView) {
                init3DView();
                showToast('3D View', 'Interactive ship model activated');
            }
        }

        // Virtual tour
        function startTour(deck) {
            state.tourActive = true;
            state.tourStep = 0;
            
            elements.tourOverlay.classList.add('active');
            elements.tourModal.classList.add('active');
            
            updateTourContent();
        }

        function updateTourContent() {
            const tourSteps = [
                { title: 'Welcome Aboard', content: 'Welcome to the Adventure of the Seas virtual tour.' },
                { title: 'Main Lobby', content: 'Explore the stunning main lobby on Deck 3.' },
                { title: 'Pool Deck', content: 'Relax at our beautiful pool areas.' }
            ];
            
            const step = tourSteps[state.tourStep];
            elements.tourContent.innerHTML = `
                <div class="tour-step">
                    <h3>${step.title}</h3>
                    <p>${step.content}</p>
                    <img src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=800&q=80" 
                         alt="Tour preview" style="width:100%; border-radius:12px; margin:1rem 0;">
                    <div class="tour-progress">
                        ${tourSteps.map((_, i) => `
                            <span class="tour-dot ${i === state.tourStep ? 'active' : ''}"></span>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function nextTourStop() {
            state.tourStep = Math.min(state.tourStep + 1, 2);
            updateTourContent();
        }

        function prevTourStop() {
            state.tourStep = Math.max(state.tourStep - 1, 0);
            updateTourContent();
        }

        function closeTour() {
            state.tourActive = false;
            elements.tourOverlay.classList.remove('active');
            elements.tourModal.classList.remove('active');
        }

        // Progress indicator
        function initProgressIndicator() {
            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                elements.progressIndicator.style.transform = `scaleX(${scrolled / 100})`;
            });
        }

        // Utility functions
        function showAllDecks() {
            state.activeFilters.clear();
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
                chip.style.background = 'rgba(255, 255, 255, 0.05)';
            });
            elements.searchInput.value = '';
            state.searchQuery = '';
            scheduleRender();
            showToast('All Decks', 'Showing all available decks');
        }

        function clearFilters() {
            state.activeFilters.clear();
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
                chip.style.background = 'rgba(255, 255, 255, 0.05)';
            });
            scheduleRender();
        }

        function routeTo(destination) {
            // Mock routing function
            showToast('Navigation', `Routing to ${destination} decks`);
        }

        // Search with debounce
        let renderHandle = null;
        function scheduleRender() {
            if (renderHandle) cancelAnimationFrame(renderHandle);
            renderHandle = requestAnimationFrame(() => {
                renderDecks();
                renderHandle = null;
            });
        }

        const debounce = (fn, delay = 300) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn(...args), delay);
            };
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initParticles();
            initProgressIndicator();
            buildDeckNav();
            buildFilterChips();
            renderDecks();
            changeViewMode(state.viewMode);
            
            // Search functionality
            elements.searchInput.addEventListener('input', debounce((e) => {
                state.searchQuery = e.target.value;
                scheduleRender();
            }));
            
            // Keyboard shortcuts
            window.addEventListener('keydown', (e) => {
                if (e.key === '/' && e.target !== elements.searchInput) {
                    e.preventDefault();
                    elements.searchInput.focus();
                }
                if (e.key === 'Escape') {
                    closeModal();
                    closeTour();
                }
            });
            
            // Modal close
            elements.modalOverlay.addEventListener('click', closeModal);
            elements.tourOverlay.addEventListener('click', closeTour);
        });

        // Global functions
        window.toggle3DView = toggle3DView;
        window.showAllDecks = showAllDecks;
        window.clearFilters = clearFilters;
        window.changeViewMode = changeViewMode;
        window.closeModal = closeModal;
        window.closeTour = closeTour;
        window.nextTourStop = nextTourStop;
        window.prevTourStop = prevTourStop;
        window.toggleVirtualTour = () => startTour(deckData[0]);
    </script>
    <script src="service-worker-registration.js" defer></script>
</body>
</html>