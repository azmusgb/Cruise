<!DOCTYPE html>
<html lang="en" data-theme="light" data-theme-mode="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0079d4" />
    <title>Photo Library | Adventure of the Seas</title>
    <meta
      name="description"
      content="Searchable photo library for staterooms, dining, deck spaces, and ports on Adventure of the Seas."
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="css/base.css?v=3" />
    <link rel="stylesheet" href="css/utilities.css?v=3" />
    <link rel="stylesheet" href="css/components.css?v=3" />
    <link rel="stylesheet" href="css/mobile-first.css?v=3" />
    <script src="js/shared-layout.js?v=17" defer></script>
    <style>
    @import url("css/pages/photos.css?v=1");
      /* Typography discipline */
      .photos-page .photo-hero h1 { font-weight: 600; }
      .photos-page .featured-title, .photos-page .gallery-info-bar h3, .photos-page .quick-links h3 { font-weight: 500; }
      .photos-page .photo-hero__subtitle, .photos-page .featured-sub { opacity: 0.95; font-weight: 400; }

      /* Softer surfaces and borders */
      .photos-page .hero-chip, .photos-page .filter-btn, .photos-page .view-btn, .photos-page .count-pill, .photos-page .sort-control select, .photos-page .quick-link-card { border: 1px solid rgba(0,0,0,0.08); background: rgba(0,0,0,0.04); box-shadow: none; }
      .photos-page .quick-link-card { border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.045); transition: transform 220ms cubic-bezier(0.2,0.6,0.2,1), box-shadow 220ms cubic-bezier(0.2,0.6,0.2,1); }
      .photos-page .quick-link-card:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,0,0,0.05); }

      /* Search input */
      .photos-page .gallery-search { border: 1px solid rgba(0,0,0,0.08); }
      .photos-page .gallery-search input::placeholder { opacity: 0.9; }

      /* Gallery controls spacing */
      .photos-page .gallery-controls__inner { gap: 12px; }

      /* Featured rail cards */
      .photos-page .featured-card { border: 1px solid rgba(0,0,0,0.08); border-radius: 16px; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.045); transition: transform 220ms cubic-bezier(0.2,0.6,0.2,1), box-shadow 220ms cubic-bezier(0.2,0.6,0.2,1); }
      .photos-page .featured-card:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,0,0,0.05); }
      .photos-page .featured-card__overlay { background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.18)); }

      /* Photo cards */
      .photos-page .photo-card, .photos-page .list-item { border: 1px solid rgba(0,0,0,0.08); border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.045); transition: transform 220ms cubic-bezier(0.2,0.6,0.2,1), box-shadow 220ms cubic-bezier(0.2,0.6,0.2,1); }
      .photos-page .photo-card:hover, .photos-page .list-item:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,0,0,0.05); }

      /* Image presentation */
      .photos-page .photo-card__image, .photos-page .list-item__image, .photos-page .featured-card__img { border-radius: 12px; border: 1px solid rgba(0,0,0,0.06); box-shadow: 0 4px 12px rgba(0,0,0,0.04); }

      /* Meta chips quieter */
      .photos-page .meta-tag, .photos-page .source-badge, .photos-page .mini-chip { background: rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.08); box-shadow: none; }

      /* Info bar: reduce dashboard feel */
      .photos-page .gallery-info-bar { border: 1px solid rgba(0,0,0,0.06); border-radius: 12px; padding: 8px 12px; background: rgba(0,0,0,0.03); }
      .photos-page .photo-count { opacity: 0.9; }

      /* Lightbox shell */
      .photos-page .lightbox__shell { border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.25); }
      .photos-page .lightbox__toolbar { border-top: 1px solid rgba(255,255,255,0.15); }

      /* Motion constraints */
      .photos-page .filter-btn, .photos-page .view-btn, .photos-page .quick-link-card, .photos-page .featured-card, .photos-page .photo-card, .photos-page .list-item { transition-duration: 220ms; }
    </style>
  </head>

  <body class="app-theme-rcc gallery-grid-view photos-page">
    <!-- Shared header injected by shared-layout.js -->
    <div id="sharedHeader" data-page="photos"></div>

    <main class="photo-library-page">
      <section class="photo-hero" aria-label="Photo library hero">
        <div class="photo-hero__inner">
          <span class="photo-hero__eyebrow">Adventure of the Seas · Feb 14-20, 2026</span>
          <h1>Photo Library</h1>
          <p class="photo-hero__subtitle">
            A calm visual index for <strong>Adventure of the Seas</strong> — rooms, dining, decks, ports, and hero angles.
          </p>

          <div class="hero-stats" aria-label="Library stats">
            <span class="hero-chip"><i class="fas fa-images" aria-hidden="true"></i> <span id="heroTotal">—</span> photos</span>
            <span class="hero-chip"><i class="fas fa-layer-group" aria-hidden="true"></i> <span id="heroCats">—</span> categories</span>
            <span class="hero-chip"><i class="fas fa-crown" aria-hidden="true"></i> <span id="heroOfficial">—</span> official</span>
          </div>
        </div>
      </section>

      <section class="featured-strip" aria-label="Featured photos">
        <div class="featured-strip__inner">
          <div class="featured-header">
            <h2 class="featured-title">Featured</h2>
            <p class="featured-sub">Quick hits that sell the vibe.</p>
          </div>
          <div class="featured-rail" id="featuredRail" role="list" aria-label="Featured photo rail"></div>
        </div>
      </section>

      <div class="gallery-controls" aria-label="Gallery controls">
        <div class="gallery-controls__inner">
          <label class="gallery-search" for="gallerySearch">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input
              id="gallerySearch"
              type="search"
              aria-label="Search images"
              placeholder="Search photos"
            />
          </label>

          <div class="gallery-filters" aria-label="Image source filters">
            <button type="button" class="filter-btn active" data-filter="all" aria-pressed="true">All photos</button>
            <button type="button" class="filter-btn" data-filter="official" aria-pressed="false">Official RCCL</button>
            <button type="button" class="filter-btn" data-filter="dining" aria-pressed="false">Dining</button>
            <button type="button" class="filter-btn" data-filter="decks" aria-pressed="false">Decks</button>
            <button type="button" class="filter-btn" data-filter="activities" aria-pressed="false">Activities</button>
            <button type="button" class="filter-btn" data-filter="ports" aria-pressed="false">Ports</button>
            <button type="button" class="filter-btn" data-filter="heroes" aria-pressed="false">Hero angles</button>
          </div>

          <div class="gallery-view-toggle" aria-label="View mode">
            <button type="button" class="view-btn active" data-view="grid" aria-label="Grid view" aria-pressed="true">
              <i class="fas fa-th-large" aria-hidden="true"></i>
            </button>
            <button type="button" class="view-btn" data-view="list" aria-label="List view" aria-pressed="false">
              <i class="fas fa-list" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>

      <section class="gallery-main" aria-label="Image gallery">
        <div class="gallery-info-bar">
          <p class="photo-count">
            Photos: <span id="photoCount">0</span>
            <span class="count-pill" id="activeFilterPill"><i class="fas fa-filter" aria-hidden="true"></i> All</span>
          </p>

          <div class="sort-control">
            <label for="sortSelect">Sort:</label>
            <select id="sortSelect" aria-label="Sort photos">
              <option value="name">Name (A-Z)</option>
              <option value="category">Category</option>
              <option value="deck">Deck</option>
            </select>
          </div>
        </div>

        <div class="gallery-grid" id="photoGrid" role="list" aria-label="Photo grid"></div>
        <div class="gallery-list" id="photoList" role="list" aria-label="Photo list"></div>

        <div class="gallery-empty" id="emptyState" hidden>
          <h3 class="empty-title">No matches</h3>
          <p class="empty-sub">
            Nothing fits that filter/search combo. Clear filters, simplify the search, or try category shortcuts.
          </p>
          <div class="empty-actions">
            <button type="button" class="ghost-btn" id="resetFilters">
              <i class="fas fa-rotate-left" aria-hidden="true"></i> Reset filters
            </button>
            <button type="button" class="ghost-btn" id="clearSearchBtn">
              <i class="fas fa-xmark" aria-hidden="true"></i> Clear search
            </button>
          </div>
        </div>
      </section>

      <section class="quick-links" aria-label="Quick links">
        <div class="quick-links__grid">
          <a class="quick-link-card" href="decks.html">
            <h3><i class="fas fa-map" aria-hidden="true"></i> Deck Plans</h3>
            <p>Jump to interactive deck maps.</p>
          </a>
          <a class="quick-link-card" href="dining.html">
            <h3><i class="fas fa-utensils" aria-hidden="true"></i> Dining</h3>
            <p>Find venues and nearby favorites.</p>
          </a>
          <a class="quick-link-card" href="rooms.html">
            <h3><i class="fas fa-bed" aria-hidden="true"></i> Staterooms</h3>
            <p>Room categories, locations, and notes.</p>
          </a>
        </div>
      </section>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" hidden tabindex="-1" aria-label="Image viewer" role="dialog" aria-modal="true">
      <div class="lightbox__shell">
        <button type="button" class="lightbox-nav lightbox-nav--prev" id="prevPhoto" aria-label="Previous photo">
          <i class="fas fa-chevron-left" aria-hidden="true"></i>
        </button>

        <button type="button" class="lightbox-nav lightbox-nav--next" id="nextPhoto" aria-label="Next photo">
          <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </button>

        <img class="lightbox__image" id="lightboxImage" src="" alt="" />

        <div class="lightbox__toolbar">
          <div class="lightbox__left">
            <p class="lightbox__title" id="lightboxTitle">—</p>
            <p class="lightbox__desc" id="lightboxDescription">—</p>
            <span class="lightbox__counter" id="lightboxCounter">
              <i class="fas fa-hashtag" aria-hidden="true"></i> <span id="lightboxCounterText">—</span>
            </span>
          </div>

          <div class="lightbox__actions">
            <a class="lightbox__link" id="openOriginal" href="#" target="_blank" rel="noopener">
              <i class="fas fa-up-right-from-square" aria-hidden="true"></i> Open
            </a>
            <a class="lightbox__link" id="downloadImage" href="#" download>
              <i class="fas fa-download" aria-hidden="true"></i> Download
            </a>
            <button type="button" id="closeLightbox" aria-label="Close image viewer">
              <i class="fas fa-xmark" aria-hidden="true"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Shared bottom nav injected by shared-layout.js -->
    <div id="sharedBottomNav" data-page="photos"></div>

    <script>
      const photoData = [
        { id: 1, title: "Adventure Exterior at Sea", src: "images/ship/rccl-adventure-of-the-seas-exterior-at-sea.webp", category: "decks", deck: "topside", source: "official", description: "Wide exterior view of Adventure of the Seas underway.", tags: ["ship", "exterior", "hero"] },
        { id: 2, title: "Pool Deck", src: "images/ship/rccl-adventure-of-the-seas-pool-deck.webp", category: "decks", deck: "11", source: "official", description: "Main pool deck setup with lounge seating.", tags: ["pool", "deck-11"] },
        { id: 3, title: "Family Deck Activities", src: "images/ship/rccl-adventure-of-the-seas-family-deck-activities.jpeg", category: "activities", deck: "12", source: "official", description: "Family-friendly activity area on upper deck.", tags: ["family", "deck-12"] },
        { id: 4, title: "Main Dining Room", src: "images/venues/rccl-adventure-of-the-seas-main-dining-room.webp", category: "dining", deck: "3", source: "official", description: "Formal dining room interior with multi-level seating.", tags: ["dining", "formal"] },
        { id: 5, title: "Windjammer Buffet", src: "images/venues/rccl-adventure-of-the-seas-windjammer-buffet.jpeg", category: "dining", deck: "11", source: "official", description: "Windjammer buffet seating and serving stations.", tags: ["buffet", "casual"] },
        { id: 6, title: "Windjammer Buffet (Alternate)", src: "images/venues/rccl-adventure-of-the-seas-windjammer-buffet-2.jpeg", category: "dining", deck: "11", source: "official", description: "Alternate view of Windjammer buffet seating.", tags: ["buffet", "alternate"] },
        { id: 7, title: "Johnny Rockets", src: "images/venues/rccl-adventure-of-the-seas-johnny-rockets.jpeg", category: "dining", deck: "12", source: "official", description: "Classic diner styling and casual bites.", tags: ["deck-12", "casual"] },
        { id: 8, title: "Specialty Dining Entree", src: "images/venues/rccl-adventure-of-the-seas-specialty-dining-entree.jpeg", category: "dining", deck: "", source: "official", description: "Specialty dining plated entree presentation.", tags: ["specialty", "entree"] },
        { id: 9, title: "Royal Promenade Arch", src: "images/venues/rccl-adventure-of-the-seas-royal-promenade-arch.jpeg", category: "decks", deck: "5", source: "official", description: "Promenade focal-point arch and social space.", tags: ["promenade"] },
        { id: 10, title: "Royal Promenade Classic Car", src: "images/venues/rccl-adventure-of-the-seas-royal-promenade-classic-car.webp", category: "decks", deck: "5", source: "official", description: "Classic car centerpiece on the Royal Promenade.", tags: ["promenade", "landmark"] },
        { id: 11, title: "Ice Skating Rink", src: "images/venues/rccl-adventure-of-the-seas-ice-skating-rink.jpeg", category: "activities", deck: "3", source: "official", description: "Studio B ice rink used for shows and open skate.", tags: ["shows", "ice"] },
        { id: 12, title: "Main Theater Stage", src: "images/venues/rccl-adventure-of-the-seas-main-theater-stage.webp", category: "activities", deck: "3", source: "official", description: "Main theater stage setup for production shows.", tags: ["theater", "shows"] },
        { id: 13, title: "Main Theater Stage (Alternate)", src: "images/venues/rccl-adventure-of-the-seas-main-theater-stage-2.webp", category: "activities", deck: "3", source: "official", description: "Alternate angle of the main theater stage.", tags: ["theater", "alternate"] },
        { id: 14, title: "Main Theater Seating", src: "images/venues/rccl-adventure-of-the-seas-main-theater-seating.webp", category: "activities", deck: "3", source: "official", description: "Seating layout in the ship's main theater.", tags: ["theater", "seating"] },
        { id: 15, title: "Spa Treatment", src: "images/venues/rccl-adventure-of-the-seas-spa-treatment.webp", category: "activities", deck: "12", source: "official", description: "Spa treatment room setup and amenities.", tags: ["spa", "wellness"] },
        { id: 16, title: "Spa Treatment (Alternate)", src: "images/venues/rccl-adventure-of-the-seas-spa-treatment-2.webp", category: "activities", deck: "12", source: "official", description: "Alternate spa treatment area view.", tags: ["spa", "alternate"] },
        { id: 17, title: "Ben & Jerry's", src: "images/venues/rccl-adventure-of-the-seas-ben-and-jerrys.webp", category: "dining", deck: "5", source: "official", description: "Ice cream counter on the Royal Promenade.", tags: ["ice-cream", "promenade"] },
        { id: 18, title: "Perfect Day at CocoCay Aerial Balloon", src: "images/ports/rccl-perfect-day-cococay-aerial-balloon.jpeg", category: "ports", deck: "", source: "official", description: "Aerial balloon view of Perfect Day at CocoCay.", tags: ["cococay", "aerial", "hero"] },
        { id: 19, title: "Perfect Day Thrill Tower", src: "images/ports/rccl-perfect-day-cococay-thrill-tower.jpeg", category: "ports", deck: "", source: "official", description: "Thrill tower close-up with slide complex.", tags: ["thrill", "slides"] },
        { id: 20, title: "Perfect Day Thrill Waterpark Aerial", src: "images/ports/rccl-perfect-day-cococay-thrill-waterpark-aerial.webp", category: "ports", deck: "", source: "official", description: "Aerial perspective of Thrill Waterpark at CocoCay.", tags: ["waterpark", "aerial"] },
      ];

      document.addEventListener("DOMContentLoaded", () => {
        const galleryGrid = document.getElementById("photoGrid");
        const galleryList = document.getElementById("photoList");
        const searchInput = document.getElementById("gallerySearch");
        const filterButtons = Array.from(document.querySelectorAll(".filter-btn[data-filter]"));
        const viewButtons = Array.from(document.querySelectorAll(".view-btn"));
        const sortSelect = document.getElementById("sortSelect");
        const photoCount = document.getElementById("photoCount");
        const emptyState = document.getElementById("emptyState");
        const resetButton = document.getElementById("resetFilters");
        const clearSearchBtn = document.getElementById("clearSearchBtn");
        const activeFilterPill = document.getElementById("activeFilterPill");
        const featuredRail = document.getElementById("featuredRail");
        const featuredStrip = featuredRail.closest(".featured-strip");
        const heroTotal = document.getElementById("heroTotal");
        const heroCats = document.getElementById("heroCats");
        const heroOfficial = document.getElementById("heroOfficial");
        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightboxImage");
        const lightboxTitle = document.getElementById("lightboxTitle");
        const lightboxDescription = document.getElementById("lightboxDescription");
        const lightboxCounter = document.getElementById("lightboxCounter");
        const lightboxCounterText = document.getElementById("lightboxCounterText");
        const openOriginal = document.getElementById("openOriginal");
        const downloadImage = document.getElementById("downloadImage");
        const prevButton = document.getElementById("prevPhoto");
        const nextButton = document.getElementById("nextPhoto");
        const closeButton = document.getElementById("closeLightbox");

        const requiredElements = [
          galleryGrid, galleryList, searchInput, sortSelect, photoCount, emptyState,
          resetButton, clearSearchBtn, activeFilterPill, featuredRail, featuredStrip,
          heroTotal, heroCats, heroOfficial,
          lightbox, lightboxImage, lightboxTitle, lightboxDescription, lightboxCounter, lightboxCounterText,
          openOriginal, downloadImage, prevButton, nextButton, closeButton,
        ];

        if (requiredElements.some((element) => !element)) {
          console.error("Photo library initialization aborted: missing required DOM element.");
          return;
        }

        let currentFilter = "all";
        let currentView = "grid";
        let currentSearch = "";
        let currentSort = "name";
        let currentIndex = 0;
        let filteredPhotos = [];

        function canonicalDeck(deck) {
          const value = String(deck || "").trim();
          if (!value) return "";
          if (/^\d+$/.test(value)) return value;
          return "topside";
        }

        function deckLabel(deck) {
          const value = canonicalDeck(deck);
          if (!value) return "";
          if (/^\d+$/.test(value)) return `Deck ${value}`;
          return "Topside";
        }

        function deckSortKey(deck) {
          const value = canonicalDeck(deck);
          if (!value || value === "topside") return 999;
          return Number(value);
        }

        function normalizeCategory(category) {
          const value = String(category || "").toLowerCase();
          return value || "decks";
        }

        function normalizeSource(source) {
          return String(source || "official").toLowerCase() === "official" ? "official" : "official";
        }

        const normalizedPhotos = photoData
          .map((photo, idx) => ({
            id: Number(photo.id) || idx + 1,
            title: String(photo.title || "Untitled photo"),
            src: String(photo.src || ""),
            category: normalizeCategory(photo.category),
            deck: canonicalDeck(photo.deck),
            source: normalizeSource(photo.source),
            description: String(photo.description || ""),
            tags: Array.isArray(photo.tags) ? photo.tags : [],
          }))
          .filter((photo) => photo.src.startsWith("images/"));

        function updateHeroStats() {
          const categories = new Set(normalizedPhotos.map((photo) => photo.category));
          heroTotal.textContent = String(normalizedPhotos.length);
          heroCats.textContent = String(categories.size);
          heroOfficial.textContent = String(normalizedPhotos.filter((photo) => photo.source === "official").length);
        }

        function prettyFilterLabel(filter) {
          if (filter === "all") return "All";
          if (filter === "official") return "Official";
          if (filter === "heroes") return "Hero Angles";
          return filter.charAt(0).toUpperCase() + filter.slice(1);
        }

        function matchesFilter(photo) {
          if (currentFilter === "all") return true;
          if (currentFilter === "official") return photo.source === "official";
          if (currentFilter === "heroes") return photo.tags.includes("hero");
          return photo.category === currentFilter;
        }

        function matchesSearch(photo, term) {
          if (!term) return true;
          const haystack = [
            photo.title,
            photo.description,
            photo.category,
            deckLabel(photo.deck),
            ...photo.tags,
          ].join(" ").toLowerCase();
          return haystack.includes(term);
        }

        function sortPhotos(photos) {
          photos.sort((a, b) => {
            if (currentSort === "category") {
              return a.category.localeCompare(b.category) || a.title.localeCompare(b.title);
            }
            if (currentSort === "deck") {
              return deckSortKey(a.deck) - deckSortKey(b.deck) || a.title.localeCompare(b.title);
            }
            return a.title.localeCompare(b.title);
          });
          return photos;
        }

        function applyFilters() {
          const term = currentSearch.trim().toLowerCase();
          filteredPhotos = sortPhotos(
            normalizedPhotos
              .filter((photo) => matchesFilter(photo))
              .filter((photo) => matchesSearch(photo, term))
          );
        }

        function renderMeta(photo) {
          const deck = deckLabel(photo.deck)
            ? `<span class="meta-tag"><i class="fas fa-layer-group"></i> ${deckLabel(photo.deck)}</span>`
            : "";
          return `
            <span class="meta-tag"><i class="fas fa-folder"></i> ${photo.category}</span>
            ${deck}
            <span class="meta-tag"><i class="fas fa-crown"></i> ${photo.source}</span>
          `;
        }

        function injectShimmer(img) {
          img.classList.add("img-shimmer");
          const done = () => img.classList.remove("img-shimmer");
          if (img.complete) done();
          img.addEventListener("load", done, { once: true });
          img.addEventListener("error", done, { once: true });
        }

        function buildFeatured() {
          if (!filteredPhotos.length) {
            featuredRail.innerHTML = "";
            featuredStrip.hidden = true;
            return;
          }
          featuredStrip.hidden = false;

          const heroish = filteredPhotos.filter(
            (photo) => photo.tags.includes("hero") || photo.category === "ports" || photo.category === "decks"
          );
          const pool = heroish.length ? heroish : filteredPhotos;
          const picks = pool.slice(0, 6);

          featuredRail.innerHTML = picks.map((photo) => {
            const chips = [
              `<span class="mini-chip"><i class="fas fa-folder"></i> ${photo.category}</span>`,
              deckLabel(photo.deck)
                ? `<span class="mini-chip"><i class="fas fa-layer-group"></i> ${deckLabel(photo.deck)}</span>`
                : "",
            ].filter(Boolean).join("");
            return `
              <article class="featured-card" role="listitem" tabindex="0" data-photo-id="${photo.id}">
                <img class="featured-card__img" src="${photo.src}" alt="${photo.title}" loading="lazy" decoding="async" />
                <div class="featured-card__overlay" aria-hidden="true"></div>
                <div class="featured-card__meta">
                  <p class="featured-card__name">${photo.title}</p>
                  <div class="featured-card__chips">${chips}</div>
                </div>
              </article>
            `;
          }).join("");
          featuredRail.querySelectorAll("img").forEach(injectShimmer);
        }

        function renderCards() {
          if (!filteredPhotos.length) {
            galleryGrid.innerHTML = "";
            galleryList.innerHTML = "";
            emptyState.hidden = false;
            return;
          }

          emptyState.hidden = true;

          galleryGrid.innerHTML = filteredPhotos.map((photo, idx) => `
            <article class="photo-card" role="listitem" tabindex="0" data-index="${idx}" data-id="${photo.id}" data-category="${photo.category}">
              <span class="source-badge"><i class="fas fa-crown"></i> ${photo.source}</span>
              <img class="photo-card__image" src="${photo.src}" alt="${photo.title}" loading="lazy" decoding="async" />
              <div class="photo-card__content">
                <h3 class="photo-card__title">${photo.title}</h3>
                <div class="photo-card__meta">${renderMeta(photo)}</div>
                <p class="photo-card__description">${photo.description}</p>
              </div>
            </article>
          `).join("");

          galleryList.innerHTML = filteredPhotos.map((photo, idx) => `
            <article class="list-item" role="listitem" tabindex="0" data-index="${idx}" data-id="${photo.id}" data-category="${photo.category}">
              <span class="source-badge"><i class="fas fa-crown"></i> ${photo.source}</span>
              <img class="list-item__image" src="${photo.src}" alt="${photo.title}" loading="lazy" decoding="async" />
              <div class="list-item__content">
                <h3 class="photo-card__title">${photo.title}</h3>
                <div class="photo-card__meta">${renderMeta(photo)}</div>
                <p class="photo-card__description">${photo.description}</p>
              </div>
            </article>
          `).join("");

          document.querySelectorAll("#photoGrid img, #photoList img").forEach(injectShimmer);
        }

        function render() {
          applyFilters();
          buildFeatured();
          renderCards();
          photoCount.textContent = String(filteredPhotos.length);
          activeFilterPill.innerHTML = `<i class="fas fa-filter" aria-hidden="true"></i> ${prettyFilterLabel(currentFilter)}`;
        }

        function syncToggleStates() {
          filterButtons.forEach((button) => {
            const isActive = button.dataset.filter === currentFilter;
            button.classList.toggle("active", isActive);
            button.setAttribute("aria-pressed", isActive ? "true" : "false");
          });
          viewButtons.forEach((button) => {
            const isActive = button.dataset.view === currentView;
            button.classList.toggle("active", isActive);
            button.setAttribute("aria-pressed", isActive ? "true" : "false");
          });
        }

        function openLightbox(index) {
          if (!filteredPhotos.length) return;
          currentIndex = index;
          const photo = filteredPhotos[currentIndex];
          if (!photo) return;

          lightboxImage.src = photo.src;
          lightboxImage.alt = photo.title;
          lightboxTitle.textContent = photo.title;
          lightboxDescription.textContent = photo.description;
          lightboxCounterText.textContent = `${currentIndex + 1} of ${filteredPhotos.length}`;
          openOriginal.href = photo.src;
          downloadImage.href = photo.src;
          lightbox.hidden = false;
          lightbox.classList.add("active");
          document.body.style.overflow = "hidden";
          lightbox.focus();
        }

        function closeLightbox() {
          lightbox.hidden = true;
          lightbox.classList.remove("active");
          document.body.style.overflow = "";
        }

        function moveLightbox(step) {
          if (!filteredPhotos.length) return;
          currentIndex = (currentIndex + step + filteredPhotos.length) % filteredPhotos.length;
          openLightbox(currentIndex);
        }

        function activateCard(event) {
          const card = event.target.closest("[data-index]");
          if (!card) return;
          openLightbox(Number(card.dataset.index));
        }

        featuredRail.addEventListener("click", (event) => {
          const card = event.target.closest("[data-photo-id]");
          if (!card) return;
          const id = Number(card.dataset.photoId);
          const index = filteredPhotos.findIndex((photo) => photo.id === id);
          if (index < 0) return;
          openLightbox(index);
        });

        featuredRail.addEventListener("keydown", (event) => {
          if (event.key !== "Enter" && event.key !== " ") return;
          const card = event.target.closest("[data-photo-id]");
          if (!card) return;
          event.preventDefault();
          const id = Number(card.dataset.photoId);
          const index = filteredPhotos.findIndex((photo) => photo.id === id);
          if (index < 0) return;
          openLightbox(index);
        });

        [galleryGrid, galleryList].forEach((container) => {
          container.addEventListener("click", activateCard);
          container.addEventListener("keydown", (event) => {
            if (event.key !== "Enter" && event.key !== " ") return;
            event.preventDefault();
            activateCard(event);
          });
        });

        let touchStartX = 0;
        let touchStartY = 0;
        lightbox.addEventListener("touchstart", (event) => {
          const touch = event.touches[0];
          if (!touch) return;
          touchStartX = touch.clientX;
          touchStartY = touch.clientY;
        }, { passive: true });

        lightbox.addEventListener("touchend", (event) => {
          if (lightbox.hidden) return;
          const touch = event.changedTouches[0];
          if (!touch) return;
          const dx = touch.clientX - touchStartX;
          const dy = touch.clientY - touchStartY;
          if (Math.abs(dx) < 90 || Math.abs(dx) < Math.abs(dy) * 1.8) return;
          moveLightbox(dx > 0 ? -1 : 1);
        });

        searchInput.addEventListener("input", (event) => {
          currentSearch = event.target.value;
          render();
        });

        filterButtons.forEach((button) => {
          button.addEventListener("click", () => {
            currentFilter = String(button.dataset.filter || "all");
            filterButtons.forEach((entry) => {
              const sameFilter = entry.dataset.filter === currentFilter;
              entry.classList.toggle("active", sameFilter);
              entry.setAttribute("aria-pressed", sameFilter ? "true" : "false");
            });
            render();
          });
        });

        viewButtons.forEach((button) => {
          button.addEventListener("click", () => {
            currentView = button.dataset.view;
            document.body.classList.toggle("gallery-grid-view", currentView === "grid");
            document.body.classList.toggle("gallery-list-view", currentView === "list");
            viewButtons.forEach((entry) => {
              const isActive = entry === button;
              entry.classList.toggle("active", isActive);
              entry.setAttribute("aria-pressed", isActive ? "true" : "false");
            });
          });
        });

        sortSelect.addEventListener("change", (event) => {
          currentSort = String(event.target.value || "name");
          render();
        });

        resetButton.addEventListener("click", () => {
          currentFilter = "all";
          currentSearch = "";
          currentSort = "name";
          searchInput.value = "";
          sortSelect.value = "name";
          filterButtons.forEach((button) => {
            const isActive = button.dataset.filter === "all";
            button.classList.toggle("active", isActive);
            button.setAttribute("aria-pressed", isActive ? "true" : "false");
          });
          render();
        });

        clearSearchBtn.addEventListener("click", () => {
          currentSearch = "";
          searchInput.value = "";
          render();
        });

        closeButton.addEventListener("click", closeLightbox);
        prevButton.addEventListener("click", () => moveLightbox(-1));
        nextButton.addEventListener("click", () => moveLightbox(1));

        lightbox.addEventListener("click", (event) => {
          if (event.target === lightbox) closeLightbox();
        });

        document.addEventListener("keydown", (event) => {
          if (lightbox.hidden) return;
          if (event.key === "Escape") closeLightbox();
          if (event.key === "ArrowLeft") moveLightbox(-1);
          if (event.key === "ArrowRight") moveLightbox(1);
        });

        updateHeroStats();
        sortSelect.value = "name";
        syncToggleStates();
        render();
      });
    </script>
  </body>
</html>
