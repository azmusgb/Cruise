<!DOCTYPE html>
<html lang="en" data-theme="light" data-theme-mode="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0079d4" />
    <title>Photo Library | Adventure of the Seas</title>
    <meta
      name="description"
      content="Searchable photo library for staterooms, dining, deck spaces, and ports on Adventure of the Seas."
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="css/base.css?v=3" />
    <link rel="stylesheet" href="css/utilities.css?v=3" />
    <link rel="stylesheet" href="css/components.css?v=3" />
    <link rel="stylesheet" href="css/mobile-first.css?v=3" />
    <script src="js/shared-layout.js?v=13" defer></script>

    <style>
      /* ==========================================================================
         PHOTO LIBRARY — PREMIUM PASS (drop-in)
         Keeps your existing IDs + behaviors, upgrades the experience.
         ========================================================================== */

      body.app-theme-rcc {
        background: linear-gradient(180deg, #f4fbff 0%, #eaf6ff 100%) !important;
        color: var(--royal-ink) !important;
        font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .photo-library-page {
        --gallery-gap: 14px;
        --glass: rgba(255, 255, 255, 0.18);
        --glass-strong: rgba(255, 255, 255, 0.28);
        --dark-glass: rgba(6, 18, 32, 0.68);
        --focus: 0 0 0 4px rgba(25, 194, 255, 0.22);
      }

      /* Containers */
      .photo-hero__inner,
      .gallery-controls__inner,
      .gallery-main,
      .quick-links,
      .featured-strip__inner {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1.2rem 1.2rem;
      }

      /* =======================
         HERO — cinematic
         ======================= */
      .photo-hero {
        position: relative;
        color: #fff;
        margin-bottom: 1.05rem;
        background: linear-gradient(130deg, var(--royal-navy) 0%, var(--royal-blue) 52%, #129bd8 100%);
        overflow: hidden;
        border-bottom: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: inset 0 -1px 0 rgba(255, 255, 255, 0.18), 0 18px 40px rgba(11, 79, 144, 0.18);
      }

      .photo-hero::before {
        content: "";
        position: absolute;
        inset: -20%;
        background:
          radial-gradient(circle at 18% 22%, rgba(255, 255, 255, 0.34), transparent 36%),
          radial-gradient(circle at 86% 78%, rgba(255, 255, 255, 0.18), transparent 44%),
          linear-gradient(180deg, rgba(0, 0, 0, 0.12) 0%, rgba(0, 0, 0, 0.04) 55%, rgba(0, 0, 0, 0.18) 100%);
        animation: heroFloat 18s linear infinite;
        pointer-events: none;
      }

      .photo-hero::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 8px;
        background: linear-gradient(90deg, rgba(255, 201, 58, 0.18) 0%, rgba(255, 201, 58, 0.72) 50%, rgba(255, 201, 58, 0.18) 100%);
        pointer-events: none;
      }

      @keyframes heroFloat {
        0% { transform: translateX(-2%) translateY(0); }
        50% { transform: translateX(2%) translateY(-2%); }
        100% { transform: translateX(-2%) translateY(0); }
      }

      .photo-hero__inner {
        position: relative;
        z-index: 2;
      }

      .photo-hero h1 {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        font-weight: 800;
        letter-spacing: -0.02em;
        font-size: clamp(1.9rem, 5vw, 2.8rem);
      }

      .photo-hero__eyebrow {
        display: inline-block;
        margin: 0 0 0.55rem;
        padding: 0.4rem 0.7rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.28);
        background: rgba(255, 255, 255, 0.14);
        font-size: 0.76rem;
        font-weight: 800;
        letter-spacing: 0.03em;
        text-transform: uppercase;
      }

      .photo-hero__subtitle {
        margin: 0.55rem 0 0.9rem;
        opacity: 0.92;
        max-width: 72ch;
        line-height: 1.45;
      }

      .photo-hero__highlights {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 0 0 16px;
      }

      .photo-hero__tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 12px;
        border-radius: 999px;
        color: #fff;
        font-size: 0.82rem;
        font-weight: 700;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.14);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
      }

      .photo-hero__tag i {
        font-size: 0.78rem;
      }

      .hero-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        margin: 0.7rem 0 0.95rem;
      }

      .hero-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        padding: 0.45rem 0.7rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.26);
        background: rgba(255, 255, 255, 0.14);
        backdrop-filter: blur(10px);
        font-weight: 800;
        font-size: 0.82rem;
      }

      .hero-chip i { opacity: 0.95; }

      .hero-category-shortcuts {
        display: flex;
        flex-wrap: wrap;
        gap: 0.55rem;
      }

      /* =======================
         Controls bar
         ======================= */
      .gallery-controls {
        position: sticky;
        top: 0;
        z-index: 60;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.92);
        border-bottom: 1px solid var(--royal-border);
        box-shadow: 0 10px 26px rgba(11, 79, 144, 0.08);
      }

      .gallery-controls__inner {
        display: grid;
        grid-template-columns: minmax(220px, 1fr) auto auto;
        align-items: center;
        gap: 0.8rem;
        padding-top: 0.85rem;
        padding-bottom: 0.85rem;
      }

      .gallery-search {
        position: relative;
      }

      .gallery-search i {
        position: absolute;
        top: 50%;
        left: 0.85rem;
        transform: translateY(-50%);
        color: var(--royal-ink);
        opacity: 0.7;
      }

      .gallery-search input {
        width: 100%;
        border: 2px solid var(--royal-border);
        border-radius: 12px;
        padding: 0.72rem 0.9rem 0.72rem 2.35rem;
        font: inherit;
        background: #fff;
        transition: var(--royal-transition);
      }

      .gallery-search input:focus-visible {
        outline: none;
        box-shadow: var(--focus);
        border-color: rgba(25, 194, 255, 0.55);
      }

      .gallery-filters,
      .gallery-view-toggle {
        display: flex;
        align-items: center;
        gap: 0.45rem;
        flex-wrap: wrap;
      }

      .filter-btn,
      .view-btn,
      .ghost-btn {
        border: 2px solid var(--royal-border);
        background: #fff;
        color: var(--royal-navy);
        padding: 0.55rem 0.85rem;
        border-radius: 999px;
        font-weight: 800;
        cursor: pointer;
        transition: var(--royal-transition);
        text-decoration: none;
      }

      .view-btn {
        border-radius: 12px;
        min-width: 44px;
        text-align: center;
      }

      .filter-btn:is(:hover, :focus-visible),
      .view-btn:is(:hover, :focus-visible),
      .ghost-btn:is(:hover, :focus-visible) {
        border-color: var(--royal-blue);
        outline: none;
        box-shadow: 0 0 0 4px rgba(0, 121, 212, 0.12);
      }

      .filter-btn.active,
      .view-btn.active {
        color: #fff;
        border-color: var(--royal-blue);
        background: var(--royal-blue);
      }

      /* =======================
         Featured strip
         ======================= */
      .featured-strip {
        padding-top: 0;
        padding-bottom: 0.2rem;
      }

      .featured-header {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 0.8rem;
        flex-wrap: wrap;
        margin: 0.2rem 0 0.75rem;
      }

      .featured-title {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        font-size: 1.15rem;
        letter-spacing: -0.01em;
        color: var(--royal-navy);
      }

      .featured-sub {
        margin: 0;
        color: var(--royal-ink);
        opacity: 0.85;
        font-weight: 700;
        font-size: 0.9rem;
      }

      .featured-rail {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: minmax(240px, 1fr);
        gap: 0.8rem;
        overflow-x: auto;
        padding-bottom: 0.4rem;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
      }

      .featured-card {
        position: relative;
        scroll-snap-align: start;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid var(--royal-border);
        background: #fff;
        box-shadow: var(--royal-shadow-lg);
        cursor: pointer;
        transition: var(--royal-transition);
        min-height: 170px;
      }

      .featured-card:is(:hover, :focus-within) {
        transform: translateY(-2px);
        box-shadow: var(--royal-shadow-xl);
      }

      .featured-card__img {
        width: 100%;
        height: 170px;
        object-fit: cover;
        display: block;
        background: var(--royal-light);
        transform: scale(1.02);
        transition: transform 0.6s ease;
      }

      .featured-card:hover .featured-card__img { transform: scale(1.08); }

      .featured-card__overlay {
        position: absolute;
        inset: 0;
        background:
          linear-gradient(180deg, rgba(0,0,0,0.00) 25%, rgba(0,0,0,0.56) 100%);
        pointer-events: none;
      }

      .featured-card__meta {
        position: absolute;
        left: 12px;
        right: 12px;
        bottom: 12px;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        color: #fff;
      }

      .featured-card__name {
        margin: 0;
        font-weight: 900;
        letter-spacing: -0.01em;
        font-size: 1rem;
        text-shadow: 0 10px 22px rgba(0,0,0,0.35);
      }

      .featured-card__chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
      }

      .mini-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.25rem 0.5rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.22);
        background: rgba(255, 255, 255, 0.16);
        backdrop-filter: blur(10px);
        font-size: 0.74rem;
        font-weight: 800;
      }

      /* =======================
         Gallery / cards
         ======================= */
      .gallery-main {
        padding-top: 1.0rem;
        padding-bottom: 2.2rem;
      }

      .gallery-info-bar {
        background: var(--royal-light);
        border: 1px solid var(--royal-border);
        border-radius: 14px;
        padding: 0.75rem 0.95rem;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        gap: 0.8rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .photo-count {
        font-weight: 900;
        color: var(--royal-navy);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .count-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.25rem 0.55rem;
        border-radius: 999px;
        border: 1px solid rgba(0, 121, 212, 0.18);
        background: rgba(255, 255, 255, 0.8);
        font-size: 0.78rem;
        font-weight: 900;
        color: #0b4f90;
      }

      .sort-control {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
      }

      .sort-control label {
        font-weight: 800;
        color: var(--royal-ink);
        opacity: 0.9;
      }

      .sort-control select {
        padding: 0.48rem 0.7rem;
        border: 2px solid var(--royal-border);
        border-radius: 10px;
        background: #fff;
        font: inherit;
        font-weight: 700;
      }

      .manage-actions {
        display: inline-flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.4rem;
      }

      .manage-btn {
        border: 1px solid var(--royal-border);
        border-radius: 10px;
        background: #fff;
        color: var(--royal-navy);
        font-weight: 800;
        padding: 0.42rem 0.7rem;
        cursor: pointer;
      }

      .manage-btn.active {
        background: var(--royal-blue);
        border-color: var(--royal-blue);
        color: #fff;
      }

      .manage-btn:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .manage-panel {
        display: grid;
        gap: 0.75rem;
        background: #fff;
        border: 1px solid var(--royal-border);
        border-radius: 14px;
        padding: 0.9rem;
        margin-bottom: 1rem;
        box-shadow: var(--royal-shadow-lg);
      }

      .manage-panel[hidden] {
        display: none;
      }

      .manage-panel__grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.6rem;
      }

      .manage-panel label {
        display: grid;
        gap: 0.3rem;
        font-weight: 700;
        color: var(--royal-navy);
      }

      .manage-panel input,
      .manage-panel textarea,
      .manage-panel select {
        border: 1px solid var(--royal-border);
        border-radius: 10px;
        padding: 0.5rem 0.6rem;
        font: inherit;
        background: #fff;
      }

      .manage-panel textarea {
        min-height: 70px;
        resize: vertical;
      }

      .manage-panel__actions {
        display: flex;
        gap: 0.55rem;
        flex-wrap: wrap;
      }

      .collection-admin {
        display: grid;
        gap: 0.8rem;
        margin-bottom: 1rem;
      }

      .collection-admin[hidden] { display: none; }

      .collection-admin__stats {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 0.7rem;
      }

      .admin-stat {
        border: 1px solid var(--royal-border);
        border-radius: 12px;
        background: linear-gradient(180deg, #ffffff 0%, #f6fbff 100%);
        padding: 0.7rem 0.8rem;
        box-shadow: var(--shadow-light);
      }

      .admin-stat__label {
        display: block;
        font-size: 0.75rem;
        font-weight: 800;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: #2f618f;
      }

      .admin-stat__value {
        display: block;
        margin-top: 0.2rem;
        font-size: 1.15rem;
        font-weight: 900;
        color: var(--royal-navy);
      }

      .collection-admin__tools {
        display: grid;
        grid-template-columns: 1.2fr 1fr 1fr;
        gap: 0.7rem;
      }

      .admin-card {
        border: 1px solid var(--royal-border);
        border-radius: 12px;
        background: #fff;
        padding: 0.72rem;
      }

      .admin-card__title {
        margin: 0 0 0.5rem;
        font-size: 0.84rem;
        font-weight: 900;
        color: var(--royal-navy);
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }

      .admin-tool-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.45rem;
      }

      .admin-btn {
        border: 1px solid var(--royal-border);
        background: #fff;
        color: var(--royal-navy);
        border-radius: 9px;
        padding: 0.42rem 0.62rem;
        font-weight: 800;
        font-size: 0.82rem;
        cursor: pointer;
      }

      .admin-btn:hover,
      .admin-btn:focus-visible {
        outline: none;
        border-color: var(--royal-blue);
        box-shadow: 0 0 0 3px rgba(0, 121, 212, 0.12);
      }

      .admin-field {
        display: grid;
        gap: 0.3rem;
        margin-bottom: 0.45rem;
      }

      .admin-field label {
        font-size: 0.74rem;
        font-weight: 800;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: #2f618f;
      }

      .admin-field input,
      .admin-field select {
        border: 1px solid var(--royal-border);
        border-radius: 9px;
        padding: 0.42rem 0.55rem;
        font: inherit;
      }

      .drop-zone {
        border: 2px dashed rgba(0, 121, 212, 0.32);
        border-radius: 12px;
        background: linear-gradient(180deg, #f8fcff 0%, #eef8ff 100%);
        padding: 0.9rem;
        text-align: center;
      }

      .drop-zone.is-dragover {
        border-color: var(--royal-blue);
        box-shadow: 0 0 0 4px rgba(0, 121, 212, 0.14);
        background: #e8f5ff;
      }

      .drop-zone__title {
        margin: 0;
        font-weight: 800;
        color: var(--royal-navy);
      }

      .drop-zone__meta {
        margin: 0.2rem 0 0.55rem;
        font-size: 0.84rem;
        color: var(--royal-ink);
      }

      .drop-zone__input { display: none; }

      .manage-help {
        margin: 0;
        color: var(--royal-ink);
        font-size: 0.87rem;
        font-weight: 700;
      }

      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: var(--gallery-gap);
      }

      .gallery-list {
        display: grid;
        gap: 0.85rem;
      }

      body.gallery-list-view .gallery-grid { display: none; }
      body.gallery-grid-view .gallery-list { display: none; }

      .photo-card,
      .list-item {
        position: relative;
        border: 1px solid var(--royal-border);
        border-radius: 14px;
        overflow: hidden;
        background: #fff;
        box-shadow: var(--royal-shadow-lg);
        transition: var(--royal-transition);
        outline: none;
      }

      .photo-card:is(:hover, :focus-within),
      .list-item:is(:hover, :focus-within) {
        transform: translateY(-2px);
        box-shadow: var(--royal-shadow-xl);
      }

      .photo-card:focus-within,
      .list-item:focus-within { box-shadow: var(--royal-shadow-xl), var(--focus); }

      .photo-card {
        display: flex;
        flex-direction: column;
        cursor: pointer;
      }

      .select-photo {
        position: absolute;
        left: 10px;
        top: 10px;
        z-index: 4;
        width: 20px;
        height: 20px;
        accent-color: var(--royal-blue);
      }

      .photo-card.selected,
      .list-item.selected {
        box-shadow: 0 0 0 3px rgba(0, 121, 212, 0.35), var(--royal-shadow-xl);
      }

      .photo-card__notes {
        margin: 0.5rem 0 0;
        color: #38566f;
        font-size: 0.84rem;
        font-style: italic;
      }

      /* Category accent band (data-category applied by JS) */
      .photo-card::before,
      .list-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 4px;
        width: 100%;
        background: linear-gradient(90deg, rgba(0,121,212,0.25), rgba(25,194,255,0.25));
      }

      .photo-card[data-category="ports"]::before,
      .list-item[data-category="ports"]::before {
        background: linear-gradient(90deg, rgba(255,201,58,0.9), rgba(255,176,32,0.7));
      }

      .photo-card[data-category="dining"]::before,
      .list-item[data-category="dining"]::before {
        background: linear-gradient(90deg, rgba(25,194,255,0.85), rgba(0,121,212,0.7));
      }

      .photo-card[data-category="staterooms"]::before,
      .list-item[data-category="staterooms"]::before {
        background: linear-gradient(90deg, rgba(126,157,189,0.9), rgba(11,79,144,0.55));
      }

      .photo-card[data-category="decks"]::before,
      .list-item[data-category="decks"]::before {
        background: linear-gradient(90deg, rgba(0,121,212,0.85), rgba(11,79,144,0.7));
      }

      .photo-card[data-category="activities"]::before,
      .list-item[data-category="activities"]::before {
        background: linear-gradient(90deg, rgba(25,194,255,0.65), rgba(255,201,58,0.7));
      }

      .photo-card__image,
      .list-item__image {
        width: 100%;
        aspect-ratio: 4 / 3;
        object-fit: cover;
        display: block;
        background: var(--royal-light);
        transform: scale(1.02);
        transition: transform 0.6s ease, filter 0.2s ease;
      }

      .photo-card:hover .photo-card__image,
      .list-item:hover .list-item__image { transform: scale(1.08); }

      /* Shimmer placeholder until loaded */
      .img-shimmer {
        background: linear-gradient(90deg, #eef6fb 25%, #f9fcff 50%, #eef6fb 75%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        filter: saturate(0.9);
      }

      @keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }

      .photo-card__content,
      .list-item__content {
        padding: 0.9rem;
      }

      .photo-card__title {
        margin: 0;
        color: var(--royal-navy);
        font-size: 1.05rem;
        font-weight: 900;
        letter-spacing: -0.01em;
      }

      .photo-card__meta {
        margin: 0.6rem 0 0.55rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.45rem;
      }

      .meta-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        font-size: 0.78rem;
        padding: 0.26rem 0.5rem;
        border-radius: 9px;
        background: var(--royal-light);
        color: var(--royal-navy);
        font-weight: 900;
        border: 1px solid rgba(0, 121, 212, 0.10);
      }

      .photo-card__description {
        margin: 0;
        color: var(--royal-ink);
        opacity: 0.9;
        font-size: 0.93rem;
        line-height: 1.45;
      }

      .source-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.3rem 0.55rem;
        border-radius: 999px;
        font-weight: 900;
        font-size: 0.76rem;
        color: #fff;
        border: 1px solid rgba(255,255,255,0.22);
        background: rgba(0,0,0,0.52);
        backdrop-filter: blur(10px);
        pointer-events: none;
      }

      .list-item {
        display: grid;
        grid-template-columns: 220px minmax(0, 1fr);
        align-items: stretch;
        cursor: pointer;
      }

      .list-item__image {
        height: 100%;
        border-radius: 0;
        aspect-ratio: auto;
      }

      /* =======================
         Empty state
         ======================= */
      .gallery-empty {
        text-align: center;
        padding: 2.2rem 1.2rem;
        border: 2px dashed var(--royal-border);
        border-radius: 14px;
        background: #fff;
        margin-top: 1rem;
        animation: fadeIn 0.35s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(6px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .empty-title {
        margin: 0 0 0.35rem;
        font-family: "Montserrat", sans-serif;
        font-weight: 900;
        color: var(--royal-navy);
      }

      .empty-sub {
        margin: 0 auto 1rem;
        max-width: 62ch;
        color: var(--royal-ink);
        opacity: 0.9;
        font-weight: 700;
      }

      .empty-actions {
        display: flex;
        justify-content: center;
        gap: 0.55rem;
        flex-wrap: wrap;
      }

      .ghost-btn {
        border-radius: 12px;
        padding: 0.65rem 0.9rem;
        font-weight: 900;
      }

      /* =======================
         Lightbox — premium
         ======================= */
      .lightbox {
        position: fixed;
        inset: 0;
        display: none;
        background: rgba(6, 18, 32, 0.94);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        opacity: 0;
        transition: opacity 0.25s ease;
      }

      .lightbox.active {
        display: flex;
        opacity: 1;
      }

      .lightbox__shell {
        max-width: min(100%, 1120px);
        width: 100%;
        display: grid;
        grid-template-columns: minmax(0, 1fr);
        gap: 0.7rem;
        position: relative;
      }

      .lightbox__image {
        width: 100%;
        max-height: 76vh;
        object-fit: contain;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.06);
      }

      .lightbox__toolbar {
        display: flex;
        justify-content: space-between;
        gap: 0.7rem;
        align-items: center;
        color: #fff;
      }

      .lightbox__left {
        display: flex;
        flex-direction: column;
        gap: 0.18rem;
        min-width: 0;
      }

      .lightbox__title {
        margin: 0;
        font-weight: 900;
        font-size: 1.05rem;
        letter-spacing: -0.01em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .lightbox__desc {
        margin: 0;
        opacity: 0.88;
        font-weight: 700;
        font-size: 0.9rem;
        line-height: 1.35;
      }

      .lightbox__counter {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        margin-top: 0.2rem;
        font-size: 0.8rem;
        font-weight: 900;
        opacity: 0.92;
      }

      .lightbox__actions {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .lightbox button,
      .lightbox a.lightbox__link {
        border: none;
        border-radius: 999px;
        padding: 0.5rem 0.8rem;
        background: rgba(255, 255, 255, 0.13);
        color: #fff;
        cursor: pointer;
        font: inherit;
        font-weight: 900;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
      }

      .lightbox button:is(:hover, :focus-visible),
      .lightbox a.lightbox__link:is(:hover, :focus-visible) {
        outline: none;
        background: rgba(255, 255, 255, 0.18);
        box-shadow: 0 0 0 4px rgba(25, 194, 255, 0.16);
      }

      /* Big prev/next hit targets */
      .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 52px;
        height: 52px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255,255,255,0.18);
        backdrop-filter: blur(10px);
      }

      .lightbox-nav--prev { left: -8px; }
      .lightbox-nav--next { right: -8px; }

      .lightbox-nav i { font-size: 1.05rem; }

      /* =======================
         Quick links
         ======================= */
      .quick-links { padding-top: 0.2rem; }

      .quick-links__grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 0.8rem;
      }

      .quick-link-card {
        border: 1px solid var(--royal-border);
        border-radius: 14px;
        padding: 1rem;
        color: var(--royal-navy);
        text-decoration: none;
        background: #fff;
        box-shadow: var(--royal-shadow-lg);
        transition: var(--royal-transition);
      }

      .quick-link-card:is(:hover, :focus-visible) {
        outline: none;
        transform: translateY(-2px);
        box-shadow: var(--royal-shadow-xl);
      }

      .quick-link-card h3,
      .quick-link-card p { margin: 0; }

      .quick-link-card p {
        margin-top: 0.35rem;
        color: var(--royal-ink);
        font-size: 0.92rem;
        opacity: 0.9;
        font-weight: 700;
      }

      @media (max-width: 980px) {
        .gallery-controls__inner { grid-template-columns: 1fr; }
        .collection-admin__stats { grid-template-columns: 1fr; }
        .collection-admin__tools { grid-template-columns: 1fr; }
        .list-item { grid-template-columns: 1fr; }
        .lightbox-nav--prev { left: 8px; }
        .lightbox-nav--next { right: 8px; }
      }

      @media (prefers-reduced-motion: reduce) {
        .photo-hero::before { animation: none; }
        .featured-card__img,
        .photo-card__image,
        .list-item__image { transition: none; transform: none !important; }
        .img-shimmer { animation: none; }
      }
    </style>
  </head>

  <body class="app-theme-rcc gallery-grid-view photos-page">
    <!-- Shared header injected by shared-layout.js -->
    <div id="sharedHeader" data-page="photos"></div>

    <main class="photo-library-page">
      <section class="photo-hero" aria-label="Photo library hero">
        <div class="photo-hero__inner">
          <span class="photo-hero__eyebrow">Adventure of the Seas · Feb 14-20, 2026</span>
          <h1>Photo Library</h1>
          <p class="photo-hero__subtitle">
            A visual planning index for <strong>Adventure of the Seas</strong>: rooms, dining, decks, ports, and hero angles.
          </p>

          <div class="photo-hero__highlights" aria-label="Photo library highlights">
            <span class="photo-hero__tag"><i class="fas fa-camera-retro" aria-hidden="true"></i> Hero-angle ship shots</span>
            <span class="photo-hero__tag"><i class="fas fa-ship" aria-hidden="true"></i> Deck and room scouting</span>
            <span class="photo-hero__tag"><i class="fas fa-map-signs" aria-hidden="true"></i> Port-day visual planning</span>
          </div>

          <div class="hero-stats" aria-label="Library stats">
            <span class="hero-chip"><i class="fas fa-images" aria-hidden="true"></i> <span id="heroTotal">—</span> photos</span>
            <span class="hero-chip"><i class="fas fa-layer-group" aria-hidden="true"></i> <span id="heroCats">—</span> categories</span>
            <span class="hero-chip"><i class="fas fa-crown" aria-hidden="true"></i> <span id="heroOfficial">—</span> official</span>
          </div>

          <div class="hero-category-shortcuts" aria-label="Popular categories">
            <button class="filter-btn" data-filter="staterooms">Rooms</button>
            <button class="filter-btn" data-filter="dining">Dining</button>
            <button class="filter-btn" data-filter="decks">Decks</button>
            <button class="filter-btn" data-filter="ports">Ports</button>
            <button class="filter-btn" data-filter="heroes">Hero angles</button>
          </div>
        </div>
      </section>

      <section class="featured-strip" aria-label="Featured photos">
        <div class="featured-strip__inner">
          <div class="featured-header">
            <h2 class="featured-title">Featured</h2>
            <p class="featured-sub">Quick hits that sell the vibe.</p>
          </div>
          <div class="featured-rail" id="featuredRail" role="list" aria-label="Featured photo rail"></div>
        </div>
      </section>

      <div class="gallery-controls" aria-label="Gallery controls">
        <div class="gallery-controls__inner">
          <label class="gallery-search" for="gallerySearch">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input
              id="gallerySearch"
              type="search"
              aria-label="Search images"
              placeholder="Search by name, category, deck, or tags"
            />
          </label>

          <div class="gallery-filters" aria-label="Image source filters">
            <button class="filter-btn active" data-filter="all">All photos</button>
            <button class="filter-btn" data-filter="official">Official RCCL</button>
            <button class="filter-btn" data-filter="passenger">Trip snapshots</button>
            <button class="filter-btn" data-filter="your-deck">Deck 12</button>
          </div>

          <div class="gallery-view-toggle" aria-label="View mode">
            <button class="view-btn active" data-view="grid" aria-label="Grid view">
              <i class="fas fa-th-large" aria-hidden="true"></i>
            </button>
            <button class="view-btn" data-view="list" aria-label="List view">
              <i class="fas fa-list" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>

      <section class="gallery-main" aria-label="Image gallery">
        <div class="gallery-info-bar">
          <p class="photo-count">
            Showing <span id="photoCount">0</span> photos
            <span class="count-pill" id="activeFilterPill"><i class="fas fa-filter" aria-hidden="true"></i> All</span>
          </p>

          <div class="sort-control">
            <label for="sortSelect">Sort:</label>
            <select id="sortSelect" aria-label="Sort photos">
              <option value="relevance">Relevance</option>
              <option value="name">Name (A-Z)</option>
              <option value="category">Category</option>
              <option value="deck">Deck</option>
            </select>
          </div>

          <div class="manage-actions" aria-label="Manage photo actions">
            <button class="manage-btn" id="toggleManageMode" type="button">
              <i class="fas fa-pen-to-square" aria-hidden="true"></i> Manage photos
            </button>
            <button class="manage-btn" id="addPhotoBtn" type="button">
              <i class="fas fa-plus" aria-hidden="true"></i> Add
            </button>
            <button class="manage-btn" id="replacePhotoBtn" type="button" disabled>
              <i class="fas fa-arrows-rotate" aria-hidden="true"></i> Replace
            </button>
            <button class="manage-btn" id="deletePhotoBtn" type="button" disabled>
              <i class="fas fa-trash" aria-hidden="true"></i> Delete
            </button>
          </div>
        </div>

        <form class="manage-panel" id="managePanel" hidden>
          <div class="manage-panel__grid">
            <label>
              Name
              <input id="manageTitle" type="text" placeholder="Photo name" />
            </label>
            <label>
              Category
              <select id="manageCategory">
                <option value="staterooms">Staterooms</option>
                <option value="dining">Dining</option>
                <option value="decks">Decks</option>
                <option value="ports">Ports</option>
                <option value="activities">Activities</option>
              </select>
            </label>
            <label>
              Deck
              <input id="manageDeck" type="text" placeholder="e.g. 12" />
            </label>
            <label>
              Source
              <select id="manageSource">
                <option value="official">Official</option>
                <option value="passenger">Passenger</option>
              </select>
            </label>
            <label>
              Image path
              <input id="manageSrc" type="text" placeholder="images/... or leave empty when picking a file" />
            </label>
            <label>
              Upload from your device
              <input id="manageFile" type="file" accept="image/*" />
            </label>
            <label>
              Tags (comma separated)
              <input id="manageTags" type="text" placeholder="hero, deck-12" />
            </label>
          </div>

          <label>
            Notes / description
            <textarea id="manageNotes" placeholder="Notes about this photo"></textarea>
          </label>

          <div class="manage-panel__actions">
            <button class="manage-btn" id="saveNewPhotoBtn" type="submit">Save new photo</button>
            <button class="manage-btn" id="cancelManageBtn" type="button">Cancel</button>
          </div>
          <p class="manage-help" id="manageStatus">Manage mode is off.</p>
        </form>

        <div class="gallery-grid" id="photoGrid" role="list" aria-label="Photo grid"></div>
        <div class="gallery-list" id="photoList" role="list" aria-label="Photo list"></div>

        <div class="gallery-empty" id="emptyState" hidden>
          <h3 class="empty-title">No matches</h3>
          <p class="empty-sub">
            Nothing fits that filter/search combo. Clear filters, simplify the search, or try category shortcuts.
          </p>
          <div class="empty-actions">
            <button class="ghost-btn" id="resetFilters">
              <i class="fas fa-rotate-left" aria-hidden="true"></i> Reset filters
            </button>
            <button class="ghost-btn" id="clearSearchBtn">
              <i class="fas fa-xmark" aria-hidden="true"></i> Clear search
            </button>
          </div>
        </div>
      </section>

      <section class="quick-links" aria-label="Quick links">
        <div class="quick-links__grid">
          <a class="quick-link-card" href="decks.html">
            <h3><i class="fas fa-map" aria-hidden="true"></i> Deck Plans</h3>
            <p>Jump to interactive deck maps.</p>
          </a>
          <a class="quick-link-card" href="dining.html">
            <h3><i class="fas fa-utensils" aria-hidden="true"></i> Dining</h3>
            <p>Find venues and nearby favorites.</p>
          </a>
          <a class="quick-link-card" href="rooms.html">
            <h3><i class="fas fa-bed" aria-hidden="true"></i> Staterooms</h3>
            <p>Room categories, locations, and notes.</p>
          </a>
        </div>
      </section>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" hidden tabindex="-1" aria-label="Image viewer" role="dialog" aria-modal="true">
      <div class="lightbox__shell">
        <button class="lightbox-nav lightbox-nav--prev" id="prevPhoto" aria-label="Previous photo">
          <i class="fas fa-chevron-left" aria-hidden="true"></i>
        </button>

        <button class="lightbox-nav lightbox-nav--next" id="nextPhoto" aria-label="Next photo">
          <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </button>

        <img class="lightbox__image" id="lightboxImage" src="" alt="" />

        <div class="lightbox__toolbar">
          <div class="lightbox__left">
            <p class="lightbox__title" id="lightboxTitle">—</p>
            <p class="lightbox__desc" id="lightboxDescription">—</p>
            <span class="lightbox__counter" id="lightboxCounter">
              <i class="fas fa-hashtag" aria-hidden="true"></i> <span id="lightboxCounterText">—</span>
            </span>
          </div>

          <div class="lightbox__actions">
            <a class="lightbox__link" id="openOriginal" href="#" target="_blank" rel="noopener">
              <i class="fas fa-up-right-from-square" aria-hidden="true"></i> Open
            </a>
            <a class="lightbox__link" id="downloadImage" href="#" download>
              <i class="fas fa-download" aria-hidden="true"></i> Download
            </a>
            <button id="closeLightbox" aria-label="Close image viewer">
              <i class="fas fa-xmark" aria-hidden="true"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Shared bottom nav injected by shared-layout.js -->
    <div id="sharedBottomNav" data-page="photos"></div>

    <script>
      /* =========================================================
         Data (kept compatible with your current structure)
         ========================================================= */
      let photoData = [
        {
          id: 1,
          title: "Adventure Exterior at Sea",
          src: "images/ship/rccl-adventure-of-the-seas-exterior-at-sea.webp",
          category: "decks",
          deck: "Topside",
          source: "official",
          description: "Wide exterior view of Adventure of the Seas underway.",
          tags: ["ship", "exterior", "hero"],
        },
        {
          id: 2,
          title: "Pool Deck",
          src: "images/ship/rccl-adventure-of-the-seas-pool-deck.webp",
          category: "decks",
          deck: "11",
          source: "official",
          description: "Main pool deck setup with lounge seating.",
          tags: ["pool", "deck-11"],
        },
        {
          id: 3,
          title: "Family Deck Activities",
          src: "images/ship/rccl-adventure-of-the-seas-family-deck-activities.jpeg",
          category: "activities",
          deck: "12",
          source: "official",
          description: "Family-friendly activity area on upper deck.",
          tags: ["family", "deck-12"],
        },
        {
          id: 4,
          title: "Main Dining Room",
          src: "images/venues/rccl-adventure-of-the-seas-main-dining-room.webp",
          category: "dining",
          deck: "3",
          source: "official",
          description: "Formal dining room interior with multi-level seating.",
          tags: ["dining", "formal"],
        },
        {
          id: 5,
          title: "Windjammer Buffet",
          src: "images/venues/rccl-adventure-of-the-seas-windjammer-buffet.jpeg",
          category: "dining",
          deck: "11",
          source: "official",
          description: "Windjammer buffet seating and serving stations.",
          tags: ["buffet", "casual"],
        },
        {
          id: 6,
          title: "Windjammer Buffet (Alternate)",
          src: "images/venues/rccl-adventure-of-the-seas-windjammer-buffet-2.jpeg",
          category: "dining",
          deck: "11",
          source: "official",
          description: "Alternate view of Windjammer buffet seating.",
          tags: ["buffet", "alternate"],
        },
        {
          id: 7,
          title: "Johnny Rockets",
          src: "images/venues/rccl-adventure-of-the-seas-johnny-rockets.jpeg",
          category: "dining",
          deck: "12",
          source: "official",
          description: "Classic diner styling and casual bites.",
          tags: ["deck-12", "casual"],
        },
        {
          id: 8,
          title: "Specialty Dining Entree",
          src: "images/venues/rccl-adventure-of-the-seas-specialty-dining-entree.jpeg",
          category: "dining",
          deck: "",
          source: "official",
          description: "Specialty dining plated entree presentation.",
          tags: ["specialty", "entree"],
        },
        {
          id: 9,
          title: "Royal Promenade Arch",
          src: "images/venues/rccl-adventure-of-the-seas-royal-promenade-arch.jpeg",
          category: "decks",
          deck: "5",
          source: "official",
          description: "Promenade focal-point arch and social space.",
          tags: ["promenade"],
        },
        {
          id: 10,
          title: "Royal Promenade Classic Car",
          src: "images/venues/rccl-adventure-of-the-seas-royal-promenade-classic-car.webp",
          category: "decks",
          deck: "5",
          source: "official",
          description: "Classic car centerpiece on the Royal Promenade.",
          tags: ["promenade", "landmark"],
        },
        {
          id: 11,
          title: "Ice Skating Rink",
          src: "images/venues/rccl-adventure-of-the-seas-ice-skating-rink.jpeg",
          category: "activities",
          deck: "3",
          source: "official",
          description: "Studio B ice rink used for shows and open skate.",
          tags: ["shows", "ice"],
        },
        {
          id: 12,
          title: "Main Theater Stage",
          src: "images/venues/rccl-adventure-of-the-seas-main-theater-stage.webp",
          category: "activities",
          deck: "3",
          source: "official",
          description: "Main theater stage setup for production shows.",
          tags: ["theater", "shows"],
        },
        {
          id: 13,
          title: "Main Theater Stage (Alternate)",
          src: "images/venues/rccl-adventure-of-the-seas-main-theater-stage-2.webp",
          category: "activities",
          deck: "3",
          source: "official",
          description: "Alternate angle of the main theater stage.",
          tags: ["theater", "alternate"],
        },
        {
          id: 14,
          title: "Main Theater Seating",
          src: "images/venues/rccl-adventure-of-the-seas-main-theater-seating.webp",
          category: "activities",
          deck: "3",
          source: "official",
          description: "Seating layout in the ship's main theater.",
          tags: ["theater", "seating"],
        },
        {
          id: 15,
          title: "Spa Treatment",
          src: "images/venues/rccl-adventure-of-the-seas-spa-treatment.webp",
          category: "activities",
          deck: "12",
          source: "official",
          description: "Spa treatment room setup and amenities.",
          tags: ["spa", "wellness"],
        },
        {
          id: 16,
          title: "Spa Treatment (Alternate)",
          src: "images/venues/rccl-adventure-of-the-seas-spa-treatment-2.webp",
          category: "activities",
          deck: "12",
          source: "official",
          description: "Alternate spa treatment area view.",
          tags: ["spa", "alternate"],
        },
        {
          id: 17,
          title: "Ben & Jerry's",
          src: "images/venues/rccl-adventure-of-the-seas-ben-and-jerrys.webp",
          category: "dining",
          deck: "5",
          source: "official",
          description: "Ice cream counter on the Royal Promenade.",
          tags: ["ice-cream", "promenade"],
        },
        {
          id: 18,
          title: "Perfect Day at CocoCay Aerial Balloon",
          src: "images/ports/rccl-perfect-day-cococay-aerial-balloon.jpeg",
          category: "ports",
          deck: "",
          source: "official",
          description: "Aerial balloon view of Perfect Day at CocoCay.",
          tags: ["cococay", "aerial", "hero"],
        },
        {
          id: 19,
          title: "Perfect Day Thrill Tower",
          src: "images/ports/rccl-perfect-day-cococay-thrill-tower.jpeg",
          category: "ports",
          deck: "",
          source: "official",
          description: "Thrill tower close-up with slide complex.",
          tags: ["thrill", "slides"],
        },
        {
          id: 20,
          title: "Perfect Day Thrill Waterpark Aerial",
          src: "images/ports/rccl-perfect-day-cococay-thrill-waterpark-aerial.webp",
          category: "ports",
          deck: "",
          source: "official",
          description: "Aerial perspective of Thrill Waterpark at CocoCay.",
          tags: ["waterpark", "aerial"],
        },
      ];

      const IMAGE_MANIFEST = [
        "images/ports/rccl-perfect-day-cococay-aerial-balloon.jpeg",
        "images/ports/rccl-perfect-day-cococay-thrill-tower.jpeg",
        "images/ports/rccl-perfect-day-cococay-thrill-waterpark-aerial.webp",
        "images/ship/rccl-adventure-of-the-seas-exterior-at-sea.webp",
        "images/ship/rccl-adventure-of-the-seas-family-deck-activities.jpeg",
        "images/ship/rccl-adventure-of-the-seas-pool-deck.webp",
        "images/venues/rccl-adventure-of-the-seas-ben-and-jerrys.webp",
        "images/venues/rccl-adventure-of-the-seas-ice-skating-rink.jpeg",
        "images/venues/rccl-adventure-of-the-seas-johnny-rockets.jpeg",
        "images/venues/rccl-adventure-of-the-seas-main-dining-room.webp",
        "images/venues/rccl-adventure-of-the-seas-main-theater-seating.webp",
        "images/venues/rccl-adventure-of-the-seas-main-theater-stage-2.webp",
        "images/venues/rccl-adventure-of-the-seas-main-theater-stage.webp",
        "images/venues/rccl-adventure-of-the-seas-royal-promenade-arch.jpeg",
        "images/venues/rccl-adventure-of-the-seas-royal-promenade-classic-car.webp",
        "images/venues/rccl-adventure-of-the-seas-spa-treatment-2.webp",
        "images/venues/rccl-adventure-of-the-seas-spa-treatment.webp",
        "images/venues/rccl-adventure-of-the-seas-specialty-dining-entree.jpeg",
        "images/venues/rccl-adventure-of-the-seas-windjammer-buffet-2.jpeg",
        "images/venues/rccl-adventure-of-the-seas-windjammer-buffet.jpeg",
      ];

      function toTitleCase(value) {
        return String(value || "")
          .split(/\s+/)
          .filter(Boolean)
          .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
          .join(" ");
      }

      function deriveTitleFromSrc(src) {
        const fileName = src.split("/").pop() || src;
        const baseName = fileName.replace(/\.[^.]+$/, "");
        const cleaned = baseName
          .replace(/^rccl-/, "")
          .replace(/adventure-of-the-seas/g, "")
          .replace(/cococay/g, "CocoCay")
          .replace(/-/g, " ")
          .replace(/\s+/g, " ")
          .trim();
        return toTitleCase(cleaned || baseName);
      }

      function inferCategoryFromSrc(src) {
        if (src.includes("/ports/")) return "ports";
        if (src.includes("/ship/")) return "decks";
        if (src.includes("/venues/")) {
          const lower = src.toLowerCase();
          if (/(windjammer|dining|johnny-rockets|ben-and-jerrys|specialty)/.test(lower)) return "dining";
          if (/(theater|ice-skating|spa)/.test(lower)) return "activities";
          if (/promenade/.test(lower)) return "decks";
          return "activities";
        }
        return "decks";
      }

      function inferTagsFromSrc(src) {
        const fileName = (src.split("/").pop() || "").replace(/\.[^.]+$/, "");
        return fileName
          .replace(/^rccl-/, "")
          .split("-")
          .filter(Boolean)
          .filter((token) => !["adventure", "of", "the", "seas"].includes(token));
      }

      function syncPhotoDataFromManifest() {
        const imageBySrc = new Map(
          photoData
            .filter((photo) => typeof photo.src === "string" && photo.src.startsWith("images/"))
            .map((photo) => [photo.src, photo]),
        );

        const nonImageRecords = photoData.filter(
          (photo) => typeof photo.src === "string" && !photo.src.startsWith("images/"),
        );

        photoData = IMAGE_MANIFEST.map((src, idx) => {
          const existing = imageBySrc.get(src) || {};
          const defaultTitle = deriveTitleFromSrc(src);
          const defaultCategory = inferCategoryFromSrc(src);
          return {
            id: idx + 1,
            title: defaultTitle,
            src,
            category: defaultCategory,
            deck: "",
            source: "official",
            description: `Official cruise image: ${defaultTitle}.`,
            tags: inferTagsFromSrc(src),
            ...existing,
            id: idx + 1,
            src,
          };
        });

        if (nonImageRecords.length > 0) {
          const startId = photoData.length + 1;
          nonImageRecords.forEach((record, index) => {
            photoData.push({ ...record, id: startId + index });
          });
        }
      }

      syncPhotoDataFromManifest();

      function getValidPhotoData() {
        return photoData.filter((photo) => {
          if (typeof photo.src !== "string") return false;
          return (
            photo.src.startsWith("images/")
            || photo.src.startsWith("blob:")
            || photo.src.startsWith("data:image/")
          );
        });
      }

      const requiredPhotoFiles = IMAGE_MANIFEST.map((path) => path.split("/").pop()).filter(Boolean);

      function validateRequiredPhotos() {
        const availableFiles = new Set(
          photoData.map((photo) => photo.src.split("/").pop()).filter(Boolean),
        );
        const missingFiles = requiredPhotoFiles.filter((fileName) => !availableFiles.has(fileName));

        if (missingFiles.length > 0) {
          console.warn("Missing required photos:", missingFiles);
        }
      }


      document.addEventListener("DOMContentLoaded", () => {
        const galleryGrid = document.getElementById("photoGrid");
        const galleryList = document.getElementById("photoList");
        const searchInput = document.getElementById("gallerySearch");
        const filterButtons = Array.from(document.querySelectorAll(".filter-btn[data-filter]"));
        const viewButtons = Array.from(document.querySelectorAll(".view-btn"));
        const sortSelect = document.getElementById("sortSelect");
        const photoCount = document.getElementById("photoCount");
        const emptyState = document.getElementById("emptyState");
        const resetButton = document.getElementById("resetFilters");
        const clearSearchBtn = document.getElementById("clearSearchBtn");
        const activeFilterPill = document.getElementById("activeFilterPill");

        const featuredRail = document.getElementById("featuredRail");

        const heroTotal = document.getElementById("heroTotal");
        const heroCats = document.getElementById("heroCats");
        const heroOfficial = document.getElementById("heroOfficial");

        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightboxImage");
        const lightboxTitle = document.getElementById("lightboxTitle");
        const lightboxDescription = document.getElementById("lightboxDescription");
        const lightboxCounterText = document.getElementById("lightboxCounterText");
        const openOriginal = document.getElementById("openOriginal");
        const downloadImage = document.getElementById("downloadImage");

        const prevButton = document.getElementById("prevPhoto");
        const nextButton = document.getElementById("nextPhoto");
        const closeButton = document.getElementById("closeLightbox");

        const toggleManageMode = document.getElementById("toggleManageMode");
        const addPhotoBtn = document.getElementById("addPhotoBtn");
        const replacePhotoBtn = document.getElementById("replacePhotoBtn");
        const deletePhotoBtn = document.getElementById("deletePhotoBtn");
        const managePanel = document.getElementById("managePanel");
        const manageForm = managePanel;
        const manageTitle = document.getElementById("manageTitle");
        const manageCategory = document.getElementById("manageCategory");
        const manageDeck = document.getElementById("manageDeck");
        const manageSource = document.getElementById("manageSource");
        const manageSrc = document.getElementById("manageSrc");
        const manageFile = document.getElementById("manageFile");
        const manageTags = document.getElementById("manageTags");
        const manageNotes = document.getElementById("manageNotes");
        const cancelManageBtn = document.getElementById("cancelManageBtn");
        const manageStatus = document.getElementById("manageStatus");

        const requiredElements = [
          galleryGrid, galleryList, searchInput, sortSelect, photoCount, emptyState,
          resetButton, clearSearchBtn, activeFilterPill, featuredRail,
          heroTotal, heroCats, heroOfficial,
          lightbox, lightboxImage, lightboxTitle, lightboxDescription, lightboxCounterText,
          openOriginal, downloadImage, prevButton, nextButton, closeButton,
          toggleManageMode, addPhotoBtn, replacePhotoBtn, deletePhotoBtn,
          managePanel, manageTitle, manageCategory, manageDeck, manageSource,
          manageSrc, manageFile, manageTags, manageNotes, cancelManageBtn, manageStatus,
        ];

        if (requiredElements.some((element) => !element)) {
          console.error("Photo library initialization aborted: missing required DOM element.");
          return;
        }

        let uploadObjectUrl = "";

        function clearUploadObjectUrl() {
          if (uploadObjectUrl && uploadObjectUrl.startsWith("blob:")) {
            URL.revokeObjectURL(uploadObjectUrl);
          }
          uploadObjectUrl = "";
        }

        let currentFilter = "all";
        let currentView = "grid";
        let currentSearch = "";
        let currentSort = "relevance";
        let currentIndex = 0;
        let filteredPhotos = getValidPhotoData();
        let manageMode = false;
        let selectedPhotoIds = new Set();

        /* -----------------------------
           Hero stats
           ----------------------------- */
        function updateHeroStats() {
          const categories = new Set(photoData.map((p) => p.category));
          heroTotal.textContent = String(photoData.length);
          heroCats.textContent = String(categories.size);
          heroOfficial.textContent = String(photoData.filter((p) => p.source === "official").length);
        }

        updateHeroStats();
        validateRequiredPhotos();

        /* -----------------------------
           Helpers
           ----------------------------- */
        function prettyFilterLabel(f) {
          if (f === "all") return "All";
          if (f === "official") return "Official";
          if (f === "passenger") return "Snapshots";
          if (f === "your-deck") return "Deck 12";
          return f.charAt(0).toUpperCase() + f.slice(1);
        }

        function matchesFilter(photo) {
          if (currentFilter === "all") return true;
          if (currentFilter === "official" || currentFilter === "passenger")
            return photo.source === currentFilter;
          if (currentFilter === "your-deck") return String(photo.deck).includes("12");
          return photo.category === currentFilter;
        }

        function score(photo, searchTerm) {
          if (!searchTerm) return 0;
          const haystack =
            `${photo.title} ${photo.description} ${photo.notes || ""} ${photo.category} ${photo.deck || ""} ${(photo.tags || []).join(" ")}`.toLowerCase();
          if (!haystack.includes(searchTerm)) return -1;
          if (photo.title.toLowerCase().includes(searchTerm)) return 3;
          if ((photo.tags || []).join(" ").includes(searchTerm)) return 2;
          return 1;
        }

        function filterAndSort() {
          const term = currentSearch.trim().toLowerCase();
          filteredPhotos = getValidPhotoData()
            .filter((photo) => matchesFilter(photo))
            .map((photo) => ({ photo, relevance: score(photo, term) }))
            .filter((item) => item.relevance >= (term ? 0 : -1));

          filteredPhotos.sort((a, b) => {
            if (currentSort === "name") return a.photo.title.localeCompare(b.photo.title);
            if (currentSort === "category")
              return a.photo.category.localeCompare(b.photo.category) || a.photo.title.localeCompare(b.photo.title);
            if (currentSort === "deck")
              return String(a.photo.deck || "999").localeCompare(String(b.photo.deck || "999"));
            return b.relevance - a.relevance || a.photo.title.localeCompare(b.photo.title);
          });

          filteredPhotos = filteredPhotos.map((entry) => entry.photo);
        }

        function renderMeta(photo) {
          const deck = photo.deck
            ? `<span class="meta-tag"><i class="fas fa-layer-group"></i> Deck ${photo.deck}</span>`
            : "";
          return `
            <span class="meta-tag"><i class="fas fa-folder"></i> ${photo.category}</span>
            ${deck}
            <span class="meta-tag"><i class="fas fa-${photo.source === "official" ? "crown" : "camera"}"></i> ${photo.source}</span>
          `;
        }

        function injectShimmer(img) {
          img.classList.add("img-shimmer");
          const done = () => img.classList.remove("img-shimmer");
          if (img.complete) done();
          img.addEventListener("load", done, { once: true });
          img.addEventListener("error", done, { once: true });
        }

        /* -----------------------------
           Featured rail
           ----------------------------- */
        function buildFeatured() {
          // Pick “hero-ish” images first; otherwise top few official.
          const heroish = photoData.filter((p) => (p.tags || []).includes("hero") || p.category === "ports" || p.category === "decks");
          const picks = (heroish.length ? heroish : photoData)
            .slice()
            .sort((a, b) => (((b.tags || []).includes("hero") ? 1 : 0) - ((a.tags || []).includes("hero") ? 1 : 0)))
            .slice(0, 6);

          featuredRail.innerHTML = picks
            .map((p) => {
              const chips = [
                `<span class="mini-chip"><i class="fas fa-folder"></i> ${p.category}</span>`,
                p.deck ? `<span class="mini-chip"><i class="fas fa-layer-group"></i> ${p.deck}</span>` : "",
                `<span class="mini-chip"><i class="fas fa-${p.source === "official" ? "crown" : "camera"}"></i> ${p.source}</span>`,
              ].filter(Boolean).join("");

              return `
                <article class="featured-card" role="listitem" tabindex="0" data-photo-id="${p.id}">
                  <img class="featured-card__img" src="${p.src}" alt="${p.title}" loading="lazy" decoding="async" />
                  <div class="featured-card__overlay" aria-hidden="true"></div>
                  <div class="featured-card__meta">
                    <p class="featured-card__name">${p.title}</p>
                    <div class="featured-card__chips">${chips}</div>
                  </div>
                </article>
              `;
            })
            .join("");

          featuredRail.querySelectorAll("img").forEach(injectShimmer);
        }

        /* -----------------------------
           Render gallery
           ----------------------------- */
        function renderGallery() {
          filterAndSort();
          buildFeatured();

          photoCount.textContent = String(filteredPhotos.length);
          activeFilterPill.innerHTML = `<i class="fas fa-filter" aria-hidden="true"></i> ${prettyFilterLabel(currentFilter)}`;

          if (filteredPhotos.length === 0) {
            galleryGrid.innerHTML = "";
            galleryList.innerHTML = "";
            emptyState.hidden = false;
            return;
          }

          emptyState.hidden = true;

          galleryGrid.innerHTML = filteredPhotos
            .map(
              (photo, idx) => `
                <article class="photo-card ${selectedPhotoIds.has(photo.id) ? "selected" : ""}" role="listitem" tabindex="0" data-index="${idx}" data-id="${photo.id}" data-category="${photo.category}">
                  ${manageMode ? `<input class="select-photo" type="checkbox" data-select-id="${photo.id}" aria-label="Select ${photo.title}" ${selectedPhotoIds.has(photo.id) ? "checked" : ""} />` : ""}
                  <span class="source-badge"><i class="fas fa-${photo.source === "official" ? "crown" : "camera"}"></i> ${photo.source}</span>
                  <img class="photo-card__image" src="${photo.src}" alt="${photo.title}" loading="lazy" decoding="async" />
                  <div class="photo-card__content">
                    <h3 class="photo-card__title">${photo.title}</h3>
                    <div class="photo-card__meta">${renderMeta(photo)}</div>
                    <p class="photo-card__description">${photo.description}</p>
                    ${photo.notes ? `<p class="photo-card__notes">${photo.notes}</p>` : ""}
                  </div>
                </article>
              `
            )
            .join("");

          galleryList.innerHTML = filteredPhotos
            .map(
              (photo, idx) => `
                <article class="list-item ${selectedPhotoIds.has(photo.id) ? "selected" : ""}" role="listitem" tabindex="0" data-index="${idx}" data-id="${photo.id}" data-category="${photo.category}">
                  ${manageMode ? `<input class="select-photo" type="checkbox" data-select-id="${photo.id}" aria-label="Select ${photo.title}" ${selectedPhotoIds.has(photo.id) ? "checked" : ""} />` : ""}
                  <span class="source-badge"><i class="fas fa-${photo.source === "official" ? "crown" : "camera"}"></i> ${photo.source}</span>
                  <img class="list-item__image" src="${photo.src}" alt="${photo.title}" loading="lazy" decoding="async" />
                  <div class="list-item__content">
                    <h3 class="photo-card__title">${photo.title}</h3>
                    <div class="photo-card__meta">${renderMeta(photo)}</div>
                    <p class="photo-card__description">${photo.description}</p>
                    ${photo.notes ? `<p class="photo-card__notes">${photo.notes}</p>` : ""}
                  </div>
                </article>
              `
            )
            .join("");

          // Shimmer all newly rendered images
          document.querySelectorAll("#photoGrid img, #photoList img").forEach(injectShimmer);
          syncManageButtons();
        }

        function render() {
          renderGallery();
        }

        function syncManageButtons() {
          const selectedCount = selectedPhotoIds.size;
          replacePhotoBtn.disabled = selectedCount !== 1;
          deletePhotoBtn.disabled = selectedCount < 1;
          if (manageMode && selectedCount === 1) {
            fillManageForm(getSelectedPhotos()[0]);
          }
          manageStatus.textContent = manageMode
            ? `${selectedCount} selected. Add, replace, delete, and edit names/tags/notes.`
            : "Manage mode is off.";
        }

        function resetManageForm() {
          manageForm.reset();
          clearUploadObjectUrl();
          manageStatus.textContent = manageMode
            ? `${selectedPhotoIds.size} selected. Add, replace, delete, and edit names/tags/notes.`
            : "Manage mode is off.";
        }

        function fillManageForm(photo) {
          if (!photo) return;
          manageTitle.value = photo.title || "";
          manageCategory.value = photo.category || "decks";
          manageDeck.value = photo.deck || "";
          manageSource.value = photo.source || "official";
          manageSrc.value = photo.src || "";
          manageTags.value = (photo.tags || []).join(", ");
          manageNotes.value = photo.notes || photo.description || "";
        }

        function parseTags(rawTags) {
          return rawTags
            .split(",")
            .map((tag) => tag.trim())
            .filter(Boolean);
        }

        function getUploadSrc() {
          const file = manageFile.files?.[0];
          if (!file) return "";
          clearUploadObjectUrl();
          uploadObjectUrl = URL.createObjectURL(file);
          return uploadObjectUrl;
        }

        function getManageSourcePath() {
          const uploadedSrc = getUploadSrc();
          if (uploadedSrc) {
            if (manageSource.value === "official") {
              manageSource.value = "passenger";
            }
            return uploadedSrc;
          }

          const srcInput = manageSrc.value.trim();
          if (!srcInput) {
            manageStatus.textContent = "Add an images/ path or choose an image file from your device.";
            return "";
          }

          if (!srcInput.startsWith("images/")) {
            manageStatus.textContent = "Image path must start with images/ unless you pick a local image file.";
            return "";
          }

          return srcInput;
        }

        function getSelectedPhotos() {
          return photoData.filter((photo) => selectedPhotoIds.has(photo.id));
        }

        /* -----------------------------
           Lightbox
           ----------------------------- */
        function openLightbox(index) {
          currentIndex = index;
          const photo = filteredPhotos[currentIndex] || photoData[currentIndex];
          if (!photo) return;

          lightboxImage.src = photo.src;
          lightboxImage.alt = photo.title;

          lightboxTitle.textContent = photo.title;
          lightboxDescription.textContent = photo.description;

          // Counter uses filtered set if possible; fallback to full set
          const total = filteredPhotos.length ? filteredPhotos.length : photoData.length;
          const shownIndex = filteredPhotos.length ? currentIndex : index;
          lightboxCounterText.textContent = `${shownIndex + 1} of ${total}`;

          openOriginal.href = photo.src;
          downloadImage.href = photo.src;

          lightbox.hidden = false;
          lightbox.classList.add("active");
          document.body.style.overflow = "hidden";
          lightbox.focus();
        }

        function closeLightbox() {
          lightbox.hidden = true;
          lightbox.classList.remove("active");
          document.body.style.overflow = "";
        }

        function moveLightbox(step) {
          const pool = filteredPhotos.length ? filteredPhotos : photoData;
          if (pool.length === 0) return;
          currentIndex = (currentIndex + step + pool.length) % pool.length;
          // Ensure openLightbox reads from filtered pool
          if (!filteredPhotos.length) {
            // If we’re in fallback mode, just use photoData index
            openLightbox(currentIndex);
          } else {
            openLightbox(currentIndex);
          }
        }

        function activateCard(event) {
          if (event.target.closest(".select-photo")) return;
          const card = event.target.closest("[data-index]");
          if (!card) return;
          if (manageMode) {
            const photoId = Number(card.dataset.id);
            if (!photoId) return;
            if (selectedPhotoIds.has(photoId)) selectedPhotoIds.delete(photoId);
            else selectedPhotoIds.add(photoId);
            render();
            return;
          }
          openLightbox(Number(card.dataset.index));
        }

        featuredRail.addEventListener("click", (e) => {
          const card = e.target.closest("[data-photo-id]");
          if (!card) return;
          const id = Number(card.dataset.photoId);
          const idx = filteredPhotos.findIndex((p) => p.id === id);
          openLightbox(idx >= 0 ? idx : photoData.findIndex((p) => p.id === id));
        });

        featuredRail.addEventListener("keydown", (e) => {
          if (e.key !== "Enter" && e.key !== " ") return;
          const card = e.target.closest("[data-photo-id]");
          if (!card) return;
          e.preventDefault();
          const id = Number(card.dataset.photoId);
          const idx = filteredPhotos.findIndex((p) => p.id === id);
          openLightbox(idx >= 0 ? idx : photoData.findIndex((p) => p.id === id));
        });

        [galleryGrid, galleryList].forEach((container) => {
          container.addEventListener("click", activateCard);
          container.addEventListener("keydown", (event) => {
            if (event.key !== "Enter" && event.key !== " ") return;
            event.preventDefault();
            activateCard(event);
          });
          container.addEventListener("change", (event) => {
            const checkbox = event.target.closest(".select-photo");
            if (!checkbox) return;
            const id = Number(checkbox.dataset.selectId);
            if (!id) return;
            if (checkbox.checked) selectedPhotoIds.add(id);
            else selectedPhotoIds.delete(id);
            syncManageButtons();
            document.querySelectorAll(`.select-photo[data-select-id="${id}"]`).forEach((input) => {
              input.checked = selectedPhotoIds.has(id);
            });
          });
        });

        /* Touch swipe for lightbox */
        let touchStartX = 0;
        let touchStartY = 0;
        lightbox.addEventListener("touchstart", (e) => {
          const t = e.touches[0];
          if (!t) return;
          touchStartX = t.clientX;
          touchStartY = t.clientY;
        }, { passive: true });

        lightbox.addEventListener("touchend", (e) => {
          if (lightbox.hidden) return;
          const t = e.changedTouches[0];
          if (!t) return;
          const dx = t.clientX - touchStartX;
          const dy = t.clientY - touchStartY;

          // Horizontal swipe only (avoid accidental while scrolling)
          if (Math.abs(dx) < 55 || Math.abs(dx) < Math.abs(dy) * 1.3) return;
          if (dx > 0) moveLightbox(-1);
          else moveLightbox(1);
        });

        /* -----------------------------
           Control wiring
           ----------------------------- */
        manageFile.addEventListener("change", () => {
          const file = manageFile.files?.[0];
          if (!file) return;

          if (!manageTitle.value.trim()) {
            manageTitle.value = file.name.replace(/\.[^/.]+$/, "");
          }

          manageStatus.textContent = `Selected local file: ${file.name}`;
        });

        searchInput.addEventListener("input", (event) => {
          currentSearch = event.target.value;
          render();
        });

        filterButtons.forEach((button) => {
          button.addEventListener("click", () => {
            currentFilter = button.dataset.filter;
            filterButtons.forEach((entry) => entry.classList.toggle("active", entry === button));
            render();
          });
        });

        viewButtons.forEach((button) => {
          button.addEventListener("click", () => {
            currentView = button.dataset.view;
            document.body.classList.toggle("gallery-grid-view", currentView === "grid");
            document.body.classList.toggle("gallery-list-view", currentView === "list");
            viewButtons.forEach((entry) => entry.classList.toggle("active", entry === button));
          });
        });

        sortSelect.addEventListener("change", (event) => {
          currentSort = event.target.value;
          render();
        });

        resetButton.addEventListener("click", () => {
          currentFilter = "all";
          currentSearch = "";
          currentSort = "relevance";

          searchInput.value = "";
          sortSelect.value = "relevance";

          filterButtons.forEach((entry) =>
            entry.classList.toggle("active", entry.dataset.filter === "all")
          );

          render();
        });

        clearSearchBtn.addEventListener("click", () => {
          currentSearch = "";
          searchInput.value = "";
          render();
        });

        toggleManageMode.addEventListener("click", () => {
          manageMode = !manageMode;
          managePanel.hidden = !manageMode;
          toggleManageMode.classList.toggle("active", manageMode);
          if (!manageMode) {
            selectedPhotoIds = new Set();
            resetManageForm();
          }
          render();
        });

        addPhotoBtn.addEventListener("click", () => {
          manageMode = true;
          managePanel.hidden = false;
          toggleManageMode.classList.add("active");
          selectedPhotoIds = new Set();
          resetManageForm();
          manageStatus.textContent = "Adding a new photo. Fill out name, tags, notes, and image path.";
          render();
        });

        manageForm.addEventListener("submit", (event) => {
          event.preventDefault();
          const src = getManageSourcePath();
          if (!src) {
            return;
          }

          const nextId = photoData.reduce((max, photo) => Math.max(max, Number(photo.id) || 0), 0) + 1;
          const notes = manageNotes.value.trim();
          const newPhoto = {
            id: nextId,
            title: manageTitle.value.trim() || "Untitled photo",
            src,
            category: manageCategory.value,
            deck: manageDeck.value.trim(),
            source: manageSource.value,
            description: notes || "Added from manage photos panel.",
            notes,
            tags: parseTags(manageTags.value),
          };

          photoData.push(newPhoto);
          updateHeroStats();
          manageStatus.textContent = `Added ${newPhoto.title}.`;
          resetManageForm();
          render();
        });

        replacePhotoBtn.addEventListener("click", () => {
          const [selected] = getSelectedPhotos();
          if (!selected) return;
          const src = getManageSourcePath();
          if (!src) {
            return;
          }

          selected.title = manageTitle.value.trim() || selected.title;
          selected.category = manageCategory.value;
          selected.deck = manageDeck.value.trim();
          selected.source = manageSource.value;
          selected.src = src;
          selected.tags = parseTags(manageTags.value);
          const notes = manageNotes.value.trim();
          selected.notes = notes;
          selected.description = notes || selected.description;

          manageStatus.textContent = `Updated ${selected.title}.`;
          updateHeroStats();
          render();
        });

        deletePhotoBtn.addEventListener("click", () => {
          const toDelete = new Set(selectedPhotoIds);
          if (!toDelete.size) return;
          photoData = photoData.filter((photo) => !toDelete.has(photo.id));
          selectedPhotoIds = new Set();
          manageStatus.textContent = `Deleted ${toDelete.size} photo${toDelete.size === 1 ? "" : "s"}.`;
          updateHeroStats();
          render();
        });

        cancelManageBtn.addEventListener("click", () => {
          manageMode = false;
          managePanel.hidden = true;
          toggleManageMode.classList.remove("active");
          selectedPhotoIds = new Set();
          resetManageForm();
          render();
        });

        closeButton.addEventListener("click", closeLightbox);
        prevButton.addEventListener("click", () => moveLightbox(-1));
        nextButton.addEventListener("click", () => moveLightbox(1));

        lightbox.addEventListener("click", (event) => {
          if (event.target === lightbox) closeLightbox();
        });

        document.addEventListener("keydown", (event) => {
          if (lightbox.hidden) return;
          if (event.key === "Escape") closeLightbox();
          if (event.key === "ArrowLeft") moveLightbox(-1);
          if (event.key === "ArrowRight") moveLightbox(1);
        });

        window.addEventListener("beforeunload", clearUploadObjectUrl);

        /* Boot */
        render();
      });
    </script>
  </body>
</html>
