<!DOCTYPE html>
<!-- Cruise Hub Itinerary WOW Ultimate v3.0 -->
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0" />
  <meta name="theme-color" content="#49b5db" />
  <title>Photos · Adventure of the Seas</title>

  <!-- Fonts + Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/utilities.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/features.css">
  <link rel="stylesheet" href="css/mobile-first.css">
</head>

<body class="app-theme-rcc page-photos">
  <a class="skip" href="#main">Skip to photo highlights</a>
  <div class="sr-live" id="live" aria-live="polite" aria-atomic="true"></div>

  <canvas id="ocean" aria-hidden="true"></canvas>
  <div class="atmo" aria-hidden="true"></div>
  <div class="sparklegrid" aria-hidden="true"></div>
  <i class="fas fa-ship ship-sil" aria-hidden="true"></i>
  <canvas id="confetti" aria-hidden="true"></canvas>

  <!-- Sail-away overlay -->
  <div class="sailaway" id="sailaway" aria-hidden="true">
    <div class="layer"></div>
    <div class="horn">
      <span class="pulse" aria-hidden="true"></span>
      <i class="fas fa-bullhorn" aria-hidden="true"></i>
      <span>Sail-Away Moment</span>
    </div>
    <i class="fas fa-ship ship-run" aria-hidden="true"></i>
  </div>

  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand" title="Cruise Hub">
        <i class="fas fa-crown" aria-hidden="true"></i>
        <div class="brand-text">
          <div class="brand-title">Adventure of the Seas</div>
          <div class="brand-sub">Rahe Family &amp; Friends · Photos</div>
        </div>
      </div>
      <div class="spacer"></div>
      <span class="hdr-pill" id="sailPill" aria-label="Sail dates">
        <i class="fas fa-calendar-alt" aria-hidden="true"></i>
        Feb 14–20, 2026
      </span>
      <button class="hdr-iconbtn" id="menuBtn" type="button" aria-label="Open menu" aria-haspopup="dialog" aria-controls="drawerBackdrop">
        <i class="fas fa-bars" aria-hidden="true"></i>
      </button>
    </div>
  </header>

  <!-- Drawer -->
  <div class="drawer-backdrop" id="drawerBackdrop" role="dialog" aria-modal="true" aria-label="Menu">
    <aside class="drawer" id="drawer" tabindex="-1">
      <div class="drawer-head">
        <h3><i class="fas fa-compass" aria-hidden="true" style="color:var(--gold); margin-right:.45rem;"></i> Cruise Hub</h3>
        <button class="hdr-iconbtn" id="closeDrawerBtn" type="button" aria-label="Close menu">
          <i class="fas fa-xmark" aria-hidden="true"></i>
        </button>
      </div>

      <nav class="nav" aria-label="Primary">
        <a href="index.html"><i class="fas fa-house" aria-hidden="true"></i> Home</a>
        <a href="decks.html"><i class="fas fa-layer-group" aria-hidden="true"></i> Decks</a>
        <a href="itinerary.html"><i class="fas fa-route" aria-hidden="true"></i> Itinerary</a>
        <a href="photos.html" class="active"><i class="fas fa-camera-retro" aria-hidden="true"></i> Photos</a>
        <a href="dining.html"><i class="fas fa-utensils" aria-hidden="true"></i> Dining</a>
        <a href="tips.html"><i class="fas fa-life-ring" aria-hidden="true"></i> Tips</a>
        <a href="contacts.html"><i class="fas fa-phone" aria-hidden="true"></i> Contacts</a>
        <a href="operations.html"><i class="fas fa-clipboard-check" aria-hidden="true"></i> Operations</a>
      </nav>

      <div class="drawer-foot" aria-label="Quick actions">
        <div class="minirow">
          <strong>Photo tools</strong>
          <span style="opacity:.72;">local</span>
        </div>
        <div class="minirow" style="gap:.75rem;">
          <span style="opacity:.82; font-weight:900;">Ambient animations</span>
          <label style="display:inline-flex; align-items:center; gap:.5rem; user-select:none;">
            <input id="animToggle" type="checkbox" class="anim-toggle" />
            <span style="opacity:.86; font-weight:900; font-size:.8rem;">On</span>
          </label>
        </div>
        <button type="button" id="resetBtn"><i class="fas fa-rotate-left" aria-hidden="true"></i> Reset plans</button>
      </div>
    </aside>
  </div>

  <!-- Hero -->
  <section class="hero" aria-label="Photos hero">
    <h1>Cruise Memories &amp; Moments</h1>
    <p>
      Tap a day to expand. Swipe left/right <em>on the timeline</em> to jump days.
      Use this visual mode to browse each day with photo-first cards and quick sharing.
    </p>
    <div class="hint" aria-hidden="true">
      <span><i class="fas fa-hand-pointer" aria-hidden="true"></i> Tap to expand</span>
      <span><i class="fas fa-arrows-left-right" aria-hidden="true"></i> Swipe timeline</span>
      <span><i class="fas fa-images" aria-hidden="true"></i> Photo-first day cards</span>
    </div>
    <div class="day-controls" role="group" aria-label="Day navigation">
      <button class="ctlbtn" id="prevDayBtn" type="button"><i class="fas fa-arrow-left" aria-hidden="true"></i> Previous</button>
      <button class="ctlbtn primary" id="todayBtn" type="button"><i class="fas fa-bullseye" aria-hidden="true"></i> Jump to Today</button>
      <button class="ctlbtn" id="nextDayBtn" type="button">Next <i class="fas fa-arrow-right" aria-hidden="true"></i></button>
    </div>
  </section>

  <main id="main">
    <section class="timeline" id="timeline" aria-label="Cruise photos timeline"></section>
    <div style="margin-top:1.25rem; text-align:center; opacity:.68; font-weight:850; font-size:.78rem; color:rgba(255,255,255,.78);">
      Tip: long-press the “Copy day summary” button to share in group chat.
    </div>
  </main>

  <button class="back-to-top" id="backToTop" aria-label="Back to top" type="button">
    <i class="fas fa-arrow-up" aria-hidden="true"></i>
  </button>

  <!-- Bottom nav (mobile) -->
  <nav class="bottom-nav" aria-label="Bottom navigation">
    <a class="bottom-nav__item" href="index.html"><i class="fas fa-house" aria-hidden="true"></i><span>Home</span></a>
    <a class="bottom-nav__item" href="decks.html"><i class="fas fa-layer-group" aria-hidden="true"></i><span>Decks</span></a>
    <a class="bottom-nav__item" href="itinerary.html"><i class="fas fa-route" aria-hidden="true"></i><span>Route</span></a>
    <a class="bottom-nav__item active" href="photos.html"><i class="fas fa-camera-retro" aria-hidden="true"></i><span>Photos</span></a>
    <a class="bottom-nav__item" href="dining.html"><i class="fas fa-utensils" aria-hidden="true"></i><span>Dining</span></a>
    <button class="bottom-nav__item" id="moreBtn" type="button" aria-label="More"><i class="fas fa-ellipsis" aria-hidden="true"></i><span>More</span></button>
  </nav>

  <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function () {
      'use strict';

      // =========================================================
      // Config (edit these two and everything updates)
      // =========================================================
      const SAIL_START = new Date('2026-02-14T16:00:00Z'); // Explicit UTC // local device time
      const STORAGE_EXCURSIONS = 'rccl.itin.excursions.v2';
      const STORAGE_OPEN_DAY = 'rccl.itin.openDay.v2';
      const STORAGE_ACTIVE_DAY = 'rccl.itin.activeDay.v2';
      const STORAGE_ANIM = 'rccl.itin.anim.v1';

      // Day 6/7 times are reasonable defaults; tweak if RC updates your schedule.
      const ITIN = [
        {
          label: 'Port Canaveral',
          icon: 'fa-ship',
          sub: 'Departure · Sail-Away',
          desc: 'Embarkation day. Check in, board, muster drill, and then the ship slides into vacation mode.',
          lat: 28.4158, lon: -80.6077,
          theme: { sky1:'rgba(0,180,230,.18)', sky2:'rgba(255,215,64,.10)', sky3:'rgba(0,0,0,.55)' },
          arrival: null, depart: '16:00'
        },
        {
          label: 'Sea Day',
          icon: 'fa-water',
          sub: 'Full ship day',
          desc: 'Prime time for shows, pools, specialty dining, and wandering every deck like a curious raccoon.',
          lat: 26.0, lon: -79.0,
          theme: { sky1:'rgba(0,180,230,.20)', sky2:'rgba(0,255,210,.08)', sky3:'rgba(0,0,0,.60)' },
          arrival: null, depart: null
        },
        {
          label: 'Grand Cayman',
          icon: 'fa-umbrella-beach',
          sub: 'Tender port',
          desc: 'Clear water. Big beach energy. Tender timing matters—get off early if you want maximum calm.',
          lat: 19.3133, lon: -81.2546,
          theme: { sky1:'rgba(90,230,255,.18)', sky2:'rgba(255,215,64,.12)', sky3:'rgba(0,0,0,.58)' },
          arrival: '08:00', depart: '16:00'
        },
        {
          label: 'Falmouth, Jamaica',
          icon: 'fa-mountain',
          sub: 'Port day',
          desc: 'History, music, and excursions inland. This is the “do stuff” day, if you want one.',
          lat: 18.4939, lon: -77.6560,
          theme: { sky1:'rgba(0,180,230,.15)', sky2:'rgba(255,140,60,.10)', sky3:'rgba(0,0,0,.62)' },
          arrival: '09:30', depart: '17:00'
        },
        {
          label: 'Sea Day',
          icon: 'fa-water',
          sub: 'Reset & roam',
          desc: 'The quiet power of a sea day: nap, snack, repeat. Also: final shopping and show planning.',
          lat: 24.5, lon: -77.0,
          theme: { sky1:'rgba(0,180,230,.16)', sky2:'rgba(140,120,255,.09)', sky3:'rgba(0,0,0,.62)' },
          arrival: null, depart: null
        },
        {
          label: 'Perfect Day at CocoCay',
          icon: 'fa-sun',
          sub: 'Private island',
          desc: 'Water, sun, and the strange joy of a private island that runs like a theme park with waves.',
          lat: 25.8156, lon: -77.9341,
          theme: { sky1:'rgba(0,180,230,.18)', sky2:'rgba(255,215,64,.14)', sky3:'rgba(0,0,0,.56)' },
          arrival: '07:00', depart: '17:00'
        },
        {
          label: 'Port Canaveral',
          icon: 'fa-anchor',
          sub: 'Return · Disembark',
          desc: 'Final morning. Coffee, photos, double-check the room, and glide off like a professional.',
          lat: 28.4158, lon: -80.6077,
          theme: { sky1:'rgba(0,180,230,.12)', sky2:'rgba(255,215,64,.10)', sky3:'rgba(0,0,0,.66)' },
          arrival: '07:00', depart: null
        }
      ];

      // =========================================================
      // DOM
      // =========================================================
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

      const timeline = $('#timeline');
      const shipSil = $('.ship-sil');
      const toastEl = $('#toast');
      const liveEl = $('#live');

      const sailawayEl = $('#sailaway');
      const sailPill = $('#sailPill');

      const menuBtn = $('#menuBtn');
      const moreBtn = $('#moreBtn');
      const drawerBackdrop = $('#drawerBackdrop');
      const drawer = $('#drawer');
      const closeDrawerBtn = $('#closeDrawerBtn');
      const resetBtn = $('#resetBtn');
      const animToggle = $('#animToggle');

      const prevDayBtn = $('#prevDayBtn');
      const nextDayBtn = $('#nextDayBtn');
      const todayBtn = $('#todayBtn');

      const backToTopBtn = $('#backToTop');

      if (!timeline || !shipSil || !toastEl || !liveEl) {
        // Defensive: fail soft if embedded incorrectly.
        console.error('Missing required DOM nodes for itinerary.');
        return;
      }

      // =========================================================
      // Preferences
      // =========================================================
      function readAnimEnabled(){
        const v = localStorage.getItem(STORAGE_ANIM);
        if (v === null) return true;
        return v === '1';
      }
      function writeAnimEnabled(on){
        try { localStorage.setItem(STORAGE_ANIM, on ? '1' : '0'); } catch {}
      }
      function applyReducedMotionClass(){
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches){
    document.body.classList.add('reduced-motion');
  } else {
    document.body.classList.remove('reduced-motion');
  }
}

function applyAnimMode(){
        const on = readAnimEnabled();
        document.body.classList.toggle('no-anim', !on);
        if (animToggle) animToggle.checked = on;
        if (on) startOcean(); else stopOcean();
      }

      // =========================================================
      // Storage helpers
      // =========================================================
      const safeJSON = (s, fallback) => { try { return s ? JSON.parse(s) : fallback; } catch { return fallback; } };

      function getExcursions(){
        return safeJSON(localStorage.getItem(STORAGE_EXCURSIONS), {  },150);
});
      }
      function setExcursions(obj){
        try { localStorage.setItem(STORAGE_EXCURSIONS, JSON.stringify(obj || {})); } catch {}
      }

      function readOpenDay(){
        const n = parseInt(localStorage.getItem(STORAGE_OPEN_DAY) || '0', 10);
        return Number.isFinite(n) ? Math.max(0, Math.min(ITIN.length-1, n)) : 0;
      }
      function writeOpenDay(n){
        try { localStorage.setItem(STORAGE_OPEN_DAY, String(n)); } catch {}
      }

      function readActiveDay(){
        const n = parseInt(localStorage.getItem(STORAGE_ACTIVE_DAY) || '', 10);
        if (!Number.isFinite(n)) return null;
        return Math.max(0, Math.min(ITIN.length-1, n));
      }
      function writeActiveDay(n){
        try { localStorage.setItem(STORAGE_ACTIVE_DAY, String(n)); } catch {}
      }

      // Sync across tabs
      window.addEventListener('storage', (e) => {
        if (!e) return;
        if (e.key === STORAGE_EXCURSIONS) {
          renderExcursionButtons();
          toast('Synced plans from another tab.');
        }
        if (e.key === STORAGE_OPEN_DAY) {
          const idx = readOpenDay();
          openDay(idx, false, {announce:false, fromSync:true});
        }
        if (e.key === STORAGE_ACTIVE_DAY) {
          const idx = readActiveDay();
          if (idx != null) setActiveTheme(idx, {announce:false});
        }
      });

      // =========================================================
      // Date/time helpers
      // =========================================================
      const pad2 = (n) => String(n).padStart(2, '0');

      function formatDateShort(d) {
        try {
          return new Intl.DateTimeFormat(undefined, { weekday:'short', month:'short', day:'2-digit' }).format(d);
        } catch {
          return d.toDateString();
        }
      }

      function setTimeOnDate(d, hhmm) {
        if (!hhmm) return null;
        const [hh, mm] = String(hhmm).split(':').map(x => parseInt(x, 10));
        const t = new Date(d);
        if (Number.isFinite(hh)) t.setHours(hh);
        if (Number.isFinite(mm)) t.setMinutes(mm);
        t.setSeconds(0); t.setMilliseconds(0);
        return t;
      }

      function countdownTo(dt) {
        if (!dt) return '—';
        const now = new Date();
        const diff = dt - now;
        if (diff <= 0) return 'Now / passed';
        const mins = Math.floor(diff / 60000);
        const days = Math.floor(mins / (60*24));
        const hours = Math.floor((mins - days*60*24) / 60);
        const m = mins % 60;
        if (days > 0) return `${days}d ${hours}h`;
        if (hours > 0) return `${hours}h ${m}m`;
        return `${m}m`;
      }

      function isSameLocalDay(a, b){
        return a.getFullYear() === b.getFullYear()
          && a.getMonth() === b.getMonth()
          && a.getDate() === b.getDate();
      }

      // =========================================================
      // Sunrise / Sunset (simplified NOAA)
      // =========================================================
      function sunTimes(date, lat, lon) {
        const clampedLat = Math.max(-89.8, Math.min(89.8, Number(lat) || 0));
        const lng = Number(lon) || 0;
        const start = new Date(date.getFullYear(), 0, 0);
        const diff = date - start;
        const oneDay = 1000*60*60*24;
        const N = Math.floor(diff / oneDay);
        const gamma = (2 * Math.PI / 365) * (N - 1 + ((date.getHours() - 12) / 24));
        const eqtime = 229.18 * (0.000075 + 0.001868 * Math.cos(gamma) - 0.032077 * Math.sin(gamma) - 0.014615 * Math.cos(2*gamma) - 0.040849 * Math.sin(2*gamma));
        const decl = 0.006918 - 0.399912 * Math.cos(gamma) + 0.070257 * Math.sin(gamma) - 0.006758 * Math.cos(2*gamma) + 0.000907 * Math.sin(2*gamma) - 0.002697 * Math.cos(3*gamma) + 0.00148  * Math.sin(3*gamma);
        const latRad = clampedLat * (Math.PI/180);
        const zenith = 90.833 * (Math.PI/180);
        const cosH = (Math.cos(zenith) - Math.sin(latRad)*Math.sin(decl)) / (Math.cos(latRad)*Math.cos(decl));
        if (cosH > 1) return { sunrise: '—', sunset: '—' };
        if (cosH < -1) return { sunrise: '—', sunset: '—' };
        const H = Math.acos(cosH);
        const Hdeg = H * (180/Math.PI);
        const tzOffsetMin = -date.getTimezoneOffset();
        const solarNoon = (720 - 4*lng - eqtime + tzOffsetMin);
        const sunriseMin = solarNoon - (Hdeg*4);
        const sunsetMin = solarNoon + (Hdeg*4);

        const toHM = (mins) => {
          let m = Math.round(mins);
          m = (m % (24*60) + (24*60)) % (24*60);
          const hh = Math.floor(m/60);
          const mm = m % 60;
          const hr12 = ((hh + 11) % 12) + 1;
          const ampm = hh >= 12 ? 'PM' : 'AM';
          return `${hr12}:${pad2(mm)} ${ampm}`;
        };
        return { sunrise: toHM(sunriseMin), sunset: toHM(sunsetMin) };
      }

      // =========================================================
      // Toast + announcer
      // =========================================================
      let toastTimer = 0;
      function toast(msg, icon='fa-circle-check') {
        if (!toastEl) return;
        if (toastTimer) window.clearTimeout(toastTimer);
        toastEl.innerHTML = `<i class="fas ${icon}" aria-hidden="true"></i><span>${escapeHTML(String(msg || ''))}</span>`;
        toastEl.classList.add('show');
        toastTimer = window.setTimeout(() => toastEl.classList.remove('show'), 1800);
      }
      function announce(msg){
        if (!liveEl) return;
        liveEl.textContent = String(msg || '');
      }
      function escapeHTML(s){
        return s.replace(/[&<>"']/g, (ch) => ({
          '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
        }[ch]));
      }

      // =========================================================
      // Confetti (capped, debounced resize)
      // =========================================================
      const confCanvas = $('#confetti');
      const confCtx = confCanvas ? confCanvas.getContext('2d', { alpha:true }) : null;
      let confetti = [];
      let confRAF = 0;

      function debounce(fn, ms){
        let t = 0;
        return function(...args){
          if (t) window.clearTimeout(t);
          t = window.setTimeout(() => fn.apply(this, args), ms);
        };
      }

      function resizeConfetti() {
        if (!confCanvas || !confCtx) return;
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        confCanvas.width = Math.floor(window.innerWidth * dpr);
        confCanvas.height = Math.floor(window.innerHeight * dpr);
        confCanvas.style.width = window.innerWidth + 'px';
        confCanvas.style.height = window.innerHeight + 'px';
        confCtx.setTransform(dpr,0,0,dpr,0,0);
      }
      const onResize = debounce(() => { resizeConfetti(); resizeOcean(); }, 120);
      window.addEventListener('resize', onResize, { passive:true });

      function burstConfetti(x, y, intensity = 120) {
        if (!confCanvas || !confCtx) return;
        if (prefersReducedMotion() || !readAnimEnabled()) return;
        const MAX_PARTICLES = 700;
        const colors = ['#00b4e6', '#ffd740', '#ffffff', '#7de3ff', '#ffe58b'];
        const add = Math.min(intensity, Math.max(0, MAX_PARTICLES - confetti.length));
        if (add <= 0) return;

        for (let i = 0; i < add; i++) {
          confetti.push({
            x, y,
            vx: (Math.random() - 0.5) * 8,
            vy: (Math.random() - 1.2) * 10,
            g: 0.22 + Math.random() * 0.12,
            r: 2 + Math.random() * 3,
            a: 1,
            rot: Math.random() * Math.PI * 2,
            vr: (Math.random() - 0.5) * 0.25,
            c: colors[(Math.random()*colors.length) | 0]
          });
        }
        if (!confRAF) confRAF = requestAnimationFrame(tickConfetti);
      }

      function tickConfetti() {
        if (!confCanvas || !confCtx) { confRAF = 0; return; }
        const w = window.innerWidth, h = window.innerHeight;
        confCtx.clearRect(0,0,w,h);

        confetti = confetti.filter(p => p.a > 0.02 && p.y < h + 60 && p.x > -80 && p.x < w + 80);
        for (const p of confetti) {
          p.vy += p.g;
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vr;
          p.a *= 0.985;

          confCtx.save();
          confCtx.globalAlpha = p.a;
          confCtx.translate(p.x, p.y);
          confCtx.rotate(p.rot);
          confCtx.fillStyle = p.c;
          confCtx.fillRect(-p.r, -p.r/2, p.r*2.4, p.r);
          confCtx.restore();
        }

        if (confetti.length) confRAF = requestAnimationFrame(tickConfetti);
        else { confCtx.clearRect(0,0,w,h); confRAF = 0; }
      }

      // =========================================================
      // Sail-away (cooldown replay + time-aware trigger)
      // =========================================================
      let sailLock = false;
      let lastSailAt = 0;

      function sailAwayMoment(force=false) {
        if (!sailawayEl) return;
        const now = Date.now();
        const COOLDOWN_MS = 60_000; // 1 minute
        if (!force) {
          if (sailLock) return;
          if (now - lastSailAt < COOLDOWN_MS) return;
        }
        sailLock = true;
        lastSailAt = now;
        sailawayEl.classList.add('on');
        window.setTimeout(() => { sailawayEl.classList.remove('on'); }, 2800);
        window.setTimeout(() => { sailLock = false; }, 3100);
      }

      // =========================================================
      // Theme application (lighting system hook)
      // =========================================================
      function setActiveTheme(idx, opts={announce:true}) {
        const item = ITIN[idx];
        if (!item || !item.theme) return;

        const root = document.documentElement;
        root.style.setProperty('--sky1', item.theme.sky1 || 'rgba(0,180,230,.20)');
        root.style.setProperty('--sky2', item.theme.sky2 || 'rgba(0,255,210,.08)');
        root.style.setProperty('--sky3', item.theme.sky3 || 'rgba(0,0,0,.60)');

        // Update active card lighting
        $$('.card').forEach(c => c.classList.toggle('is-active', String(c.dataset.day) === String(idx)));

        writeActiveDay(idx);
        if (opts.announce) announce(`Active day set to Day ${idx+1}: ${item.label}.`);
      }

      // =========================================================
      // Rendering
      // =========================================================
      function buildCards() {
        const base = new Date(SAIL_START);
        base.setHours(0,0,0,0);

        const excursions = getExcursions();

        const frag = document.createDocumentFragment();
        for (let i = 0; i < ITIN.length; i++) {
          const d = new Date(base);
          d.setDate(base.getDate() + i);

          const item = ITIN[i];
          const portTag = (item.arrival || item.depart) ? 'PORT DAY' : 'SEA DAY';

          const times = sunTimes(d, item.lat, item.lon);
          const arriveDT = setTimeOnDate(d, item.arrival);
          const departDT = setTimeOnDate(d, item.depart);

          const isPlanned = !!excursions[String(i)];
          const today = new Date();
          const isToday = isSameLocalDay(today, d);

          const article = document.createElement('article');
          article.className = 'card';
          if (isToday) article.classList.add('is-today');
          // NOTE (a11y): Card is not a button because it contains interactive descendants.
          // Expansion is controlled by a dedicated header button.
          article.setAttribute('aria-expanded', 'false');
          article.dataset.day = String(i);

          article.innerHTML = `
            <div class="card-head">
              <div class="left">
                <div class="icon" aria-hidden="true"><i class="fas ${escapeHTML(item.icon)}"></i></div>
                <div class="titles">
                  <h2 id="day-title-${i}">Day ${i+1} · ${escapeHTML(item.label)}</h2>
                  <div class="subline" id="day-sub-${i}">${escapeHTML(formatDateShort(d))} · ${escapeHTML(item.sub || '')}</div>
                </div>
              </div>
              <div class="right">
                <span class="tag"><i class="fas fa-sparkles" aria-hidden="true"></i> ${escapeHTML(portTag)}</span>
                <button class="chev" type="button" data-action="toggle" aria-expanded="false" aria-controls="details-${i}" aria-describedby="day-sub-${i}" aria-label="Toggle details for Day ${i+1}">
                  <i class="fas fa-chevron-down" aria-hidden="true"></i>
                </button>
              </div>
            </div>

            <div class="details" id="details-${i}" role="region" aria-labelledby="day-title-${i}">
              <p>${escapeHTML(item.desc || '')}</p>

              <div class="meta-grid">
                <div class="meta">
                  <i class="fas fa-clock" aria-hidden="true"></i>
                  <div>
                    <strong>Timing</strong>
                    <span>${item.arrival ? `Arrive ${escapeHTML(item.arrival)} · <span data-countdown="arrive" data-day="${i}"></span>` : 'No port arrival'}</span>
                    <span>${item.depart ? `Depart ${escapeHTML(item.depart)} · <span data-countdown="depart" data-day="${i}"></span>` : 'No scheduled departure'}</span>
                  </div>
                </div>

                <div class="meta">
                  <i class="fas fa-sun" aria-hidden="true"></i>
                  <div>
                    <strong>Sun</strong>
                    <span class="sunrow">
                      <span class="sunbadge"><i class="fas fa-sunrise" aria-hidden="true"></i> ${escapeHTML(times.sunrise)}</span>
                      <span class="sunbadge"><i class="fas fa-sunset" aria-hidden="true"></i> ${escapeHTML(times.sunset)}</span>
                    </span>
                    <span style="opacity:.62;">Approximate for location</span>
                  </div>
                </div>
              </div>

              <div class="actions">
                <button class="pillbtn primary" type="button" data-action="jump" aria-label="Set this day as active theme">
                  <i class="fas fa-wand-magic-sparkles" aria-hidden="true"></i> Set as active day
                </button>

                <button class="pillbtn ${isPlanned ? 'on' : ''}" type="button" data-action="excursion" aria-pressed="${isPlanned ? 'true' : 'false'}">
                  <i class="fas fa-flag-checkered" aria-hidden="true"></i> ${isPlanned ? 'Excursion planned' : 'Plan excursion'}
                </button>

                <button class="pillbtn" type="button" data-action="copy">
                  <i class="fas fa-copy" aria-hidden="true"></i> Copy day summary
                </button>
              </div>
            </div>
          `;

          // Cache event data for countdown updates
          article._arriveDT = arriveDT;
          article._departDT = departDT;

          frag.appendChild(article);
        }

        timeline.innerHTML = '';
        timeline.appendChild(frag);
      }

      function renderExcursionButtons(){
        const excursions = getExcursions();
        $$('.card').forEach(card => {
          const day = String(card.dataset.day || '');
          const planned = !!excursions[day];
          const btn = $('[data-action="excursion"]', card);
          if (!btn) return;
          btn.classList.toggle('on', planned);
          btn.setAttribute('aria-pressed', planned ? 'true' : 'false');
          btn.innerHTML = `<i class="fas fa-flag-checkered" aria-hidden="true"></i> ${planned ? 'Excursion planned' : 'Plan excursion'}`;
        });
      }

      // =========================================================
      // Card open/close + keyboard
      // =========================================================
      function openDay(idx, scrollIntoView=true, opts={announce:true, fromSync:false}) {
        idx = Math.max(0, Math.min(ITIN.length-1, idx));

        const cards = $$('.card');
        const target = cards[idx];
        if (!target) return;

        // Close others
        cards.forEach((card, i) => {
          const isTarget = i === idx;
          card.setAttribute('aria-expanded', isTarget ? 'true' : 'false');
          const tbtn = card.querySelector('button[data-action="toggle"]');
          if (tbtn) tbtn.setAttribute('aria-expanded', isTarget ? 'true' : 'false');
        });

        // Persist
        writeOpenDay(idx);

        // Apply “active day” theme immediately if none is set
        if (readActiveDay() == null) setActiveTheme(idx, {announce:false});

        // Sail-away: only when Day 1 is opened and it is near/after sail time
        if (idx === 0) {
          const now = new Date();
          const withinWindow = Math.abs(now - SAIL_START) < 1000 * 60 * 60 * 12; // 12h window
          const alreadySailed = now >= SAIL_START;
          if (alreadySailed || withinWindow) sailAwayMoment(false);
        }

        if (scrollIntoView) {
          target.scrollIntoView({ behavior: prefersReducedMotion() ? 'auto' : 'smooth', block: 'center' });
        }

        // Announce
        if (opts.announce) announce(`Expanded itinerary details for Day ${idx+1}: ${ITIN[idx].label}.`);

        // Update countdowns right away
        updateCountdowns();

        // Ensure focus is stable (keyboard users)
        if (!opts.fromSync) {
          const tbtn = target.querySelector('button[data-action="toggle"]');
          if (tbtn) tbtn.focus({ preventScroll: true });
        }
      }

      function toggleCard(card){
        if (!card) return;
        const expanded = card.getAttribute('aria-expanded') === 'true';
        const idx = parseInt(card.dataset.day || '0', 10);

        const tbtn = card.querySelector('button[data-action="toggle"]');
        if (expanded) {
          card.setAttribute('aria-expanded', 'false');
          if (tbtn) tbtn.setAttribute('aria-expanded', 'false');
          // When closing, clear stored open day so reload doesn't surprise.
          try { localStorage.removeItem(STORAGE_OPEN_DAY); } catch {}
          announce(`Collapsed itinerary details for Day ${idx+1}: ${ITIN[idx].label}.`);
        } else {
          openDay(idx, true);
        }
      }

      function currentOpenIndex(){
        const expanded = $('.card[aria-expanded="true"]');
        if (expanded && expanded.dataset && expanded.dataset.day != null) {
          const n = parseInt(expanded.dataset.day, 10);
          if (Number.isFinite(n)) return n;
        }
        return readOpenDay();
      }

      // Global keyboard day navigation (arrow keys)
      window.addEventListener('keydown', (e) => {
        if (!e) return;

        // If drawer open, let focus trap handle it.
        if (drawerBackdrop && drawerBackdrop.classList.contains('open')) return;

        const key = e.key || '';
        if (key !== 'ArrowLeft' && key !== 'ArrowRight') return;
        if (e.altKey || e.ctrlKey || e.metaKey) return;

        const idx = currentOpenIndex();
        if (key === 'ArrowRight') openDay(Math.min(ITIN.length-1, idx + 1), true);
        else openDay(Math.max(0, idx - 1), true);
      }, { passive:false });

      // =========================================================
      // Card click / action delegation
      // =========================================================
      function onTimelineClick(e){
        const t = e.target;
        const card = t && t.closest ? t.closest('.card') : null;
        if (!card) return;

        const actionBtn = t.closest && t.closest('button[data-action]');
        if (actionBtn) {
          e.stopPropagation();
          const action = actionBtn.getAttribute('data-action');
          const idx = parseInt(card.dataset.day || '0', 10);

          if (action === 'toggle') {
            toggleCard(card);
            return;
          }

          if (action === 'jump') {
            setActiveTheme(idx, {announce:true});
            burstConfetti(window.innerWidth/2, window.innerHeight*0.35, 70);
            toast(`Active day: Day ${idx+1}`, 'fa-wand-magic-sparkles');
            return;
          }

          if (action === 'excursion') {
            const ex = getExcursions();
            const key = String(idx);
            ex[key] = !ex[key];
            setExcursions(ex);
            renderExcursionButtons();

            const rect = actionBtn.getBoundingClientRect();
            burstConfetti(rect.left + rect.width/2, rect.top + rect.height/2, ex[key] ? 160 : 60);
            toast(ex[key] ? 'Planned!' : 'Unplanned', ex[key] ? 'fa-party-horn' : 'fa-circle-minus');
            announce(ex[key] ? `Excursion planned for Day ${idx+1}.` : `Excursion unplanned for Day ${idx+1}.`);
            return;
          }

          if (action === 'copy') {
            copyDaySummary(idx);
            return;
          }
          return;
        }

        // Card body click toggles expansion
        toggleCard(card);
      }
      timeline.addEventListener('click', onTimelineClick);

      // Keyboard activate on card
      timeline.addEventListener('keydown', (e) => {
        const target = e.target;
        // Don't hijack keyboard events on real interactive controls
        if (target && (target.matches('button, a, input, select, textarea') || target.closest('button, a, input, select, textarea'))) return;

        const card = target && target.closest ? target.closest('.card') : null;
        if (!card) return;
        const key = e.key || '';
        if (key === 'Enter' || key === ' ') {
          e.preventDefault();
          toggleCard(card);
        }
      });

      // =========================================================
      // Copy to clipboard
      // =========================================================
      async function copyText(text){
        const s = String(text || '');
        if (!s) return false;

        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(s);
            return true;
          }
        } catch {}

        // Fallback (best-effort)
        try {
          const ta = document.createElement('textarea');
          ta.value = s;
          ta.setAttribute('readonly', 'true');
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          return !!ok;
        } catch {
          return false;
        }
      }

      function daySummary(idx){
        const base = new Date(SAIL_START);
        base.setHours(0,0,0,0);
        const d = new Date(base);
        d.setDate(base.getDate() + idx);

        const item = ITIN[idx];
        const planned = !!getExcursions()[String(idx)];

        const arrive = item.arrival ? `Arrive ${item.arrival}` : 'No port arrival';
        const depart = item.depart ? `Depart ${item.depart}` : 'No scheduled departure';

        return [
          `Day ${idx+1} · ${item.label} (${formatDateShort(d)})`,
          item.sub ? `${item.sub}` : '',
          `${arrive} · ${depart}`,
          `Planned excursion: ${planned ? 'Yes' : 'No'}`,
          '',
          item.desc || ''
        ].filter(Boolean).join('\n');
      }

      async function copyDaySummary(idx){
        const ok = await copyText(daySummary(idx));
        if (ok) toast('Copied day summary', 'fa-copy');
        else toast('Copy failed (browser restrictions)', 'fa-triangle-exclamation');
      }

      // =========================================================
      // Countdown: refresh every minute + immediately on open
      // =========================================================
      function updateCountdowns(){
        const cards = $$('.card');
        for (const card of cards) {
          const idx = parseInt(card.dataset.day || '0', 10);
          const arriveEl = $(`[data-countdown="arrive"][data-day="${idx}"]`, card);
          const departEl = $(`[data-countdown="depart"][data-day="${idx}"]`, card);

          if (arriveEl && card._arriveDT) arriveEl.textContent = countdownTo(card._arriveDT);
          if (departEl && card._departDT) departEl.textContent = countdownTo(card._departDT);
        }
      }
      function startCountdownTicker(){
        updateCountdowns();
        // align to minute boundary for nicer updates
        const now = new Date();
        const msToNextMinute = (60 - now.getSeconds()) * 1000 + (1000 - now.getMilliseconds());
        window.setTimeout(() => {
          updateCountdowns();
          window.setInterval(updateCountdowns, 60_000);
        }, Math.max(250, Math.min(msToNextMinute, 60_000)));
      }

      // =========================================================
      // Swipe gesture (timeline-only, diagonals ignored)
      // =========================================================
      let touchStartX = 0, touchStartY = 0, touchStartT = 0;

      function onTouchStart(e){
        const t = e.touches && e.touches[0];
        if (!t) return;
        touchStartX = t.clientX;
        touchStartY = t.clientY;
        touchStartT = performance.now();
      }

      function onTouchEnd(e){
        const t = e.changedTouches && e.changedTouches[0];
        if (!t) return;

        const dx = t.clientX - touchStartX;
        const dy = t.clientY - touchStartY;
        const dt = performance.now() - touchStartT;

        const absX = Math.abs(dx);
        const absY = Math.abs(dy);

        // Cancel vertical/diagonal scroll attempts
        if (absY > 50 && absY > absX) return;

        // Require a minimum horizontal distance & reasonable speed
        const MIN = Math.max(70, Math.floor(window.innerWidth * 0.12));
        if (absX < MIN) return;
        if (dt > 900) return;

        const idx = currentOpenIndex();
        if (dx < 0) openDay(Math.min(ITIN.length-1, idx + 1), true);
        else openDay(Math.max(0, idx - 1), true);
      }

      timeline.addEventListener('touchstart', onTouchStart, { passive:true });
      timeline.addEventListener('touchend', onTouchEnd, { passive:true });

      // =========================================================
      // Drawer: open/close + focus trap
      // =========================================================
      const focusableSel = [
        'a[href]',
        'button:not([disabled])',
        'input:not([disabled])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      let lastFocus = null;

      function openDrawer(){
        if (!drawerBackdrop || !drawer) return;
        if (drawerBackdrop.classList.contains('open')) return;
        lastFocus = document.activeElement;
        drawerBackdrop.classList.add('open');
        // focus first item
        const f = $(focusableSel, drawer) || drawer;
        window.setTimeout(() => f.focus({ preventScroll: true }), 20);
      }

      function closeDrawer(){
        if (!drawerBackdrop || !drawer) return;
        if (!drawerBackdrop.classList.contains('open')) return;
        drawerBackdrop.classList.remove('open');
        // restore focus safely
        const target = (menuBtn && document.contains(menuBtn)) ? menuBtn : lastFocus;
        window.setTimeout(() => {
          if (target && target.focus) target.focus({ preventScroll: true });
        }, 20);
      }

      function trapFocus(e){
        if (!drawerBackdrop || !drawerBackdrop.classList.contains('open')) return;
        if (!e || e.key !== 'Tab') return;

        const focusables = $$(focusableSel, drawer);
        if (!focusables.length) return;

        const first = focusables[0];
        const last = focusables[focusables.length - 1];
        const active = document.activeElement;

        if (e.shiftKey && active === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && active === last) {
          e.preventDefault();
          first.focus();
        }
      }

      function onBackdropClick(e){
        if (!drawerBackdrop) return;
        if (e.target === drawerBackdrop) closeDrawer();
      }

      if (menuBtn) menuBtn.addEventListener('click', openDrawer);
      if (moreBtn) moreBtn.addEventListener('click', openDrawer);
      if (closeDrawerBtn) closeDrawerBtn.addEventListener('click', closeDrawer);
      if (drawerBackdrop) drawerBackdrop.addEventListener('click', onBackdropClick);
      window.addEventListener('keydown', (e) => {
        if (!drawerBackdrop || !drawerBackdrop.classList.contains('open')) return;
        if (e.key === 'Escape') closeDrawer();
      });
      window.addEventListener('keydown', trapFocus, { passive:false });

      // =========================================================
      // Reset tool
      // =========================================================
      function resetPlans(){
        try { localStorage.removeItem(STORAGE_EXCURSIONS); } catch {}
        try { localStorage.removeItem(STORAGE_OPEN_DAY); } catch {}
        try { localStorage.removeItem(STORAGE_ACTIVE_DAY); } catch {}
        try { localStorage.removeItem(STORAGE_ANIM); } catch {}
        renderExcursionButtons();
        setActiveTheme(0, {announce:false});
        openDay(0, true);
        toast('Reset complete', 'fa-rotate-left');
      }
      if (resetBtn) resetBtn.addEventListener('click', () => {
        resetPlans();
        closeDrawer();
      });
      if (animToggle) animToggle.addEventListener('change', () => {
        writeAnimEnabled(!!animToggle.checked);
        applyReducedMotionClass();
      applyAnimMode();
        toast(readAnimEnabled() ? 'Animations on' : 'Animations off', 'fa-wand-magic-sparkles');
      });

      // =========================================================
      // Hero controls
      // =========================================================
      prevDayBtn.addEventListener('click', () => openDay(Math.max(0, currentOpenIndex() - 1), true));
      nextDayBtn.addEventListener('click', () => openDay(Math.min(ITIN.length-1, currentOpenIndex() + 1), true));
      todayBtn.addEventListener('click', () => {
        const idx = computeTodayIndex();
        openDay(idx, true);
        toast(`Jumped to ${idx === 0 ? 'Day 1' : `Day ${idx+1}`}`, 'fa-bullseye');
      });

      // =========================================================
      // Intersection reveal (lazy entrance)
      // =========================================================
      function setupReveal(){
        const cards = $$('.card');
        if (!('IntersectionObserver' in window)) {
          cards.forEach(c => c.classList.add('visible'));
          return;
        }
        const io = new IntersectionObserver((entries) => {
          for (const ent of entries) {
            if (ent.isIntersecting) {
              ent.target.classList.add('visible');
              io.unobserve(ent.target);
            }
          }
        }, { root: null, threshold: 0.12 });
        cards.forEach(c => io.observe(c));
      }

      // =========================================================
      // Back to top
      // =========================================================
      window.addEventListener('scroll', () => {
        backToTopBtn.classList.toggle('show', (window.scrollY || 0) > 700);
      }, { passive:true });
      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: prefersReducedMotion() ? 'auto' : 'smooth' });
      });

      // =========================================================
      // Parallax ship (throttled via rAF)
      // =========================================================
      let parallaxRAF = 0;
      function onScrollParallax(){
        if (parallaxRAF) return;
        parallaxRAF = requestAnimationFrame(() => {
          parallaxRAF = 0;
          const y = window.scrollY || 0;
          shipSil.style.transform = `translateX(-50%) translateY(${y * 0.06}px)`;
        });
      }
      window.addEventListener('scroll', onScrollParallax, { passive:true });

      // =========================================================
      // Ocean animation (paused on hidden)
      // =========================================================
      const ocean = $('#ocean');
      const ctx = ocean ? ocean.getContext('2d', { alpha:true }) : null;
      let oceanT = 0;
      let oceanRAF = 0;
      let oceanRunning = false;

      function prefersReducedMotion(){
        return !!(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches);
      }

      function resizeOcean(){
        if (!ocean || !ctx) return;
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        ocean.width = Math.floor(window.innerWidth * dpr);
        ocean.height = Math.floor(window.innerHeight * dpr);
        ocean.style.width = window.innerWidth + 'px';
        ocean.style.height = window.innerHeight + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }

      function drawOcean(){
        if (!ocean || !ctx) return;
        const w = window.innerWidth, h = window.innerHeight;
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = '#071a2c';
        ctx.fillRect(0,0,w,h);

        const g = ctx.createLinearGradient(0,0,0,h);
        g.addColorStop(0,'rgba(10,46,74,.10)');
        g.addColorStop(1,'rgba(0,0,0,.28)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,w,h);

        for (let i=0;i<3;i++){
          const amp = 22 + i*12;
          const len = 0.010 - i*0.0018;
          const base = h*(0.48 + i*0.07);
          ctx.beginPath();
          ctx.moveTo(0, base);
          for (let x=0;x<=w;x+=8){
            const y = base + Math.sin(x*len + oceanT*(0.9+i*0.2)) * amp;
            ctx.lineTo(x,y);
          }
          ctx.lineTo(w,h);
          ctx.lineTo(0,h);
          ctx.closePath();
          ctx.fillStyle = `rgba(0,180,230,${0.12 - i*0.03})`;
          ctx.fill();
        }

        oceanT += prefersReducedMotion() ? 0.004 : 0.012;
      }

      function oceanTick(){
        if (!oceanRunning) return;
        drawOcean();
        oceanRAF = requestAnimationFrame(oceanTick);
      }

      function startOcean(){
        if (oceanRunning) return;
        oceanRunning = true;
        oceanRAF = requestAnimationFrame(oceanTick);
      }

      function stopOcean(){
        oceanRunning = false;
        if (oceanRAF) cancelAnimationFrame(oceanRAF);
        oceanRAF = 0;
      }

      document.addEventListener('visibilitychange', () => {
        if (!readAnimEnabled()) return;
        if (document.hidden) stopOcean();
        else startOcean();
      });

      // =========================================================
      // Today index (based on local date)
      // =========================================================
      function computeTodayIndex(){
        const start = new Date(SAIL_START);
        start.setHours(0,0,0,0);
        const now = new Date();
        now.setHours(0,0,0,0);
        const diffDays = Math.floor((now - start) / (24*60*60*1000));
        return Math.max(0, Math.min(ITIN.length-1, diffDays));
      }

      // =========================================================
      // Header pill "live" state if currently sailing week
      // =========================================================
      function updateSailPill(){
        if (!sailPill) return;
        const start = new Date(SAIL_START);
        const end = new Date(SAIL_START);
        end.setDate(end.getDate() + (ITIN.length - 1));
        const now = new Date();
        const live = now >= start && now <= end;
        sailPill.classList.toggle('is-live', live);
      }

      
      // Midnight rollover check (updates TODAY badge without reload)
      function scheduleMidnightUpdate(){
        const now = new Date();
        const next = new Date(now);
        next.setHours(24,0,0,0);
        const ms = next.getTime() - now.getTime();
        setTimeout(() => {
          buildCards();
      scheduleMidnightUpdate();
          scheduleMidnightUpdate();
        }, ms + 1000);
      }

      // =========================================================
      // Init
      // =========================================================
      function init(){
        buildCards();
      scheduleMidnightUpdate();
        setupReveal();

        resizeConfetti();
        resizeOcean();
        applyReducedMotionClass();
      applyAnimMode();

        // Restore theme + open day
        const active = readActiveDay();
        if (active != null) setActiveTheme(active, {announce:false});

        const idx = readOpenDay();
        openDay(idx, false, {announce:false});

        updateSailPill();
        startCountdownTicker();

        // Auto-highlight today's card and gently scroll to it once (first load only)
        const todayIdx = computeTodayIndex();
        const todayCard = $(`.card[data-day="${todayIdx}"]`);
        if (todayCard) {
          // ensure “today” tag stays accurate even after midnight
          // and set an initial visible nudge
          if (!prefersReducedMotion()) {
            window.setTimeout(() => {
              todayCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 250);
          }
        }

        // Long-press on copy: share sheet (best-effort)
        timeline.addEventListener('pointerdown', (e) => {
          const btn = e.target && e.target.closest ? e.target.closest('button[data-action="copy"]') : null;
          if (!btn) return;
          const card = btn.closest('.card');
          if (!card) return;
          const idx = parseInt(card.dataset.day || '0', 10);

          let fired = false;
          const timer = window.setTimeout(async () => {
            fired = true;
            const text = daySummary(idx);
            if (navigator.share) {
              try { await navigator.share({ text }); toast('Shared', 'fa-share-nodes'); }
              catch { /* ignore */ }
            }
          }, 520);

          const clear = () => window.clearTimeout(timer);
          btn.addEventListener('pointerup', clear, { once:true });
          btn.addEventListener('pointercancel', clear, { once:true });
          btn.addEventListener('pointerleave', clear, { once:true });
        }, { passive:true });
      }

      init();
    })();
  </script>

  <noscript>
    <div style="padding:1rem; text-align:center; background:#ffd740; color:#0d2236; font-weight:900;">
      This itinerary needs JavaScript enabled.
    </div>
  </noscript>

  <script src="js/global.js" defer></script>
  <script src="js/shared-layout.js" defer></script>
  <script src="js/decks.js" defer></script>
</body>
</html>
